<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-directintegration docs-doc-id-samplecode">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Sample Code &amp; Examples | Handpoint</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://developer-ecomm.handpoint.io/directintegration/samplecode"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-directintegration-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-directintegration-current"><meta data-rh="true" property="og:title" content="Sample Code &amp; Examples | Handpoint"><meta data-rh="true" name="description" content="Transaction Types"><meta data-rh="true" property="og:description" content="Transaction Types"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://developer-ecomm.handpoint.io/directintegration/samplecode"><link data-rh="true" rel="alternate" href="https://developer-ecomm.handpoint.io/directintegration/samplecode" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer-ecomm.handpoint.io/directintegration/samplecode" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RNDFP191TE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RNDFP191TE",{anonymize_ip:!0})</script>









<script src="https:////js-eu1.hs-scripts.com/25846579.js"></script><link rel="stylesheet" href="/assets/css/styles.423f145a.css">
<link rel="preload" href="/assets/js/runtime~main.1b9da508.js" as="script">
<link rel="preload" href="/assets/js/main.4cacc470.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://developer.handpoint.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/handpoint-logo-hvitt.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA" width="75"><img src="/img/handpoint-logo-hvitt.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU" width="75"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/cnpdocs">Getting Started</a><a class="navbar__item navbar__link" href="/docs/overview">Hosted Payment Page</a><a class="navbar__item navbar__link" href="/hostedpaymentfields/overview">Hosted Payment Fields</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/directintegration/overview">Direct Integration</a><a class="navbar__item navbar__link" href="/batchintegration/overview">Batch Integration</a><a class="navbar__item navbar__link" href="/paybutton/basicpaybutton">Pay By Link</a><a class="navbar__item navbar__link" href="/shoppingcarts/shoppingcarts">Shopping Carts</a><a class="navbar__item navbar__link" href="/mobilesdks/mobilesdks">Mobile SDKs</a></div><div class="navbar__items navbar__items--right"><a href="https://status.handpoint.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-statuspage-icon" aria-label="Status Page"></a><a href="https://github.com/handpoint" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/directintegration/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/directintegration/samplecode">Sample Code &amp; Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/directintegration/transactiontypes">Transaction Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/directintegration/3dsecure">3D Secure &amp; Strong Customer Authentication (SCA)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/directintegration/credentialsonfile">Credentials on file &amp; Recurring Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/directintegration/digitalwalletsandapms">Digital Wallets and Alternative Payment Methods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/directintegration/advancedfunctionalities">Advanced Gateway Functionalities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/directintegration/advanceddata">Extra Transaction Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/directintegration/annexes">Annexes</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Sample Code &amp; Examples</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Sample Code &amp; Examples</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-types">Transaction Types<a class="hash-link" href="#transaction-types" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sale">SALE<a class="hash-link" href="#sale" title="Direct link to heading">​</a></h3><p>The following example PHP code shows how to send a <strong>SALE</strong> transaction (amount £21,01) with support for 3-D
Secure using the <a href="/directintegration/samplecode#gateway-library-php">Gateway library</a>:</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>An expiry month of <strong>12</strong> (December) will simulate the non frictionless flow and a challenge will appear to the cardholder. </p></div></div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2101</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//An expiry month of 12 (December) will simulate the non frictionless flow and a challenge will appear to the cardholder. </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">25</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerEmail&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;example@example.com&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Date that the payment account was enrolled in the cardholder&#x27;s account with the 3DS Requestor. </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                                         </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Accepted date format is YYYYMMDD.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Indicates the length of time that the payment account was enrolled in the cardholder&#x27;s account </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                                            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//with the 3DS Requestor. Possible values are:</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                                            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//01 – No account (guest check-out) </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                                            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//02 – Created during this transaction</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                                            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//03 – Less than 30 days</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                                            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//04 – 30-60 days  </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                                            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//05 – More than 60 days</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// 3DS continuation request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field must be passed to continue the 3DS request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">          </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">           </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">          </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">    </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">    &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">    &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">    &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">      window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">    &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">    &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verify">VERIFY<a class="hash-link" href="#verify" title="Direct link to heading">​</a></h3><p>The following example PHP code shows how to send a <strong>VERIFY</strong> (amount £0,00) transaction with support for 3-D
Secure using the <a href="/directintegration/samplecode#gateway-library-php">Gateway library</a>:</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>An expiry month of <strong>12</strong> (December) will simulate the non frictionless flow and a challenge will appear to the cardholder. </p></div></div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;VERIFY&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">0</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//An expiry month of 12 (December) will simulate the non frictionless flow and a challenge will appear to the cardholder. </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">25</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerEmail&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;example@example.com&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;VERIFY&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="preauth">PREAUTH<a class="hash-link" href="#preauth" title="Direct link to heading">​</a></h3><p>The following example PHP code shows how to do a <strong>PREAUTH</strong> (amount £1,00) transaction with support for 3-D Secure using the <a href="/directintegration/samplecode#gateway-library-php">Gateway library</a>:</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>An expiry month of <strong>12</strong> (December) will simulate the non frictionless flow and a challenge will appear to the cardholder. </p></div></div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;PREAUTH&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">100</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//An expiry month of 12 (December) will simulate the non frictionless flow and a challenge will appear to the cardholder.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerEmail&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;example@example.com&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;PREAUTH&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field must be passed to continue the 3DS request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="refund_sale">REFUND_SALE<a class="hash-link" href="#refund_sale" title="Direct link to heading">​</a></h3><p>The following example PHP code shows how to do a <strong>REFUND_SALE</strong> transaction, the previous SALE transaction should be specified using the <code>xref</code> field, using the <a href="/directintegration/samplecode#gateway-library-php">Gateway library</a>.</p><p>Partial refunds are allowed by specifying the amount to refund. Any amount must not be greater than the original received amount minus any already refunded amount. Multiple partial refunds may be made while there is still a portion of the originally received amount un-refunded.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REFUND_SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1301</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">25</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerEmail&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;example@example.com&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;11223344556677889911223&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//That field is mandatory for REFUND_SALE transaction.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REFUND_SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="refund">REFUND<a class="hash-link" href="#refund" title="Direct link to heading">​</a></h3><p>The following example PHP code shows how to do a <strong>REFUND</strong> (amount £22,00) transaction with support for 3-D Secure using the <a href="/directintegration/samplecode#gateway-library-php">Gateway library</a>:</p><p>This is an independent refund and need not be related to any previous SALE. The amount is therefore not limited by any original received amount.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REFUND&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2200</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">25</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerEmail&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;example@example.com&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REFUND&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="capture">CAPTURE<a class="hash-link" href="#capture" title="Direct link to heading">​</a></h3><p>The following example PHP code shows how to do a <strong>CAPTURE</strong> using the <a href="/directintegration/samplecode#gateway-library-php">Gateway library</a>.</p><p>This will capture an existing transaction, identified using the <code>xref</code> request field, making it available for settlement at the next available opportunity. It can only be performed on transactions that have been authorised but not yet captured. An amount to capture may be specified but must not exceed the original amount authorised. </p><p><strong>NOTE</strong>: The original transaction must have been submitted with a <code>captureDelay</code> value that prevented immediate capture and settlement leaving the transaction in an authorised but un-captured state.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;CAPTURE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;11223344556677889911223&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//That field is mandatory for CAPTURE transaction.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;$_SERVER[&#x27;</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">REMOTE_ADDR</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;]&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;CAPTURE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cancel">CANCEL<a class="hash-link" href="#cancel" title="Direct link to heading">​</a></h3><p>The following example PHP code shows how to do a <strong>CANCEL</strong> using the <a href="/directintegration/samplecode#gateway-library-php">Gateway library</a>.</p><p>This will cancel an existing transaction, identified using the <code>xref</code> request field, preventing it from being settled. It can only be performed on transactions, which have been authorised but not yet settled, and it is not reversible</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;CANCEL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;11223344556677889911223&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//That field is mandatory for CANCEL transaction.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;CANCEL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="query">QUERY<a class="hash-link" href="#query" title="Direct link to heading">​</a></h3><p>The following example PHP code shows how to do a <strong>QUERY</strong> using the <a href="/directintegration/samplecode#gateway-library-php">Gateway library</a>.</p><p>This will query an existing transaction, identified using the <code>xref</code> request field, returning the original response. This is a simple transaction lookup action.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;QUERY&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;11223344556677889911223&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//That field is mandatory for CANCEL transaction.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;QUERY transaction:&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;ResponseStatus:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseStatus&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;ResponseMessage:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;Action:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;Amount:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;XREF:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;TransactionID:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;transactionID&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;State:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;state&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;Timestamp:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;timestamp&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;CardNumberMask:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumberMask&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;CardTypeCode:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardTypeCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;CardType:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardType&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;CardSchemeCode:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardSchemeCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;CardScheme:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardScheme&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;br&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;CardIssuer:&quot;</span><span class="token php language-php operator">.</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot; &quot;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardIssuer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3ds-example-php-code">3DS Example (PHP Code)<a class="hash-link" href="#3ds-example-php-code" title="Direct link to heading">​</a></h2><p>The following example shows the complete 3D Secure process.  When executing this code, the different phases of the 3DS process are displayed on the screen.</p><p>It allows you to choose between 3 different cards (Visa, Mastercard and AMEX) and allows you to select the expiration month of the selected card.</p><p>Each month represents a different authentication status returned by the Directory Server (for frictionless flow simulation). <a href="/directintegration/samplecode#3d-secure-testing">Here</a> you can check the meaning of each month.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">MERCHANT_SECRET_KEY</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">MERCHANT_ID</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">GATEWAY_URL</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Route</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;menu&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">menu</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">elseif</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;run&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">run</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">elseif</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3dscallback&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">threeDSCallback</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">menu</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Select test card menu.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">menu</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$testCards</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Visa Credit&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;address&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Flat 6 Primrose Rise 347 Lavender Road Northampton&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;post_code&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;NN17 8YG&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_number&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;4929421234600821&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_cvv&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;356&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Mastercard Credit&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;address&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;25 The Larches Narborough Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;post_code&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2RT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_number&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5301250070000191&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_cvv&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;419&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;American Express (Amex)&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;address&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;The Hunts Way Southampton&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;post_code&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SO18 1GW&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_number&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;374245455400001&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_cvv&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;4887&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;p&gt;Select test card:&lt;/p&gt;&lt;table class=&quot;table&quot;&gt;&lt;thead&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$testCards</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$testCard</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string heredoc-string delimiter symbol punctuation" style="color:rgb(248, 248, 242)">&lt;&lt;&lt;</span><span class="token php language-php string heredoc-string delimiter symbol" style="color:rgb(248, 248, 242)">HTML</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">            &lt;tr&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                &lt;td&gt;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$testCard</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string heredoc-string interpolation string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_name&#x27;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&lt;/td&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                &lt;td&gt;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$testCard</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string heredoc-string interpolation string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_number&#x27;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&lt;/td&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                &lt;td&gt;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$testCard</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string heredoc-string interpolation string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;address&#x27;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&lt;/td&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                &lt;td&gt;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$testCard</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string heredoc-string interpolation string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;post_code&#x27;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&lt;/td&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                &lt;td&gt; &lt;form action=&quot;?run&quot; method=&quot;post&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    Expiry month</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                &lt;select class=&quot;form-select&quot; aria-label=&quot;Default select example&quot; name=&quot;cardExpiryMonth&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                &lt;option selected=&quot;selected&quot; value=&quot;12&quot;&gt;12&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;4&quot;&gt;4&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;5&quot;&gt;5&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;6&quot;&gt;6&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;7&quot;&gt;7&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;8&quot;&gt;8&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;9&quot;&gt;9&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;10&quot;&gt;10&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;11&quot;&gt;11&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;option value=&quot;12&quot;&gt;12&lt;/option&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;/select&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;input type=&quot;hidden&quot; name=&quot;cardNumber&quot; value=&quot;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$testCard</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string heredoc-string interpolation string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_number&#x27;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;input type=&quot;hidden&quot; name=&quot;cardCVV&quot; value=&quot;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$testCard</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string heredoc-string interpolation string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;card_cvv&#x27;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;input type=&quot;hidden&quot; name=&quot;cardAddress&quot; value=&quot;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$testCard</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string heredoc-string interpolation string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;address&#x27;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                    &lt;input type=&quot;hidden&quot; name=&quot;cardPostCode&quot; value=&quot;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$testCard</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string heredoc-string interpolation string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;post_code&#x27;</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                &lt;td&gt;&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-small&quot;&gt;Submit&lt;/button&gt;&lt;/td&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                &lt;/form&gt;&lt;/td&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">            &lt;/tr&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"></span><span class="token php language-php string heredoc-string delimiter symbol" style="color:rgb(248, 248, 242)">HTML</span><span class="token php language-php string heredoc-string delimiter symbol punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string heredoc-string delimiter symbol punctuation" style="color:rgb(248, 248, 242)">&lt;&lt;&lt;</span><span class="token php language-php string heredoc-string delimiter symbol" style="color:rgb(248, 248, 242)">HTML</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">            &lt;/tbody&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">        &lt;/table&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"></span><span class="token php language-php string heredoc-string delimiter symbol" style="color:rgb(248, 248, 242)">HTML</span><span class="token php language-php string heredoc-string delimiter symbol punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">renderPage</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3DSv2 Demo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">run</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSRedirectURL</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;https://&quot;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;http://&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_HOST&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;PHP_SELF&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;150&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;083&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;23&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;12&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;4929421234600821&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;826&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;826&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardAddress&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardAddress&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;16&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerEmail&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;email@exampledomainnamehere.com&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;MrMrs Tester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardPostCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardPostCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;55&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">MERCHANT_ID</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;duplicateDelay&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">0</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php">             </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php">  </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php">        </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSRedirectURL</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">?3dscallback&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceChannel&#x27;</span><span class="token php language-php">                </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browser&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceIdentity&#x27;</span><span class="token php language-php">            </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_USER_AGENT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_USER_AGENT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php class-name return-type">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceTimeZone&#x27;</span><span class="token php language-php">            </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;0&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceScreenResolution&#x27;</span><span class="token php language-php">    </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1x1x1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceAcceptContent&#x27;</span><span class="token php language-php">        </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;*/*&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceAcceptEncoding&#x27;</span><span class="token php language-php">        </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_ENCODING&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_ENCODING&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;*&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceAcceptLanguage&#x27;</span><span class="token php language-php">        </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_LANGUAGE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_LANGUAGE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;en-gb;q=0.001&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceAcceptCharset&#x27;</span><span class="token php language-php">        </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_CHARSET&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_CHARSET&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php class-name return-type">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;signature&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">createSignature</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">MERCHANT_SECRET_KEY</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">sendRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">GATEWAY_URL</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string heredoc-string delimiter symbol punctuation" style="color:rgb(248, 248, 242)">&lt;&lt;&lt;</span><span class="token php language-php string heredoc-string delimiter symbol" style="color:rgb(248, 248, 242)">HTML</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">      &lt;div class=&quot;card&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">        &lt;div class=&quot;card-header&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">           &lt;h5&gt; Request to gateway&lt;/h5&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">        &lt;/div&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">        &lt;div class=&quot;card-body&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">    HTML;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">    </span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"> .= &#x27;&lt;pre&gt;&#x27; .  print_r(</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">, true) . &#x27;&lt;/pre&gt;&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">    </span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"> = http_build_query(</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">, &#x27;&#x27;, &#x27;&amp;&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">    // Normalise all line endings (CRNL|NLCR|NL|CR) to just NL (%0A)  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">    </span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"> = str_replace(array(&#x27;%0D%0A&#x27;, &#x27;%0A%0D&#x27;, &#x27;%0D&#x27;), &#x27;%0A&#x27;, </span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">    </span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"> .= &#x27;&lt;h5&gt;URL Encoded&lt;/h5&gt;&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">    </span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"> .= &#x27;&lt;/p&gt;&#x27; . </span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"> . &#x27;&lt;/p&gt;&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">    </span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"> .= &#x27;&lt;/div&gt;&lt;/div&gt;&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">    </span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"> .= &lt;&lt;&lt;HTML</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&lt;div class=&quot;card-header&quot; style=&quot;margin-top: 20px;&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&lt;h5&gt;Response from gateway&lt;/h5&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&lt;/div&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&lt;div class=&quot;card-body&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"></span><span class="token php language-php string heredoc-string delimiter symbol" style="color:rgb(248, 248, 242)">HTML</span><span class="token php language-php string heredoc-string delimiter symbol punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;pre&gt;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php">  </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">print_r</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;/pre&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php number">65802</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Your transaction requires 3D Secure Authentication&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Store the threeDSRef in a cookie for reuse.  (this is just one way of storeing it)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">setcookie</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">time</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">+</span><span class="token php language-php"> </span><span class="token php language-php number">1500</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ref</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;The threeDSRef now needs to stored be on the merchant side. In this example it&#x27;s being stored to a cookie so it can be retreived after 3DS has called back&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;ThreeDS Ref being stored : </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$ref</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Next a POST request needs to be sent to the 3DS URL provided in the threeDSURL field in the response which is </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSUrl</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> this post request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">    needs to contain the fields provided in the gateways response threeDSRequest field. These fields are &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// For each of the fields in threeDSRequest output a hidden input field with it&#x27;s key/value</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Name : </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">  with a value of </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Along with these fields the threeDSRef from the response is also sent. &lt;/p&gt;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Start of HTML form with URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;form action=\&quot;&quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;\&quot;method=\&quot;post\&quot;&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add threeDSRef from the gateway response</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;input type=&quot;hidden&quot; name=&quot;threeDSRef&quot; value=&quot;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&quot;&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// For each of the fields in threeDSRequest output a hidden input field with it&#x27;s key/value</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;input type=&quot;hidden&quot; name=&quot;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&quot; value=&quot;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&quot;&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;pre&gt;&lt;code&gt;&amp;lt;form action=&quot;https://acs.3ds-pit.com/?method&quot; method=&quot;post&quot;&amp;gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">        &amp;lt;input type=&quot;hidden&quot; name=&quot;threeDSRef&quot; value=&quot;UDNLRVk6dHJhbnNhY3Rpb25JRD0xNTAyNzk0MjgmbWVyY2hhbnRJRD0xMDA4NTYmX19saWZlX189MTY0MzI5Nzk5Mg==&quot;&amp;gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">        &amp;lt;input type=&quot;hidden&quot; name=&quot;threeDSMethodData&quot; value=&quot;eyJ0aHJlZURTTWV0aG9kTm90aWZpY2F0aW9uVVJMIjoiaHR0cDovLzEyNy4wLjAuMTo4MDgwLzNkc3YyLWV4YW1wbGUucGhwPzNkc2NhbGxiYWNrPSZ0aHJlZURTQWNzUmVzcG9uc2U9bWV0aG9kIiwidGhyZWVEU1NlcnZlclRyYW5zSUQiOiIxNGE2YTYyZS0yZjRjLTQxNjYtYWYwYi1jNTJmN2M0ZGFjMjUifQ&quot;&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;code&amp;gt;&amp;lt;input type=&quot;hidden&quot; name=&quot;threeDSRef&quot; value=&quot;UDNLRVk6dHJhbnNhY3Rpb25JRD0xNTAyNzkzNzkmbWVyY2hhbnRJRD0xMDA4NTYmX19saWZlX189MTY0MzI5Nzk2MA==&quot;&amp;gt;&amp;lt;input type=&quot;hidden&quot; name=&quot;threeDSMethodData&quot; value=&quot;eyJ0aHJlZURTTWV0aG9kTm90aWZpY2F0aW9uVVJMIjoiaHR0cDovLzEyNy4wLjAuMTo4MDgwLzNkc3YyLWV4YW1wbGUucGhwPzNkc2NhbGxiYWNrPSZ0aHJlZURTQWNzUmVzcG9uc2U9bWV0aG9kIiwidGhyZWVEU1NlcnZlclRyYW5zSUQiOiJhMzczOTkxMy1kMzdlLTQyZjMtYmFhNC04NjNmOTgwMzMyYzEifQ&quot;&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;code&amp;gt;%3Cform+action%3D%22https%3A%2F%2Facs.3ds-pit.com%2F%3Fmethod%22+method%3D%22post%22%3E%0D%0A%3Cinput+type%3D%22hidden%22+name%3D%22threeDSRef%22+value%3D%22UDNLRVk6dHJhbnNhY3Rpb25JRD0xNTAyNzkwOTEmbWVyY2hhbnRJRD0xMDA4NTYmX19saWZlX189MTY0MzI5Nzc5MQ%3D%3D%22%3E%3Cinput+type%3D%22hidden%22+name%3D%22threeDSMethodData%22+value%3D%22eyJ0aHJlZURTTWV0aG9kTm90aWZpY2F0aW9uVVJMIjoiaHR0cDovLzEyNy4wLjAuMTo4MDgwLzNkc3YyLWV4YW1wbGUucGhwPzNkc2NhbGxiYWNrPSZ0aHJlZURTQWNzUmVzcG9uc2U9bWV0aG9kIiwidGhyZWVEU1NlcnZlclRyYW5zSUQiOiI2MWUzNDJmNC1hZDg2LTQ2YzYtYmMxYy1iYzFiZjIwYWU1NzQifQ%22%3E%0D%0A%3Cinput+type%3D%22submit%22+value%3D%22Continue%22%3E%0D%0A%3C%2Fform%3E&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;&amp;lt;input type=&quot;submit&quot; value=&quot;Continue&quot;&amp;gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">        &amp;lt;/form&amp;gt;&lt;/pre&gt;&lt;/code&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// End of html form with submit button.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">            &lt;/form&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">renderPage</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3DSv2 Test&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Initial request to gateway&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">threeDSCallback</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//ACS Response</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php operator">&lt;&lt;</span><span class="token php language-php operator">&lt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">HTML</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;card&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;card-header&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">           </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">h5</span><span class="token php language-php operator">&gt;</span><span class="token php language-php">Response from </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">ACS</span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">h5</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">div</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;card-body&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">HTML</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;pre&gt;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php">  </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">print_r</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;/pre&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSRequest</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_COOKIE</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// This is the threeDSref store in the cookie from the previous gateway response.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// &lt;-- Note here no fields are hard coded. Whatever is POSTED from 3DS is returned.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send the 3DS response back to the gateway and get the response.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">sendRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">GATEWAY_URL</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Store the new threeDSRef in the cookie again because it may change.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">setcookie</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">time</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">+</span><span class="token php language-php"> </span><span class="token php language-php number">1500</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php operator">&lt;&lt;</span><span class="token php language-php operator">&lt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">HTML</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;card&quot;</span><span class="token php language-php"> style</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;margin-top: 10px&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;card-header&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">           </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">h5</span><span class="token php language-php operator">&gt;</span><span class="token php language-php">Request to gateway</span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">h5</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">div</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;card-body&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">HTML</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;pre&gt;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php">  </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">print_r</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;/pre&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;h5&gt;Url encoded&lt;/h5&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">http_build_query</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Normalise all line endings (CRNL|NLCR|NL|CR) to just NL (%0A)  </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">str_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0D%0A&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0A%0D&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0D&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0A&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php operator">&lt;&lt;</span><span class="token php language-php operator">&lt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">HTML</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;card&quot;</span><span class="token php language-php"> style</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;margin-top: 10px; margin-bottom: 100px&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;card-header&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">         </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">h5</span><span class="token php language-php operator">&gt;</span><span class="token php language-php">Response from gateway</span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">h5</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">div</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;card-body&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">HTML</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;pre&gt;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php">  </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">print_r</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;/pre&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php number">65802</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Your transaction requires 3D Secure Authentication&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Store the threeDSRef in a cookie for reuse.  (this is just one way of storeing it)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">setcookie</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">time</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">+</span><span class="token php language-php"> </span><span class="token php language-php number">500</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ref</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;The threeDSRef now needs to be stored again on the merchant side.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;label&gt;Three DS Ref being stored : </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$ref</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&lt;/label&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Next a POST request needs to be sent to the 3DS URL provided in the threeDSURL field in the response which is </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$threeDSUrl</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> this post request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">    needs to contain the fields provided in the gateways response threeDSRequest field. These fields are &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// For each of the fields in threeDSRequest output a hidden input field with it&#x27;s key/value</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Name : </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">  with a value of </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Start of HTML form with URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;form action=\&quot;&quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;\&quot;method=\&quot;post\&quot;&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add threeDSRef from the gateway response</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;input type=&quot;hidden&quot; name=&quot;threeDSRef&quot; value=&quot;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&quot;&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// For each of the fields in threeDSRequest output a hidden input field with it&#x27;s key/value</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;input type=&quot;hidden&quot; name=&quot;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&quot; value=&quot;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&quot;&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// End of html form with submit button.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">                &lt;/form&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Transaction Complete&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;a href=&quot;?menu&quot; class=&quot;btn btn-primary&quot; role=&quot;button&quot;&gt;Return to menu&lt;/a&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">renderPage</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3DS Callback&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3DS Callback&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">renderPage</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$title</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$body</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$jumotronText</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php operator">&lt;&lt;</span><span class="token php language-php operator">&lt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">HTML</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">!</span><span class="token php language-php">doctype html</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">html lang</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;en&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">head</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">meta charset</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;utf-8&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">meta name</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;viewport&quot;</span><span class="token php language-php"> content</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">meta name</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;description&quot;</span><span class="token php language-php"> content</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">meta name</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;author&quot;</span><span class="token php language-php"> content</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">link rel</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;icon&quot;</span><span class="token php language-php"> href</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;/docs/4.0/assets/img/favicons/favicon.ico&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">title</span><span class="token php language-php operator">&gt;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$title</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">title</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">link rel</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;stylesheet&quot;</span><span class="token php language-php"> href</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">script src</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">script</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">script src</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">script</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">script src</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">script</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">head</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">body</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">div </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;jumbotron text-center&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">h1</span><span class="token php language-php operator">&gt;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$jumotronText</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">h1</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">div</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php">main role</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;main&quot;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php operator">=</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;container&quot;</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$body</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">main</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">body</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php operator">&lt;</span><span class="token php language-php operator">/</span><span class="token php language-php">html</span><span class="token php language-php operator">&gt;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">HTML</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$html</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * Send request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * @param Array $request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * @param String $gatewayURL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * @return Array $responseponse</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">sendRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayURL</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the gateway</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initiate and set curl options to post to the gateway  </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_init</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$gatewayURL</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_setopt</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_setopt</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_POSTFIELDS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">http_build_query</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_setopt</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_HEADER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_setopt</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_FOLLOWLOCATION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_setopt</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_RETURNTRANSFER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send the request and parse the response  </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">parse_str</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_exec</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Close the connection to the gateway  </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_close</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * Sign request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * @param Array $data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * @param String $key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * @return String Hash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">createSignature</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Sort by field name  </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">ksort</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Create the URL encoded signature string  </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">http_build_query</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Normalise all line endings (CRNL|NLCR|NL|CR) to just NL (%0A)  </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">str_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0D%0A&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0A%0D&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0D&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0A&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Hash the signature string and the key together  </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">hash</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SHA512&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-wallet">Gateway Wallet<a class="hash-link" href="#gateway-wallet" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="direct-integration-creating-a-new-gateway-wallet">Direct Integration creating a new Gateway Wallet<a class="hash-link" href="#direct-integration-creating-a-new-gateway-wallet" title="Direct link to heading">​</a></h3><p>Provide card details IF no <code>walletID</code> is provided, if <code>walletID</code> is provided, then no card details can be present. </p><p><code>walletID</code> value will be returned in the response.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Provide card details IF no walletID is provided, if walletID is provided, then no card details can be present. </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//An expiry month of 12 (December) will simulate the non frictionless flow and a challenge will appear to the cardholder.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//CVV needs to be provided even for wallet.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardonfile&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//enables wallet system</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;walletEnabled&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Y&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//stores card in a wallet automatically if a transaction went through, wallet id is returned in callback.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;walletStore&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Y&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Insert walletid below from previous transaction and remove card details (CVV needs to stay).</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Leave blank if no wallet exists yet. walletID value will be returned in the response.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;walletID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1437476&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;This is your walletID&#x27;</span><span class="token php language-php operator">.</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27; &#x27;</span><span class="token php language-php operator">.</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;=&gt;&#x27;</span><span class="token php language-php operator">.</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27; &#x27;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;walletID&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="direct-integration-using-gateway-wallet">Direct Integration using Gateway Wallet<a class="hash-link" href="#direct-integration-using-gateway-wallet" title="Direct link to heading">​</a></h3><p>Providing a <code>walletID</code>will allow you to use a previously used card. A <code>walletID</code> needs to be provided in the request.</p><p>The <code>cardCVV</code> of the stored card is <strong>159</strong>.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//CVV needs to be provided even for wallet.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardonfile&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//enables wallet system</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;walletEnabled&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Y&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//stores card in a wallet automatically if a transaction went through, wallet id is returned in callback.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;walletStore&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Y&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Insert walletid below from previous transaction and remove card details (CVV needs to stay).</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Leave blank if no wallet exists yet. walletID value will be returned in the response.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;walletID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1437476&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;This is your walletID&#x27;</span><span class="token php language-php operator">.</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27; &#x27;</span><span class="token php language-php operator">.</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;=&gt;&#x27;</span><span class="token php language-php operator">.</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27; &#x27;</span><span class="token php language-php operator">.</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;walletID&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="credentials-on-file-cof">Credentials on File (COF)<a class="hash-link" href="#credentials-on-file-cof" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cit---cardholder-opts-to-store-their-card-details-on-merchants-website">(CIT) - Cardholder opts to store their card details on Merchant&#x27;s website.<a class="hash-link" href="#cit---cardholder-opts-to-store-their-card-details-on-merchants-website" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//An expiry month of 12 (December) will simulate the non frictionless flow and a challenge will appear to the cardholder.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardonfile&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cit---cardholder-opts-to-store-their-card-details-provided-to-merchant-via-mail-or-telephone">(CIT) - Cardholder opts to store their card details provided to Merchant via mail or telephone.<a class="hash-link" href="#cit---cardholder-opts-to-store-their-card-details-provided-to-merchant-via-mail-or-telephone" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardonfile&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cit---cardholder-pays-using-a-card-they-previously-stored-on-the-merchants-website">(CIT) - Cardholder pays using a card they previously stored on the Merchant&#x27;s website.<a class="hash-link" href="#cit---cardholder-pays-using-a-card-they-previously-stored-on-the-merchants-website" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardonfile&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//XREF from previously transaction (transaction that initially stored the card)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;22080513FY16RN16LM97FXX&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-on-the-merchants-website">(CIT) - Cardholder provides their card details to sign up to a subscription on the Merchant&#x27;s website.<a class="hash-link" href="#cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-on-the-merchants-website" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//An expiry month of 12 (December) will simulate the non frictionless flow and a challenge will appear to the cardholder.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;recurring&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Recurring Transaction Agreement (recurring) configuration</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtCycleDuration&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtCycleDurationUnit&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;week&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtCycleCount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-on-the-merchants-website">(CIT) - Cardholder provides their card details when agreeing to purchase by instalments on the Merchant&#x27;s website.<a class="hash-link" href="#cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-on-the-merchants-website" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// If ACS response into the IFRAME then redirect back to parent window</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_parent&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Initial request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Gather browser info - can be done at any time prior to the checkout</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">exit</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//An expiry month of 12 (December) will simulate the non frictionless flow and a challenge will appear to the cardholder.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;instalment&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Recurring Transaction Agreement (instalment) configuration</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtCycleDuration&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtCycleDurationUnit&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;week&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtCycleCount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following fields are mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;remoteAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REMOTE_ADDR&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRedirectURL&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;acs=1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field allows options to be passed for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// and the values here are for demonstration purposes only</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSOptions&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAge&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;20220601&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;paymentAccountAgeIndicator&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;05&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add the browser info as it is mandatory for 3DS v2</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">+=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Send request to the ACS server displaying response in an IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render an IFRAME to show the ACS challenge (hidden for fingerprint method)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSMethodData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;display: none;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;iframe name=\&quot;threeds_acs\&quot; style=\&quot;height:420px; width:420px; </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$style</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;&lt;/iframe&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Silently POST the 3DS request to the ACS in the IFRAME</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRequest&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeds_acs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remember the threeDSRef as need it when the ACS responds</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SESSION</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSRef&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Render HTML to silently POST data to URL in target brower window </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">silentPost</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;_self&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$post</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;form id=\&quot;silentPost\&quot; action=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; method=\&quot;post\&quot; target=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$target</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> </span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;noscript&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;Continue\&quot;&gt;&lt;/noscript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> window.setTimeout(&#x27;document.forms.silentPost.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-via-mail-or-telephone-to-the-merchant">(CIT) - Cardholder provides their card details to sign up to a subscription via mail or telephone to the Merchant.<a class="hash-link" href="#cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-via-mail-or-telephone-to-the-merchant" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;recurring&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Recurring Transaction Agreement (recurring) configuration</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtCycleDuration&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtCycleDurationUnit&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;week&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtCycleCount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-via-mail-or-telephone-to-the-merchant">(CIT) - Cardholder provides their card details when agreeing to purchase by instalments via mail or telephone to the Merchant.<a class="hash-link" href="#cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-via-mail-or-telephone-to-the-merchant" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;instalment&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mit---merchantgateway-takes-an-automatic-subscription-payment-at-the-interval-agreed-to-by-the-cardholder">(MIT) - Merchant/Gateway takes an automatic subscription payment at the interval agreed to by the Cardholder.<a class="hash-link" href="#mit---merchantgateway-takes-an-automatic-subscription-payment-at-the-interval-agreed-to-by-the-cardholder" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">9</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;recurring&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//XREF from previously transaction (recurring) </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;22080513FY16RN16LM97FXX&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mit---merchantgateway-makes-an-automatic-instalment-payment-at-the-interval-agreed-to-by-the-cardholder">(MIT) - Merchant/Gateway makes an automatic instalment payment at the interval agreed to by the Cardholder.<a class="hash-link" href="#mit---merchantgateway-makes-an-automatic-instalment-payment-at-the-interval-agreed-to-by-the-cardholder" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">9</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;instalment&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//XREF from previously transaction (instalment)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;22080513FY16RN16LM97FXX&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mit---merchant-makes-an-unscheduled-transaction-such-as-an-account-top-up-as-previously-agreed-with-the-cardholder-when-they-stored-their-card-details">(MIT) - Merchant makes an unscheduled transaction, such as an account top-up, as previously agreed with the Cardholder when they stored their card details.<a class="hash-link" href="#mit---merchant-makes-an-unscheduled-transaction-such-as-an-account-top-up-as-previously-agreed-with-the-cardholder-when-they-stored-their-card-details" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;unscheduled&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//XREF from previously transaction</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;22080513FY16RN16LM97FXX&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mit---merchant-resubmits-a-payment-where-the-initial-payment-was-declined-due-to-insufficient-funds-but-the-goods-have-already-been-provided-to-the-cardholder">(MIT) - Merchant resubmits a payment where the initial payment was declined due to insufficient funds, but the goods have already been provided to the Cardholder.<a class="hash-link" href="#mit---merchant-resubmits-a-payment-where-the-initial-payment-was-declined-due-to-insufficient-funds-but-the-goods-have-already-been-provided-to-the-cardholder" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;resubmission&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//XREF from previously transaction (Declined Transaction)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;22080513NJ17MZ11RJ34QFT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mit---merchant-reauthorises-a-payment-when-the-completion-or-fulfilment-of-the-original-order-or-service-extends-beyond-the-authorization-validity-limit-set-by-the-card-scheme">(MIT) - Merchant reauthorises a payment when the completion or fulfilment of the original order or service extends beyond the authorization validity limit set by the Card Scheme.<a class="hash-link" href="#mit---merchant-reauthorises-a-payment-when-the-completion-or-fulfilment-of-the-original-order-or-service-extends-beyond-the-authorization-validity-limit-set-by-the-card-scheme" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Setup PHP session as use it to store data between 3DS steps</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_GET</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;reauthorisation&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//XREF from previously transaction </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;22080513FY16RN16LM97FXX&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mit---merchant-makes-a-payment-to-process-a-supplemental-account-charge-after-original-services-have-been-rendered-and-respective-payment-has-been-processed">(MIT) - Merchant makes a payment to process a supplemental account charge after original services have been rendered and respective payment has been processed.<a class="hash-link" href="#mit---merchant-makes-a-payment-to-process-a-supplemental-account-charge-after-original-services-have-been-rendered-and-respective-payment-has-been-processed" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;delayedcharges&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//XREF from previously transaction </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;22080513FY16RN16LM97FXX&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mit---merchant-makes-a-payment-to-charge-the-cardholder-a-penalty-according-to-the-merchants-reservation-cancellation-policy">(MIT) - Merchant makes a payment to charge the Cardholder a penalty according to the merchant’s reservation cancellation policy.<a class="hash-link" href="#mit---merchant-makes-a-payment-to-charge-the-cardholder-a-penalty-according-to-the-merchants-reservation-cancellation-policy" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;gateway.php&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">Gateway</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Handpoint Gateway URL</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_start</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Compose current page URL (removing any sid and acs parameters)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">==</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_NAME&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;80&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;:&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SERVER_PORT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/(sid=[^&amp;]+&amp;?)|(acs=1&amp;?)/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$pageUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;?&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;sid=&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">urlencode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">session_id</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_POST</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;threeDSResponse&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Direct Request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">155928</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">2</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">826</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">1999</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;5573471234567898&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryMonth&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">12</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryYear&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">24</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardCVV&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;159&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerName&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Handpoint Test Customer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerAddress&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merevale Avenue Leicester&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;customerPostCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;LE10 2BU&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Test purchase&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;rtAgreementType&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;noshow&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//XREF from previously transaction (initial CIT payment)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;xref&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;22080513FY16RN16LM97FXX&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">   </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// The following field are only required for tbe benefit of the SDK </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">      </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$req</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php class-name class-name-fully-qualified">Exception</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// You should exit gracefully</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">die</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Sorry, the request could not be sent: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$e</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Check the response code</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">Gateway</span><span class="token php language-php operator">::</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Thank you for your payment.&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;p&gt;Failed to take payment: &quot;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$res</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/p&gt;&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">  </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-http-request">Example HTTP Request<a class="hash-link" href="#example-http-request" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-request-http-headers">Transaction Request HTTP Headers<a class="hash-link" href="#transaction-request-http-headers" title="Direct link to heading">​</a></h3><p>The following HTTP headers are sent for transaction request:</p><table><thead><tr><th>HTTP Header</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td>content-type</td><td>Y</td><td>Content type of the request. This must be ‘application/x-www-formurlencoded’, A charset parameter is optional and any non UTF-8 request will be converted to UTF-8.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-response-http-headers">Transaction Response HTTP Headers<a class="hash-link" href="#transaction-response-http-headers" title="Direct link to heading">​</a></h3><p>The following HTTP headers are received for a transaction response:</p><table><thead><tr><th>HTTP Header</th><th>Description</th></tr></thead><tbody><tr><td>Status</td><td>HTTP status header. Possible value are:<br>200 – Transaction request processed<br>500 – Internal Server Error<br>503 – Service Temporarily Unavailable</td></tr><tr><td>content-type</td><td>Content type of the response. This will be ‘text/html’</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="submission-example">Submission Example<a class="hash-link" href="#submission-example" title="Direct link to heading">​</a></h3><p>The following shows an example of a transaction request:</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">POST /direct/ HTTP/1.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Host: gateway.example.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Accept: */*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Content-Length: 397</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">merchantID=100001&amp;action=SALE&amp;type=1&amp;currencyCode=826&amp;countryCode=826&amp;amount=680&amp;transactionUnique=5de65b552499</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">e&amp;orderRef=Test+Transaction&amp;cardNumber=4929+4212+3460+0821&amp;cardCVV=356&amp;cardExpiryDate=1219&amp;threeDSRequired=N&amp;av</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">scv2CheckRequired=N&amp;duplicateDelay=0&amp;signature=06b01e06c8fc761943d676d5f3aa2e9264758fed72e7bcb058a2a35cf23e8e45</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">403099537bb0363054d6bc8ea951ce1ad86e582dbf0b435855b9c97507fcf844 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The following shows an example of a transaction response:</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Date: Tue, 01 Jan 2019 09:30:45 GMT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server: Apache/2.4.23 (Win64) OpenSSL/1.0.2k-fips PHP/5.4.12</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Vary: Host</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">X-Powered-By: PHP/5.4.12</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Content-Length: 2449</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Content-Type: text/html</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">merchantID=100001&amp;threeDSEnabled=Y&amp;avscv2CheckEnabled=Y&amp;riskCheckEnabled=N&amp;caEnabled=Y&amp;rtsEnabled=Y&amp;cftEnabled=Y&amp;threeDSCheckPref=not+known%2Cnot+checked%2Cauthenticated%2Cattempted+authentication&amp;cv2CheckPref=matched&amp;addressCheckPref=not+known%2Cnot+checked%2Cmatched%2Cpartially+matched&amp;postcodeCheckPref=not+known%2Cnot+checked%2Cmatched%2Cpartially+matched&amp;cardCVVMandatory=Y&amp;riskCheckPref=not+known%3Dfinished%2Cnot+checked%3Ddecline2%2Capprove%3Dcontinue%2Cdecline%3Ddecline1%2Creview%3Ddecline2%2Cescalate%3Dfinished&amp;notifyEmail=an.operator%40merchant.com&amp;customerReceiptsRequired=Y&amp;merchantCategoryCode=6013&amp;surchargeEnabled=Y&amp;surchargeRequired=N&amp;surchargeRules%5B0%5D%5BcardType%5D=CC&amp;surchargeRules%5B0%5D%5Bsurcharge%5D=10.1235&amp;surchargeRules%5B1%5D%5BcardType%5D=CC&amp;surchargeRules%5B1%5D%5Bcurrency%5D=GBP&amp;surchargeRules%5B1%5D%5Bsurcharge%5D=2.5000&amp;surchargeRules%5B2%5D%5BcardType%5D=VC&amp;surchargeRules%5B2%5D%5Bsurcharge%5D=3.5000&amp;surchargeRules%5B3%5D%5BcardType%5D=VC&amp;surchargeRules%5B3%5D%5Bcurrency%5D=GBP&amp;surchargeRules%5B3%5D%5Bsurcharge%5D=4.5000&amp;surchargeRules%5B4%5D%5BcardType%5D=DD&amp;surchargeRules%5B4%5D%5Bsurcharge%5D=5.5000&amp;action=SALE&amp;type=1¤cyCode=826&amp;countryCode=826&amp;amount=680&amp;transactionUnique=5de65b552499e&amp;orderRef=Test+Transaction&amp;cardExpiryDate=1219&amp;threeDSRequired=N&amp;avscv2CheckRequired=N&amp;duplicateDelay=0&amp;requestID=5de65b562496f&amp;responseCode=0&amp;responseMessage=AUTHCODE%3A347414&amp;state=captured&amp;requestMerchantID=100001&amp;processMerchantID=100001&amp;paymentMethod=card&amp;cardType=Visa+Credit&amp;cardTypeCode=VC&amp;cardScheme=Visa+&amp;cardSchemeCode=VC&amp;cardIssuer=BARCLAYS+BANK+PLC&amp;cardIssuerCountry=United+Kingdom&amp;cardIssuerCountryCode=GBR&amp;cardFlags=8323072&amp;cardNumberMask=492942%2A%2A%2A%2A%2A%2A0821&amp;cardNumberValid=Y&amp;xref=19120312NG55CM51QH35JRL&amp;cardExpiryMonth=12&amp;cardExpiryYear=19&amp;authorisationCode=347414&amp;transactionID=10018201&amp;responseStatus=0×tamp=2019-12-03+12%3A55%3A52&amp;amountApproved=680&amp;amountReceived=680&amp;amountRetained=680&amp;avscv2ResponseCode=244100&amp;avscv2ResponseMessage=SECURITY+CODE+MATCH+ONLY&amp;avscv2AuthEntity=merchant+host&amp;cv2Check=matched&amp;addressCheck=not+matched&amp;postcodeCheck=not+matched&amp;notifyEmailResponseCode=0&amp;notifyEmailResponseMessage=Email+successfully+queued&amp;vcsResponseCode=0&amp;vcsResponseMessage=Success+-+no+velocity+check+rules+applied&amp;currencyExponent=2&amp;signature=e5c65e5d0340e0ec0de8782affcb6caba2e4d202a6873a1677ddbf6415cb1dd52cc597e43c758b233afd121367d300a57d0faade7abf6b4b88a1a1b974e55d33 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-integration-library">Gateway Integration Library<a class="hash-link" href="#gateway-integration-library" title="Direct link to heading">​</a></h2><p>A simple server-side integration library is available to simplify the preparation and transmission of Hosted and Direct Integration requests.</p><p>The library is available in many popular programming languages and is based around a single class: the Gateway class. Below is the PHP version of the library but checkout the <a href="https://github.com/handpoint" target="_blank" rel="noopener noreferrer">Handpoint Github</a> website to download libraries in C#, Java, Perl, Python, NodeJs, Ruby and Swift. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="library-namespace">Library Namespace<a class="hash-link" href="#library-namespace" title="Direct link to heading">​</a></h3><p>To avoid polluting the global namespace, the library uses the ‘P3/SDK’ namespace where supported by the language.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-configuration">Gateway Configuration<a class="hash-link" href="#gateway-configuration" title="Direct link to heading">​</a></h3><p>Before you can use the Gateway class, you will need to configure the following properties to match your integration parameters: </p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>hostedURL</td><td>string</td><td>Absolute URL provided for the Hosted Integration.</td></tr><tr><td>directURL</td><td>string</td><td>Absolute URL provided for the Direct Integration.</td></tr><tr><td>merchantID</td><td>string</td><td>Your unique Merchant ID to be passed in the <code>merchantID</code> integration field.</td></tr><tr><td>merchantPwd</td><td>string</td><td>Any password configured on your Merchant Account</td></tr><tr><td>merchantSecret</td><td>string</td><td>Any secret configured on your Merchant Account</td></tr><tr><td>proxyUrl</td><td>string</td><td>Absolute URL to any proxy required for connections</td></tr><tr><td>debug</td><td>boolean</td><td>True to enable debugging output</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-methods">Gateway Methods<a class="hash-link" href="#gateway-methods" title="Direct link to heading">​</a></h3><p>The following methods are made available by the <code>Gateway</code> class:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="string-hostedrequestmixed-request-string-options"><code>string hostedRequest(mixed[] request, string[] options)</code><a class="hash-link" href="#string-hostedrequestmixed-request-string-options" title="Direct link to heading">​</a></h4><p>Return an HTML fragment that can be included in your webpage to render a <code>&lt;form&gt;</code> which will send the provided request data to the Gateway’s Hosted Integration when submitted.</p><p>The request parameter should be an associative array containing the request fields required to be sent. The request fields are not validated.</p><p>The following class properties are used unless alternative values are provided in the <code>request</code> array: <code>directUrl</code>, <code>merchantID</code>, <code>merchantPwd</code>, <code>merchantSecret</code>.</p><p>The <code>options</code> parameter is an optional associative array containing options that can be used to modify the returned HTML fragment as follows:</p><ul><li>formAttrs – string containing additional attributes to include in the form tag.</li><li>submitAttrs – string containing additional attributes to include in the submit button tag.</li><li>submitImage – string containing the URL to use as the submit button.</li><li>submitHtml – string containing HTML to use as the label on the submit <code>&lt;button&gt;</code>.</li><li>submitText – string containing text to use as the label on the submit <code>&lt;input&gt;</code>.</li></ul><p>The <code>submitImage</code>, <code>submitHtml</code> and <code>submitText</code> options are mutually exclusive and will be checked for in that order. If none is provided, then a <code>submitText</code> value of ‘Pay Now&#x27; is assumed.</p><p>If a <code>merchantSecret</code> is provided, then the method will add the correct signature field to the request.</p><p>An exception is thrown if the HTML fragment cannot be composed.</p><p>The <code>verifyResponse()</code> method can be used to validate and decode any response POSTed back to your website.</p><p>Returns a string containing the HTML fragment if successful; throws an exception otherwise.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mixed-directrequestmixed-request-string-options"><code>mixed[] directRequest(mixed[] request, string[] options)</code><a class="hash-link" href="#mixed-directrequestmixed-request-string-options" title="Direct link to heading">​</a></h4><p>Return the response received when sending the provided request to the Gateway’s Direct Integration.</p><p>The <code>request</code> parameter should be an associative array containing the request fields required to be sent. The request fields are not validated.</p><p>The following class properties are used unless alternative values are provided in the request array: <code>directUrl</code>, <code>merchantID</code>, <code>merchantPwd</code>, <code>merchantSecret</code>.</p><p>The <code>options</code> parameter is not used and reserved for future use.</p><p>If a <code>merchantSecret</code> is provided, then the method will add the correct signature field to the request and check the <code>signature</code> field on the response.</p><p>An exception is thrown if the request cannot be sent; or the response cannot be received; or if the response’s signature is incorrect.</p><p>Returns an associative array containing the received response fields; otherwise, throws an exception.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-preparerequestmixed-request-string-options-string-secret-string-direct_url-string-hosted_url"><code>void prepareRequest(mixed[] &amp;request, string[] &amp;options, string &amp;secret, string &amp;direct_url, string &amp;hosted_url)</code><a class="hash-link" href="#void-preparerequestmixed-request-string-options-string-secret-string-direct_url-string-hosted_url" title="Direct link to heading">​</a></h4><p>Prepare a request for sending to the Gateway’s Direct Integration.</p><p>The <code>request</code> parameter should be a reference to an associative array containing the request fields required to be sent. The request fields are not validated.</p><p>The <code>merchantSecret</code>, <code>directUrl</code> and <code>hostedUrl</code> configuration properties will be returned in the <code>secret</code>, <code>direct_url</code> and <code>hosted_url</code> method parameters. These properties can be overridden by providing them in the request, in which case they will be extracted and removed from the request.</p><p>The <code>merchantID</code> and <code>merchantPwd</code> configuration properties will be added to the request.</p><p>A few known Gateway response fields will be removed from the request, if present, to avoid confusion, notably the <code>responseCode</code>, <code>responseMessage</code>, <code>responseStatus</code>, <code>state</code> fields.</p><p>An exception will be thrown if the request does not contain an action element or a merchantID element (and none could be inserted).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-verifyresponsemixed-response-string-secret"><code>void verifyResponse(mixed[] &amp;response, string secret)</code><a class="hash-link" href="#void-verifyresponsemixed-response-string-secret" title="Direct link to heading">​</a></h4><p>Verify a response received from the Gateway’s Hosted or Direct Integration.</p><p>The <code>response</code> parameter should be a reference to an associative array containing the response received from the Gateway, either from the Direct Integration or as POSTed from the Hosted Integration.</p><p>The <code>secret</code> parameter should be any Merchant secret to use when checking the response’s <code>signature</code> element. If not provided, then the value of the <code>merchantSecret</code> property is used.</p><p>Any <code>signature</code> element is removed from the response.</p><p>An exception is thrown if the response is not valid, does not contain a <code>responseCode</code> element or its <code>signature</code> is incorrect.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="string-signmixed-request-string-secret-mixed-partial--false"><code>string sign(mixed[] request, string secret, mixed partial = false)</code><a class="hash-link" href="#string-signmixed-request-string-secret-mixed-partial--false" title="Direct link to heading">​</a></h4><p>Return the signature for the provided request data.</p><p>The <code>request</code> parameter should be a reference to an associative array containing the request fields required to be sent. The request fields are not validated.</p><p>The <code>secret</code> parameter should be the Merchant secret to use when signing the request.</p><p>The <code>partial</code> parameter should be either the boolean <code>false</code> or comma separated string; or an array of strings containing the names of the request elements to sign.</p><p>Returns a string containing the correct signature for the request.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-library-php">Gateway Library (PHP)<a class="hash-link" href="#gateway-library-php" title="Direct link to heading">​</a></h3><p>The gateway.php file contains the main body of the SDK.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> * Class to communicate with Payment Gateway</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)"> */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">P3</span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">SDK</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token php language-php"> </span><span class="token php language-php package punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token php language-php package">InvalidArgumentException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name">Gateway</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @var string  Gateway Hosted API Endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$hostedUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/hosted/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @var string  Gateway Direct API Endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://commerce-api.handpoint.com/direct/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @var string  Merchant Account Id or Alias</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantID</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;100001&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @var string  Password for above Merchant Account</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantPwd</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @var string  Secret for above Merchant Account</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Circle4Take40Idea&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @var string  Proxy URL if required (eg. &#x27;https://www.proxy.com:3128&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$proxyUrl</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @var boolean Enable debugging</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$debug</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Useful response codes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_SUCCESS</span><span class="token php language-php">                        </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php number">0</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Transaction successful</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_DO_NOT_HONOR</span><span class="token php language-php">                   </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php number">5</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Transaction declined</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_NO_REASON_TO_DECLINE</span><span class="token php language-php">           </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php number">85</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php">   </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Verification successful</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">RC_3DS_AUTHENTICATION_REQUIRED</span><span class="token php language-php">    </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php number">0x1010A</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Send request to Gateway using HTTP Direct API.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will send a request to the Gateway using the HTTP Direct API.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The request will use the following Gateway properties unless alternative</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * values are provided in the request;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;directUrl&#x27;      - Gateway Direct API Endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;merchantID&#x27;     - Merchant Account Id or Alias</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;merchantPwd&#x27;    - Merchant Account Password (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;merchantSecret&#x27; - Merchant Account Secret (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will {@link sign() sign} the request and also {@link</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * verifySignature() check the signature} on any response.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will throw an exception if it is unable to send the request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * or receive the response.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method does not attempt to validate any request fields.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will attempt to send the request using the PHP cURL extension</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * or failing that the  PHP http stream wrappers. If neither are available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * then an exception will be thrown.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   array   $request    request data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   array   $options    options (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @return  array               request response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @throws  InvalidArgumentException    invalid request data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @throws  RuntimeException            communications failure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">directRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">debug</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">__METHOD__</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;() - args=&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">func_get_args</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">prepareRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$direct_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$hosted_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Sign the request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;signature&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">sign</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">function_exists</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;curl_init&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$opts</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_POST</span><span class="token php language-php">            </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_POSTFIELDS</span><span class="token php language-php">      </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">http_build_query</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_HEADER</span><span class="token php language-php">          </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_FAILONERROR</span><span class="token php language-php">     </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_FOLLOWLOCATION</span><span class="token php language-php">  </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_RETURNTRANSFER</span><span class="token php language-php">  </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_USERAGENT</span><span class="token php language-php">       </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_USER_AGENT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">CURLOPT_PROXY</span><span class="token php language-php">           </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$proxyUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_init</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$direct_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_init</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$direct_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Failed to initialise communications with Payment Gateway&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_setopt_array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$opts</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php keyword type-declaration" style="color:rgb(189, 147, 249);font-style:italic">false</span><span class="token php language-php"> </span><span class="token php language-php operator">||</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_exec</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$err</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_error</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">curl_close</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ch</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Failed to communicate with Payment Gateway: &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$err</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">ini_get</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;allow_url_fopen&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$opts</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;method&#x27;</span><span class="token php language-php">        </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;POST&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;user_agent&#x27;</span><span class="token php language-php">    </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_USER_AGENT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;proxy&#x27;</span><span class="token php language-php">         </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$proxyUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;header&#x27;</span><span class="token php language-php">        </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Content-Type: application/x-www-form-urlencoded&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;content&#x27;</span><span class="token php language-php">       </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">http_build_query</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;timeout&#x27;</span><span class="token php language-php">       </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php number">5</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$context</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">stream_context_create</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$opts</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">file_get_contents</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$direct_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$context</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Failed to send request to Payment Gateway&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;No means of communicate with Payment Gateway, please enable CURL or HTTP Stream Wrappers&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;No response from Payment Gateway&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">parse_str</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">verifyResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">debug</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">__METHOD__</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;() - ret=&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Send request to Gateway using HTTP Hosted API.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will send a request to the Gateway using the HTTP Hosted API.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The request will use the following Gateway properties unless alternative</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * values are provided in the request;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;hostedUrl&#x27;      - Gateway Hosted API Endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;merchantID&#x27;     - Merchant Account Id or Alias</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;merchantPwd&#x27;    - Merchant Account Password (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;merchantSecret&#x27; - Merchant Account Secret (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method accepts the following options;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;formAttrs&#x27;      - HTML form attributes string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;formHtml&#x27;       - HTML to show inside the form</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;submitAttrs&#x27;    - HTML submit button attributes string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;submitImage&#x27;    - URL of image to use as the Submit button</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;submitHtml&#x27;     - HTML to show on the Submit button</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;submitText&#x27;     - Text to show on the Submit button</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * &#x27;submitImage&#x27;, &#x27;submitHtml&#x27; and &#x27;submitText&#x27; are mutually exclusive</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * options and will be checked for in that order. If none are provided</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * the submitText=&#x27;Pay Now&#x27; is assumed.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will {@link sign() sign} the request, to allow for submit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * button images etc. partial signing will be used.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method returns the HTML fragment that needs including in order to</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * send the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will throw an exception if it is unable to send the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method does not attempt to validate any request fields.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * If the request doesn&#x27;t contain a &#x27;redirectURL&#x27; element then one will be</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * added which redirects the response to the current script.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Any response can be {@link verifyResponse() verified} using the following</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * PHP code;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * &lt;code&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *     \P3\SDK\Gateway::verifyResponse($_POST);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * } catch(\Exception $e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *     die($e-&gt;getMessage());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * &lt;/code&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   array   $request    request data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   array   $options    options (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @return  string              request HTML form.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @throws  InvalidArgumentException    invalid request data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">hostedRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">debug</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">__METHOD__</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;() - args=&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">func_get_args</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">prepareRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$direct_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$hosted_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;redirectURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;redirectURL&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTPS&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;on&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;https://&#x27;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;http://&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_HOST&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;REQUEST_URI&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;signature&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">sign</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;form method=&quot;post&quot; &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;formAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;formAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27; action=&quot;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$hosted_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">ENT_COMPAT</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;UTF-8&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;\&quot;&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;formHtml&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;formHtml&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitImage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;input &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27; type=&quot;image&quot; src=&quot;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitImage&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">ENT_COMPAT</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;UTF-8&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;\&quot;&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitHtml&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;button type=&quot;submit&quot; &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&gt;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string double-quoted-string interpolation string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitHtml&#x27;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&lt;/button&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&lt;input &#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27; type=&quot;submit&quot; value=&quot;&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitText&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;submitText&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">ENT_COMPAT</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;UTF-8&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Pay Now&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;\&quot;&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;/form&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">debug</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">__METHOD__</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;() - ret=&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Prepare a request for sending to the Gateway.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will extract the following configuration properties from the</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * request if they are present;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;merchantSecret&#x27; - Merchant Account Secret (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;directUrl&#x27;      - Gateway Direct API Endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;hostedUrl&#x27;      - Gateway Hosted API Endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will insert the following configuration properties into the</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * request if they are not already present;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;merchantID&#x27;     - Merchant Account Id or Alias</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;merchantPwd&#x27;    - Merchant Account Password (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will throw an exception if the request doesn&#x27;t contain an</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * &#x27;action&#x27; element or a &#x27;merchantID&#x27; element (and none could be inserted).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method does not attempt to validate any request fields.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   array   $request    request data (input &amp; return)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   array   $options    options (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   string  $secret     any extracted &#x27;merchantSecret&#x27; (return)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   string  $direct_url any extracted &#x27;directUrl&#x27; (return)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   string  $hosted_url any extracted &#x27;hostedUrl&#x27; (return)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @return  void</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @throws  InvalidArgumentException    invalid request data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">prepareRequest</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword type-declaration" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$direct_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$hosted_url</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">InvalidArgumentException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Request must be provided.&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">InvalidArgumentException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Request must contain an \&#x27;action\&#x27;.&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Insert &#x27;merchantID&#x27; if doesn&#x27;t exist and default is available</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantID</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantID</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Insert &#x27;merchantPwd&#x27; if doesn&#x27;t exist and default is available</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantPwd&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantPwd</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantPwd&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantPwd</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// A &#x27;merchantID&#x27; must be set</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">empty</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">InvalidArgumentException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Merchant ID or Alias must be provided.&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">array_key_exists</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantSecret&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantSecret&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">unset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantSecret&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">array_key_exists</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;hostedUrl&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$hosted_url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;hostedUrl&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">unset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;hostedUrl&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$hosted_url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$hostedUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">array_key_exists</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;directUrl&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$direct_url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;directUrl&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">unset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;directUrl&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$direct_url</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$directUrl</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Remove items we don&#x27;t want to send in the request</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// (they may be there if a previous response is sent)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">array_diff_key</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$request</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseMessage&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseStatus&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;state&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;signature&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantAlias&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID2&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Verify the any response.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * This method will verify that the response is present, contains a response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * code and is correctly signed.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * If the response is invalid then an exception will be thrown.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Any signature is removed from the passed response.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   array   $data       reference to the response to verify</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   string  $secret     secret to use in signing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @return  boolean             true if signature verifies</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">verifyResponse</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword type-declaration" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php"> </span><span class="token php language-php operator">||</span><span class="token php language-php"> </span><span class="token php language-php operator">!</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Invalid response from Payment Gateway&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$merchantSecret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;signature&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;signature&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">unset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;signature&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">strpos</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;|&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">!==</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">list</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">explode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;|&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// We display three suitable different exception messages to help show</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// secret mismatches between ourselves and the Gateway without giving</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// too much away if the messages are displayed to the Cardholder.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php operator">!</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Signature present when not expected (Gateway has a secret but we don&#x27;t)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Incorrectly signed response from Payment Gateway (1)&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php operator">!</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Signature missing when one expected (We have a secret but the Gateway doesn&#x27;t)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Incorrectly signed response from Payment Gateway (2)&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php"> </span><span class="token php language-php operator">&amp;&amp;</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">sign</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$fields</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">!==</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Signature mismatch</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">RuntimeException</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Incorrectly signed response from Payment Gateway&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">settype</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$response</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;responseCode&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;integer&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Sign the given array of data.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * This method will return the correct signature for the data array.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * If the secret is not provided then any {@link static::$merchantSecret</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * default secret} is used.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The partial parameter is used to indicate that the signature should</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * be marked as &#x27;partial&#x27; and can take three possible value types as</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * follows;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + boolean  - sign with all $data fields</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + string   - comma separated list of $data field names to sign</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + array    - array of $data field names to sign</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   array   $data       data to sign</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   string  $secret     secret to use in signing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   mixed   $partial    partial signing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @return  string              signature</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">sign</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">false</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Support signing only a subset of the data fields</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">is_string</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">explode</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;,&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">is_array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">array_intersect_key</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">array_flip</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">join</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;,&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">array_keys</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Sort the data in ascending ascii key order</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">ksort</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Convert to a URL encoded string</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">http_build_query</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Normalise all line endings (CRNL|NLCR|NL|CR) to just NL (%0A)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/%0D%0A|%0A%0D|%0D/i&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0A&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Hash the string and secret together</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">hash</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SHA512&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$secret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Mark as partially signed if required</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;|&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$partial</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Collect browser device information.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will return a self submitting HTML form designed to provided</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * the browser device details in the following integration fields;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;deviceChannel&#x27;          - Fixed value &#x27;browser&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;deviceIdentity&#x27;         - Browser&#x27;s UserAgent string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;deviceTimeZone&#x27;         - Browser&#x27;s timezone</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;deviceCapabilities&#x27;     - Browser&#x27;s capabilities</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;deviceScreenResolution&#x27; - Browser&#x27;s screen resolution (widthxheightxcolour-depth)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;deviceAcceptContent&#x27;    - Browser&#x27;s accepted content types</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;deviceAcceptEncoding&#x27;   - Browser&#x27;s accepted encoding methods</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;deviceAcceptLanguage&#x27;   - Browser&#x27;s accepted languages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;deviceAcceptCharset&#x27;    - Browser&#x27;s accepted character sets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The above fields will be submitted as child elements of a &#x27;browserInfo&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * parent field.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method accepts the following options;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;formAttrs&#x27;      - HTML form attributes string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *   + &#x27;formData&#x27;       - associative array of additional post data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method returns the HTML fragment that needs including in order to</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * render the HTML form.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The browser must suport JavaScript in order to obtain the details and</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * submit the form.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   array   $options    options (or null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @return  string              request HTML form.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @throws  InvalidArgumentException    invalid request data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">collectBrowserInfo</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword type-hint" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">debug</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">__METHOD__</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;() - args=&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">func_get_args</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$form_attrs</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;id=&quot;collectBrowserInfo&quot; method=&quot;post&quot; action=&quot;?&quot;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;formAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$form_attrs</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;formAttrs&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$device_data</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceChannel&#x27;</span><span class="token php language-php">             </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browser&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceIdentity&#x27;</span><span class="token php language-php">            </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_USER_AGENT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_USER_AGENT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php class-name return-type">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceTimeZone&#x27;</span><span class="token php language-php">            </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;0&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceCapabilities&#x27;</span><span class="token php language-php">        </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceScreenResolution&#x27;</span><span class="token php language-php">    </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1x1x1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceAcceptContent&#x27;</span><span class="token php language-php">       </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php class-name return-type">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceAcceptEncoding&#x27;</span><span class="token php language-php">      </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_ENCODING&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_ENCODING&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php class-name return-type">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceAcceptLanguage&#x27;</span><span class="token php language-php">      </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_LANGUAGE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_LANGUAGE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php class-name return-type">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;deviceAcceptCharset&#x27;</span><span class="token php language-php">       </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_CHARSET&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$_SERVER</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;HTTP_ACCEPT_CHARSET&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php class-name return-type">null</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$form_fields</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;browserInfo&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$device_data</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">isset</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;formData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword type-casting" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$options</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;formData&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$form_fields</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string heredoc-string delimiter symbol punctuation" style="color:rgb(248, 248, 242)">&lt;&lt;&lt;</span><span class="token php language-php string heredoc-string delimiter symbol" style="color:rgb(248, 248, 242)">EOS</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">            &lt;form </span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$form_attrs</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                </span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string heredoc-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$form_fields</span><span class="token php language-php string heredoc-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">            &lt;/form&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">            &lt;script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                var screen_depths = [1, 4, 8, 15, 16, 24, 32, 48];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                var screen_width = (window &amp;&amp; window.screen ? window.screen.width : &#x27;0&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                var screen_height = (window &amp;&amp; window.screen ? window.screen.height : &#x27;0&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                var screen_depth = (window &amp;&amp; window.screen &amp;&amp; window.screen.colorDepth &amp;&amp; screen_depths.indexOf(window.screen.colorDepth) &gt;= 0 ? window.screen.colorDepth : &#x27;0&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                var identity = (window &amp;&amp; window.navigator ? window.navigator.userAgent : &#x27;&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                var language = (window &amp;&amp; window.navigator ? (window.navigator.language ? window.navigator.language : window.navigator.browserLanguage) : &#x27;&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                var timezone = (new Date()).getTimezoneOffset();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                var java = (window &amp;&amp; window.navigator ? navigator.javaEnabled() : false);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                var fields = document.forms.collectBrowserInfo.elements;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                fields[&#x27;browserInfo[deviceIdentity]&#x27;].value = identity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                fields[&#x27;browserInfo[deviceTimeZone]&#x27;].value = timezone;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                fields[&#x27;browserInfo[deviceCapabilities]&#x27;].value = &#x27;javascript&#x27; + (java ? &#x27;,java&#x27; : &#x27;&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                fields[&#x27;browserInfo[deviceAcceptLanguage]&#x27;].value = language;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                fields[&#x27;browserInfo[deviceScreenResolution]&#x27;].value = screen_width + &#x27;x&#x27; + screen_height + &#x27;x&#x27; + screen_depth;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">                window.setTimeout(&#x27;document.forms.collectBrowserInfo.submit()&#x27;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)">            &lt;/script&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php string heredoc-string" style="color:rgb(255, 121, 198)"></span><span class="token php language-php string heredoc-string delimiter symbol" style="color:rgb(248, 248, 242)">EOS</span><span class="token php language-php string heredoc-string delimiter symbol punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">debug</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">__METHOD__</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;() - ret=&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Return the field name and value as HTML input tags.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will return a string containing one or more HTML &lt;input</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * type=&quot;hidden&quot;&gt; tags which can be used to store the name and value.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   string      $name       field name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   mixed       $value      field value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @return  string                  HTML containing &lt;INPUT&gt; tags</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">is_array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$n</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$v</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">fieldToHtml</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;[&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$n</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;]&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$v</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">// Convert all applicable characters or none printable characters to HTML entities</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">preg_replace_callback</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;/[\x00-\x1f]/&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$matches</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;#&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">ord</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$matches</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token php language-php number">0</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">htmlentities</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:rgb(189, 147, 249)">ENT_COMPAT</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;UTF-8&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$name</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; value=\&quot;</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php string double-quoted-string interpolation variable" style="color:rgb(189, 147, 249);font-style:italic">$value</span><span class="token php language-php string double-quoted-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">\&quot; /&gt;\n&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$ret</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * Display debug message into PHP error log.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * The method will write the arguments into the PHP error log if</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * the {@link $debug} property is true. Any none string arguments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * will be {@link \var_export() formatted}.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @param   mixed       ...         value to debug</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     * @return  void</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php comment" style="color:rgb(98, 114, 164)">     */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:rgb(80, 250, 123)">debug</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword static-context" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token php language-php operator">::</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$debug</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$msg</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">func_get_args</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$arg</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$msg</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php function" style="color:rgb(80, 250, 123)">is_string</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$arg</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">?</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$arg</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">var_export</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$arg</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:rgb(189, 147, 249)">true</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php"> </span><span class="token php language-php operator">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27; &#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">            </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">error_log</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$msg</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a class="hash-link" href="#testing" title="Direct link to heading">​</a></h2><p>You will be provided with unique test Merchant Account IDs during the onboarding process. Refer to the <a href="/directintegration/overview#authentication">authentication</a> section for the list of required parameters. Test Merchant Accounts are connected to a Simulator and not to an actual Acquirer. The Simulator will emulate the function of an Acquirer and provide simulated responses and authorisation codes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-amounts">Test Amounts<a class="hash-link" href="#test-amounts" title="Direct link to heading">​</a></h3><p>When testing the transaction amount can be used to trigger different authorisation and settlement outcomes as follows:</p><table><thead><tr><th>Min. Amount</th><th>Max. Amount</th><th>Authorisation response</th><th>Settlement outcome</th></tr></thead><tbody><tr><td>100 (1.00)</td><td>2499 (24.99)</td><td>(0) AUTH CODE: XXXXXX</td><td>ACCEPTED</td></tr><tr><td>2500 (25.00)</td><td>4999 (49.99)</td><td>(0) AUTH CODE: XXXXXX</td><td>REJECTED</td></tr><tr><td>5000 (50.00)</td><td>7499 (74.99)</td><td>(1) CARD REFERRED <br> (0) AUTH CODE: XXXXXX</td><td>ACCEPTED</td></tr><tr><td>7500 (75.00)</td><td>9999 (99.99)</td><td>(1) CARD REFERRED <br> (0) AUTH CODE: XXXXXX</td><td>REJECTED</td></tr><tr><td>10000 (100.00)</td><td>14999 (49.99)</td><td>(5) CARD DECLINED</td><td>N/A</td></tr><tr><td>15000 (150.00)</td><td>19999 (199.99)</td><td>(4) CARD DECLINED – KEEP CARD</td><td>N/A</td></tr><tr><td>20000 (200.00)</td><td>24999 (249.99)</td><td>(65) CARD DECLINED - SCA REQUIRED <br> (0) AUTH CODE: XXXXXX</td><td>ACCEPTED</td></tr><tr><td>25000 (250.00)</td><td>29999 (299.99)</td><td>(65) CARD DECLINED – SCA REQUIRED <br>  (5) CARD DECLINED</td><td>N/A</td></tr></tbody></table><p>Any other amount will return a <code>responseCode</code> of 66311 (Invalid Test Amount).</p><p>The settlement outcome only applies to transactions which reach settlement due to being successfully authorised and captured and not cancelled. The amount captured is used when determining the settlement outcome rather than the amount authorised.</p><p>The range 5000 to 9999 can be used to test manual authorisations. If the transaction does not contain an <code>authorisationCode</code> request field, then the Simulator will return a <code>responseCode</code> of 1 (CARD REFERRED). If it does, then it will return a <code>responseCode</code> of 0 (SUCCESS), with an amount between 50000 and 7499 being accepted at settlement and an amount of 7500 to 9999 being rejected.</p><p>The range 20000 to 29999 can be used to test secure customer authentication (SCA) soft declines. If the transaction is eligible to request SCA then the Simulator will return a <code>responseCode</code> of 65 (SCA REQUIRED). If not, then it will return a <code>responseCode</code> of 0 (SUCCESS) for the range 20000 to 24999 or 5 (DO NOT HONOR) for the range 25000 to 29999. Successful transactions will be approved at settlement.</p><p>Note: SCA exemptions are not supported by the simulator and so cannot be used to request that SCA is not required.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testCards">Test Cards<a class="hash-link" href="#testCards" title="Direct link to heading">​</a></h3><p>The test accounts will only accept card numbers that are designated for test purposes. These test cards cannot be used on production accounts.</p><p>To test AVS and CV2 verification then the associated CVV and billing addresses are provided for each card. If a different value is used, then the Simulator will mark the responses as ‘not matched’.</p><p><strong>Unless stated otherwise an expiry date sometime in the near future should be used.</strong></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="visa-credit">Visa Credit<a class="hash-link" href="#visa-credit" title="Direct link to heading">​</a></h4><table><thead><tr><th>Card Number</th><th>CVV</th><th>Address</th></tr></thead><tbody><tr><td>4929421234600821</td><td>356</td><td>Flat 6 Primrose Rise<br> 347 Lavender Road <br>Northampton <br> NN17 8YG</td></tr><tr><td>4543059999999982</td><td>110</td><td>76 Roseby Avenue<br> Manchester <br>M63X 7TH</td></tr><tr><td>4543059999999990</td><td>689</td><td>23 Rogerham Mansions<br>4578 Ermine Street<br> Borehamwood <br> WD54 8TH</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="visa-debit">Visa Debit<a class="hash-link" href="#visa-debit" title="Direct link to heading">​</a></h4><table><thead><tr><th>Card Number</th><th>CVV</th><th>Address</th></tr></thead><tbody><tr><td>4539791001730106</td><td>289</td><td>Unit 5 Pickwick Walk<br>120 Uxbridge Road Hatch End<br>Middlesex<br>HA6 7HJ</td></tr><tr><td>4462000000000003</td><td>672</td><td>Mews 57<br>Ladybird Drive<br>Denmark<br> 65890</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="visa-electron">Visa Electron<a class="hash-link" href="#visa-electron" title="Direct link to heading">​</a></h4><table><thead><tr><th>Card Number</th><th>CVV</th><th>Address</th></tr></thead><tbody><tr><td>4917480000000008</td><td>009</td><td>5-6 Ross Avenue<br>Birmingham<br>B67 8UJ</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mastercard-credit">Mastercard Credit<a class="hash-link" href="#mastercard-credit" title="Direct link to heading">​</a></h4><table><thead><tr><th>Card Number</th><th>CVV</th><th>Address</th></tr></thead><tbody><tr><td>5301250070000191</td><td>419</td><td>25 The Larches Narborough<br>Leicester<br>LE10 2RT</td></tr><tr><td>5413339000001000</td><td>304</td><td>Pear Tree Cottage<br>The Green<br>Milton Keynes<br>MK11 7UY</td></tr><tr><td>5434849999999951</td><td>470</td><td>34a Rubbery Close<br>Cloisters Run<br>Rugby<br>CV21 8JT</td></tr><tr><td>5434849999999993</td><td>557</td><td>4-7 The Hay Market<br>Grantham<br>NG32 4HG</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mastercard-debit">Mastercard Debit<a class="hash-link" href="#mastercard-debit" title="Direct link to heading">​</a></h4><table><thead><tr><th>Card Number</th><th>CVV</th><th>Address</th></tr></thead><tbody><tr><td>5573 4712 3456 7898</td><td>159</td><td>Merevale Avenue<br>Leicester<br>LE10 2BU</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="uk-maestro">UK Maestro<a class="hash-link" href="#uk-maestro" title="Direct link to heading">​</a></h4><table><thead><tr><th>Card Number</th><th>CVV</th><th>Address</th></tr></thead><tbody><tr><td>6759 0150 5012 3445 002</td><td>309</td><td>The Parkway<br>5258 Larches Approach Hull<br>North Humberside<br>HU10 5OP</td></tr><tr><td>6759 0168 0000 0120 097</td><td>701</td><td>The Manor<br>Wolvey Road<br>Middlesex<br>TW7 9FF</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="jcb">JCB<a class="hash-link" href="#jcb" title="Direct link to heading">​</a></h4><table><thead><tr><th>Card Number</th><th>CVV</th><th>Address</th></tr></thead><tbody><tr><td>3540599999991047</td><td>209</td><td>2 Middle Wallop Merideth-in-the-Wolds<br>Lincolnshire<br>LN2 8HG</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="american-express">American Express<a class="hash-link" href="#american-express" title="Direct link to heading">​</a></h4><table><thead><tr><th>Card Number</th><th>CVV</th><th>Address</th></tr></thead><tbody><tr><td>374245455400001</td><td>4887</td><td>The Hunts Way<br>Southampton<br>SO18 1GW</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="diners-club">Diners Club<a class="hash-link" href="#diners-club" title="Direct link to heading">​</a></h4><table><thead><tr><th>Card Number</th><th>CVV</th><th>Address</th></tr></thead><tbody><tr><td>36432685260294</td><td>111</td><td>N/A</td></tr></tbody></table><p>Diners Club do not support the Address Verification Service (AVS). For testing purposes, we advise that a separate Merchant Account is used with AVS is turned off.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3d-secure-testing">3D Secure Testing<a class="hash-link" href="#3d-secure-testing" title="Direct link to heading">​</a></h3><p>Your test accounts are connected to our 3-D Secure Product Integration Testing (PIT) system rather than to the production 3-D Secure servers. You can use any of the test cards provided above with this PIT system, and the authentication status returned by the Directory Server (for frictionless flow simulation) can be selected using the value of the card expiry month as follows:</p><table><thead><tr><th>Card Expiry Month</th><th>Auth Status</th><th>Simulation (Frictionless)</th></tr></thead><tbody><tr><td>01 - January</td><td>Y</td><td>Fully authenticated</td></tr><tr><td>02 - February</td><td>N</td><td>Not authenticated</td></tr><tr><td>03 - March</td><td>U</td><td>Unknown authentication status</td></tr><tr><td>04 - April</td><td>A</td><td>Attempted authentication</td></tr><tr><td>05 - May</td><td>D</td><td>Decoupled authentication</td></tr><tr><td>06 - June</td><td>R</td><td>Transaction rejected (do not attempt to send for authorisation)</td></tr><tr><td>07 – July</td><td>E</td><td>Unknown error performing 3-D Secure checks</td></tr><tr><td>08 - August</td><td>E</td><td>Error due to timeout communicating with the Directory Server</td></tr><tr><td>09 – September</td><td>E</td><td>Error due to corrupt response from the Directory Server.</td></tr><tr><td>10 – October</td><td>I</td><td>Information only</td></tr><tr><td>11 – November</td><td>U</td><td>Unknown authentication due to Cardholder not enrolled (error 13)</td></tr><tr><td>12 - December</td><td>C</td><td>Frictionless not possible, challenge Cardholder</td></tr></tbody></table><p>An expiry month of 12 will simulate the non frictionless flow and desired authentication status (threeDSAuthenticated) can be selected on the challenge dialog shown by the PIT Access Control Server.</p><p>When using an expiry month from the above table please use a suitable expiry year to ensure the date is sometime in the near future.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="paypal-sandbox-accounts">Paypal Sandbox Accounts<a class="hash-link" href="#paypal-sandbox-accounts" title="Direct link to heading">​</a></h3><p>Please contact customer support to have your own PayPal test Merchant account created that connects to your own PayPal sandbox account, thus enabling you to view the transactions as they are sent to PayPal.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="amazon-pay-sandbox-accounts">Amazon Pay Sandbox Accounts<a class="hash-link" href="#amazon-pay-sandbox-accounts" title="Direct link to heading">​</a></h3><p>Please contact customer support to have your own Amazon Pay test Merchant account created that connects to your own Amazon Pay sandbox account, thus enabling you to view the transactions as they are sent to Amazon Pay.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-checking-only">Request Checking Only<a class="hash-link" href="#request-checking-only" title="Direct link to heading">​</a></h3><p>Sometimes, you may wish to submit a request to the Gateway in order for it to be ‘validated only’ and not processed by the simulator or sent to the Acquirer. In these cases, the following flag can be used that will stop the processing after the integrity verification has been performed:</p><table><thead><tr><th>Name</th><th>Mandatory</th><th>Description</th></tr></thead><tbody><tr><td>checkOnly</td><td>No</td><td>Check the request for syntax and field value errors only. Do not attempt to submit the transaction for honouring by the Merchant’s financial institution.</td></tr></tbody></table><p>If the request is OK, then a responseCode is returned as 0 (Success); otherwise, the code that would have prevented the request from completing is returned.</p><p>Note: in these cases, the request is not stored by the Gateway and is not available within the Merchant Management System (MMS).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="signatureCalculation">Signature Calculation<a class="hash-link" href="#signatureCalculation" title="Direct link to heading">​</a></h2><p>It is highly recommended that transactions are protected using message signing. The signing process offers a quick and simple way to ensure that the message came from an authorised source and has not been tampered with during transmission.</p><p>Signing, however, must be completed on your servers and never left for the Customer’s browser to complete in JavaScript, as this would mean revealing your secret signature code to anyone who viewed the JavaScript code in the browser.</p><p>Signatures are especially important when a transaction is sent from a browser’s payment form via the use of hidden form fields because the Customer can easily use tools built into their browser to modify these hidden fields and change items such as the amount they should be charged.</p><p>Care must be taken to ensure that fields are sorted before signing into ascending field name order according to their numeric ASCII value. Some languages natural sort routines do NOT use ASCII order by default and so need to be adjusted or alternative methods used.</p><p>Also, when signing requests with fields formatted as per the <a href="/directintegration/overview#fieldFormats">format guide</a>, only the root integration field is included in any sorting as the sub-fields are part of the value and should not have their order changed. The sub-fields must then be sent in the same order as they were hashed if added as hidden fields in HTML forms etc.
The section below gives a step-by-step example of how to sign a transaction, complete with coding examples using the PHP language.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-signature-key">Example Signature Key<a class="hash-link" href="#example-signature-key" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;DontTellAnyone&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-transaction">Example Transaction<a class="hash-link" href="#example-transaction" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$tran</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;100001&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">//merchantID will be provided by the Handpoint support team</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//action could be SALE, VERIFY or PREAUTH </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//1 –&gt; E-commerce (ECOM), 2 –&gt; Mail Order/Telephone Order (MOTO), 9 –&gt; Continuous Authority (CA)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;826&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//ISO 3-letter currency code. 826 -&gt; GBP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;826&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//ISO 3-letter country code. 826 -&gt; United Kingdom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;2691&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//Either major currency units includes a single decimal point such as ’10.99&#x27;. </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      </span><span class="token comment" style="color:rgb(98, 114, 164)">//Minor currency units contains no decimal points such as ‘1099</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;transactionUnique&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;55f025addd3c2&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//Unique identifier for this transaction. This is an added security feature to combat transaction spoofing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Signature Test&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">//Free format text field to store order details, reference numbers, etc. for the Merchant’s records.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;4929 4212 3460 0821&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//Card Number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryDate&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1213&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//Card expiry date</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>The transaction used for signature calculation must not include any &#x27;signature&#x27; field as this will be added after signing when its value is known.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-1---sort-transaction-values-by-their-field-name">Step 1 - Sort transaction values by their field name<a class="hash-link" href="#step-1---sort-transaction-values-by-their-field-name" title="Direct link to heading">​</a></h4><p>Transaction fields must be in ascending field name order according to their numeric ASCII value.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">ksort</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$tran</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;2691&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryDate&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1213&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;4929 4212 3460 0821&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;826&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;826&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;100001&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Signature Test&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;transactionUnique&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;55f025addd3c2&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-2---create-url-encoded-string-from-sorted-fields">Step 2 - Create url encoded string from sorted fields<a class="hash-link" href="#step-2---create-url-encoded-string-from-sorted-fields" title="Direct link to heading">​</a></h4><p>Use RFC 1738 and the application/x-www-form-urlencoded media type, which implies that spaces are encoded as plus (+) signs.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">http_build_query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$tran</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">action</span><span class="token operator">=</span><span class="token constant" style="color:rgb(189, 147, 249)">SALE</span><span class="token operator">&amp;</span><span class="token plain">amount</span><span class="token operator">=</span><span class="token number">2691</span><span class="token operator">&amp;</span><span class="token plain">cardExpiryDate</span><span class="token operator">=</span><span class="token number">1213</span><span class="token operator">&amp;</span><span class="token plain">cardNumber</span><span class="token operator">=</span><span class="token number">4929</span><span class="token operator">+</span><span class="token number">4212</span><span class="token operator">+</span><span class="token number">3460</span><span class="token operator">+</span><span class="token number">0821</span><span class="token operator">&amp;</span><span class="token plain">countryCode</span><span class="token operator">=</span><span class="token number">826</span><span class="token operator">&amp;</span><span class="token plain">currencyCode</span><span class="token operator">=</span><span class="token number">826</span><span class="token operator">&amp;</span><span class="token plain">merchantID</span><span class="token operator">=</span><span class="token number">100001</span><span class="token operator">&amp;</span><span class="token plain">orderRef</span><span class="token operator">=</span><span class="token plain">Signature</span><span class="token operator">+</span><span class="token plain">Test</span><span class="token operator">&amp;</span><span class="token plain">transactionUnique</span><span class="token operator">=</span><span class="token number">55</span><span class="token plain">f025addd3c2</span><span class="token operator">&amp;</span><span class="token plain">type</span><span class="token operator">=</span><span class="token number">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3---normalise-all-line-endings-in-the-url-encoded-string">Step 3 - Normalise all line endings in the url encoded string<a class="hash-link" href="#step-3---normalise-all-line-endings-in-the-url-encoded-string" title="Direct link to heading">​</a></h4><p>Convert all CR NL, NL CR, CR character sequences to a single NL character.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">str_replace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0D%0A&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0A%0D&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0D&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0A&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">action</span><span class="token operator">=</span><span class="token constant" style="color:rgb(189, 147, 249)">SALE</span><span class="token operator">&amp;</span><span class="token plain">amount</span><span class="token operator">=</span><span class="token number">2691</span><span class="token operator">&amp;</span><span class="token plain">cardExpiryDate</span><span class="token operator">=</span><span class="token number">1213</span><span class="token operator">&amp;</span><span class="token plain">cardNumber</span><span class="token operator">=</span><span class="token number">4929</span><span class="token operator">+</span><span class="token number">4212</span><span class="token operator">+</span><span class="token number">3460</span><span class="token operator">+</span><span class="token number">0821</span><span class="token operator">&amp;</span><span class="token plain">countryCode</span><span class="token operator">=</span><span class="token number">826</span><span class="token operator">&amp;</span><span class="token plain">currencyCode</span><span class="token operator">=</span><span class="token number">826</span><span class="token operator">&amp;</span><span class="token plain">merchantID</span><span class="token operator">=</span><span class="token number">100001</span><span class="token operator">&amp;</span><span class="token plain">orderRef</span><span class="token operator">=</span><span class="token plain">Signature</span><span class="token operator">+</span><span class="token plain">Test</span><span class="token operator">&amp;</span><span class="token plain">transactionUnique</span><span class="token operator">=</span><span class="token number">55</span><span class="token plain">f025addd3c2</span><span class="token operator">&amp;</span><span class="token plain">type</span><span class="token operator">=</span><span class="token number">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-4---append-your-signature-key-to-the-normalised-string">Step 4 - Append your signature key to the normalised string<a class="hash-link" href="#step-4---append-your-signature-key-to-the-normalised-string" title="Direct link to heading">​</a></h4><p>The signature key is appended to the normalised string with no separator characters.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token plain"> </span><span class="token operator">.=</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;DontTellAnyone&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">action</span><span class="token operator">=</span><span class="token constant" style="color:rgb(189, 147, 249)">SALE</span><span class="token operator">&amp;</span><span class="token plain">amount</span><span class="token operator">=</span><span class="token number">2691</span><span class="token operator">&amp;</span><span class="token plain">cardExpiryDate</span><span class="token operator">=</span><span class="token number">1213</span><span class="token operator">&amp;</span><span class="token plain">cardNumber</span><span class="token operator">=</span><span class="token number">4929</span><span class="token operator">+</span><span class="token number">4212</span><span class="token operator">+</span><span class="token number">3460</span><span class="token operator">+</span><span class="token number">0821</span><span class="token operator">&amp;</span><span class="token plain">countryCode</span><span class="token operator">=</span><span class="token number">826</span><span class="token operator">&amp;</span><span class="token plain">currencyCode</span><span class="token operator">=</span><span class="token number">826</span><span class="token operator">&amp;</span><span class="token plain">merchantID</span><span class="token operator">=</span><span class="token number">100001</span><span class="token operator">&amp;</span><span class="token plain">orderRef</span><span class="token operator">=</span><span class="token plain">Signature</span><span class="token operator">+</span><span class="token plain">Test</span><span class="token operator">&amp;</span><span class="token plain">transactionUnique</span><span class="token operator">=</span><span class="token number">55</span><span class="token plain">f025addd3c2</span><span class="token operator">&amp;</span><span class="token plain">type</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain">DontTellAnyone</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-5---hash-the-string-using-the-sha-512-algorithm">Step 5 - Hash the string using the SHA-512 algorithm<a class="hash-link" href="#step-5---hash-the-string-using-the-sha-512-algorithm" title="Direct link to heading">​</a></h4><p>The normalised string is hashed to a more compact value using the secure SHA-512 hashing algorithm.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SHA512&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">da0acd2c404945365d0e7ae74ad32d57c561e9b942f6bdb7e3dda49a08fcddf74fe6af6b23b8481b8dc8895c12fc21c72c69d60f137fdf574720363e33d94097</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-6---add-the-signature-to-the-transaction-form-or-post-data">Step 6 - Add the signature to the transaction form or post data<a class="hash-link" href="#step-6---add-the-signature-to-the-transaction-form-or-post-data" title="Direct link to heading">​</a></h4><p>The signature should be sent as part of the transaction in a field called &#x27;signature&#x27;.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">input</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">hidden</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">signature</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value php language-php delimiter important" style="color:rgb(255, 121, 198)">&lt;?=</span><span class="token tag attr-value php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token tag attr-value php language-php delimiter important" style="color:rgb(255, 121, 198)">?&gt;</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$tran[&#x27;signature&#x27;] = $signature;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-code-php">Sample Code PHP<a class="hash-link" href="#sample-code-php" title="Direct link to heading">​</a></h3><p>Example of calculating the signature in PHP:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token php language-php delimiter important">&lt;?PHP</span><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Merchant signature key</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$key</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Request Information</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$tran</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;merchantID&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;155928&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php">  </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//merchantID will be provided by the Handpoint support team</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;action&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SALE&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//action could be SALE, VERIFY or PREAUTH </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//1 –&gt; E-commerce (ECOM), 2 –&gt; Mail Order/Telephone Order (MOTO), 9 –&gt; Continuous Authority (CA)</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;currencyCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;826&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//ISO 3-letter currency code. 826 -&gt; GBP</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;countryCode&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;826&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//ISO 3-letter country code. 826 -&gt; United Kingdom</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;amount&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;2691&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Either major currency units includes a single decimal point such as ’10.99&#x27;. </span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">                      </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Minor currency units contains no decimal points such as ‘1099</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;transactionUnique&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;55f025addd3c2&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Unique identifier for this transaction. This is an added security feature to combat transaction spoofing</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;orderRef&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;Signature Test&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php">  </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Free format text field to store order details, reference numbers, etc. for the Merchant’s records.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardNumber&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;4929 4212 3460 0821&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Card Number</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php">    </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;cardExpiryDate&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;1213&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">ksort</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$tran</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">http_build_query</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$tran</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;&amp;&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">str_replace</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php keyword" style="color:rgb(189, 147, 249);font-style:italic">array</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0D%0A&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0A%0D&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0D&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;%0A&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token php language-php"> </span><span class="token php language-php operator">.=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;3obzOxdqw6e1u&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">hash</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string single-quoted-string" style="color:rgb(255, 121, 198)">&#x27;SHA512&#x27;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$str</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php comment" style="color:rgb(98, 114, 164)">//Prints the signature</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php function" style="color:rgb(80, 250, 123)">printf</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token php language-php string double-quoted-string" style="color:rgb(255, 121, 198)">&quot;Signature %s&quot;</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:rgb(189, 147, 249);font-style:italic">$signature</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token php language-php punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token php language-php"> </span><span class="token php language-php delimiter important">?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/directintegration/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/directintegration/transactiontypes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transaction Types</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#transaction-types" class="table-of-contents__link toc-highlight">Transaction Types</a><ul><li><a href="#sale" class="table-of-contents__link toc-highlight">SALE</a></li><li><a href="#verify" class="table-of-contents__link toc-highlight">VERIFY</a></li><li><a href="#preauth" class="table-of-contents__link toc-highlight">PREAUTH</a></li><li><a href="#refund_sale" class="table-of-contents__link toc-highlight">REFUND_SALE</a></li><li><a href="#refund" class="table-of-contents__link toc-highlight">REFUND</a></li><li><a href="#capture" class="table-of-contents__link toc-highlight">CAPTURE</a></li><li><a href="#cancel" class="table-of-contents__link toc-highlight">CANCEL</a></li><li><a href="#query" class="table-of-contents__link toc-highlight">QUERY</a></li></ul></li><li><a href="#3ds-example-php-code" class="table-of-contents__link toc-highlight">3DS Example (PHP Code)</a></li><li><a href="#gateway-wallet" class="table-of-contents__link toc-highlight">Gateway Wallet</a><ul><li><a href="#direct-integration-creating-a-new-gateway-wallet" class="table-of-contents__link toc-highlight">Direct Integration creating a new Gateway Wallet</a></li><li><a href="#direct-integration-using-gateway-wallet" class="table-of-contents__link toc-highlight">Direct Integration using Gateway Wallet</a></li></ul></li><li><a href="#credentials-on-file-cof" class="table-of-contents__link toc-highlight">Credentials on File (COF)</a><ul><li><a href="#cit---cardholder-opts-to-store-their-card-details-on-merchants-website" class="table-of-contents__link toc-highlight">(CIT) - Cardholder opts to store their card details on Merchant&#39;s website.</a></li><li><a href="#cit---cardholder-opts-to-store-their-card-details-provided-to-merchant-via-mail-or-telephone" class="table-of-contents__link toc-highlight">(CIT) - Cardholder opts to store their card details provided to Merchant via mail or telephone.</a></li><li><a href="#cit---cardholder-pays-using-a-card-they-previously-stored-on-the-merchants-website" class="table-of-contents__link toc-highlight">(CIT) - Cardholder pays using a card they previously stored on the Merchant&#39;s website.</a></li><li><a href="#cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-on-the-merchants-website" class="table-of-contents__link toc-highlight">(CIT) - Cardholder provides their card details to sign up to a subscription on the Merchant&#39;s website.</a></li><li><a href="#cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-on-the-merchants-website" class="table-of-contents__link toc-highlight">(CIT) - Cardholder provides their card details when agreeing to purchase by instalments on the Merchant&#39;s website.</a></li><li><a href="#cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-via-mail-or-telephone-to-the-merchant" class="table-of-contents__link toc-highlight">(CIT) - Cardholder provides their card details to sign up to a subscription via mail or telephone to the Merchant.</a></li><li><a href="#cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-via-mail-or-telephone-to-the-merchant" class="table-of-contents__link toc-highlight">(CIT) - Cardholder provides their card details when agreeing to purchase by instalments via mail or telephone to the Merchant.</a></li><li><a href="#mit---merchantgateway-takes-an-automatic-subscription-payment-at-the-interval-agreed-to-by-the-cardholder" class="table-of-contents__link toc-highlight">(MIT) - Merchant/Gateway takes an automatic subscription payment at the interval agreed to by the Cardholder.</a></li><li><a href="#mit---merchantgateway-makes-an-automatic-instalment-payment-at-the-interval-agreed-to-by-the-cardholder" class="table-of-contents__link toc-highlight">(MIT) - Merchant/Gateway makes an automatic instalment payment at the interval agreed to by the Cardholder.</a></li><li><a href="#mit---merchant-makes-an-unscheduled-transaction-such-as-an-account-top-up-as-previously-agreed-with-the-cardholder-when-they-stored-their-card-details" class="table-of-contents__link toc-highlight">(MIT) - Merchant makes an unscheduled transaction, such as an account top-up, as previously agreed with the Cardholder when they stored their card details.</a></li><li><a href="#mit---merchant-resubmits-a-payment-where-the-initial-payment-was-declined-due-to-insufficient-funds-but-the-goods-have-already-been-provided-to-the-cardholder" class="table-of-contents__link toc-highlight">(MIT) - Merchant resubmits a payment where the initial payment was declined due to insufficient funds, but the goods have already been provided to the Cardholder.</a></li><li><a href="#mit---merchant-reauthorises-a-payment-when-the-completion-or-fulfilment-of-the-original-order-or-service-extends-beyond-the-authorization-validity-limit-set-by-the-card-scheme" class="table-of-contents__link toc-highlight">(MIT) - Merchant reauthorises a payment when the completion or fulfilment of the original order or service extends beyond the authorization validity limit set by the Card Scheme.</a></li><li><a href="#mit---merchant-makes-a-payment-to-process-a-supplemental-account-charge-after-original-services-have-been-rendered-and-respective-payment-has-been-processed" class="table-of-contents__link toc-highlight">(MIT) - Merchant makes a payment to process a supplemental account charge after original services have been rendered and respective payment has been processed.</a></li><li><a href="#mit---merchant-makes-a-payment-to-charge-the-cardholder-a-penalty-according-to-the-merchants-reservation-cancellation-policy" class="table-of-contents__link toc-highlight">(MIT) - Merchant makes a payment to charge the Cardholder a penalty according to the merchant’s reservation cancellation policy.</a></li></ul></li><li><a href="#example-http-request" class="table-of-contents__link toc-highlight">Example HTTP Request</a><ul><li><a href="#transaction-request-http-headers" class="table-of-contents__link toc-highlight">Transaction Request HTTP Headers</a></li><li><a href="#transaction-response-http-headers" class="table-of-contents__link toc-highlight">Transaction Response HTTP Headers</a></li><li><a href="#submission-example" class="table-of-contents__link toc-highlight">Submission Example</a></li></ul></li><li><a href="#gateway-integration-library" class="table-of-contents__link toc-highlight">Gateway Integration Library</a><ul><li><a href="#library-namespace" class="table-of-contents__link toc-highlight">Library Namespace</a></li><li><a href="#gateway-configuration" class="table-of-contents__link toc-highlight">Gateway Configuration</a></li><li><a href="#gateway-methods" class="table-of-contents__link toc-highlight">Gateway Methods</a></li><li><a href="#gateway-library-php" class="table-of-contents__link toc-highlight">Gateway Library (PHP)</a></li></ul></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a><ul><li><a href="#test-amounts" class="table-of-contents__link toc-highlight">Test Amounts</a></li><li><a href="#testCards" class="table-of-contents__link toc-highlight">Test Cards</a></li><li><a href="#3d-secure-testing" class="table-of-contents__link toc-highlight">3D Secure Testing</a></li><li><a href="#paypal-sandbox-accounts" class="table-of-contents__link toc-highlight">Paypal Sandbox Accounts</a></li><li><a href="#amazon-pay-sandbox-accounts" class="table-of-contents__link toc-highlight">Amazon Pay Sandbox Accounts</a></li><li><a href="#request-checking-only" class="table-of-contents__link toc-highlight">Request Checking Only</a></li></ul></li><li><a href="#signatureCalculation" class="table-of-contents__link toc-highlight">Signature Calculation</a><ul><li><a href="#example-signature-key" class="table-of-contents__link toc-highlight">Example Signature Key</a></li><li><a href="#example-transaction" class="table-of-contents__link toc-highlight">Example Transaction</a></li><li><a href="#sample-code-php" class="table-of-contents__link toc-highlight">Sample Code PHP</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://developer.handpoint.com/cpdocs/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">In-Person Payments Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/cnpdocs/index.html">Online Payments Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://handpoint.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Handpoint Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/handpoint" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/handpointltd?lang=en" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Get our Apps</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://play.google.com/store/apps/details?id=com.handpoint.hipos&amp;hl=en&amp;gl=US&amp;pcampaignid=pcampaignidMKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1" target="_blank" rel="noopener noreferrer" class="footer__link-item">Get it on Google Play<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://apps.apple.com/us/app/handpoint/id1450546788?itsct=apps_box_link&amp;itscg=30200" target="_blank" rel="noopener noreferrer" class="footer__link-item">Download on the App Store<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://status.handpoint.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Handpoint Status Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://handpoint.atlassian.net/wiki/spaces/PD/overview?homepageId=5898250" target="_blank" rel="noopener noreferrer" class="footer__link-item">FAQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://handpoint.us6.list-manage.com/subscribe?u=4d9dff9e7edb7e57a67a7b252&amp;id=0a2179241e" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subscribe to the Handpoint Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/handpoint" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.handpoint.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="https://handpoint.imgix.net/handpoint-logo-w.png?w=150" alt="Handpoint Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="https://handpoint.imgix.net/handpoint-logo-w.png?w=150" alt="Handpoint Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2023 Handpoint</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1b9da508.js"></script>
<script src="/assets/js/main.4cacc470.js"></script>
</body>
</html>