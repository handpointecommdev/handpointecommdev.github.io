"use strict";(self.webpackChunkecommerce=self.webpackChunkecommerce||[]).push([[348],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=d(n),u=r,m=h["".concat(l,".").concat(u)]||h[u]||c[u]||i;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var d=2;d<i;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6834:function(e,t,n){n.r(t),n.d(t,{assets:function(){return l},contentTitle:function(){return o},default:function(){return c},frontMatter:function(){return i},metadata:function(){return s},toc:function(){return d}});var a=n(3117),r=(n(7294),n(3905));const i={sidebar_position:2},o="Sample Code & Examples",s={unversionedId:"samplecode",id:"samplecode",title:"Sample Code & Examples",description:"Sample Code - Hosted Payment Fields",source:"@site/hostedpaymentfields/samplecode.md",sourceDirName:".",slug:"/samplecode",permalink:"/hostedpaymentfields/samplecode",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/hostedpaymentfields/overview"},next:{title:"Transaction Types",permalink:"/hostedpaymentfields/transactiontypes"}},l={},d=[{value:"Sample Code - Hosted Payment Fields",id:"sample-code---hosted-payment-fields",level:2},{value:"Transaction Types",id:"transaction-types",level:2},{value:"SALE",id:"sale",level:3},{value:"VERIFY",id:"verify",level:3},{value:"PREAUTH",id:"preauth",level:3},{value:"REFUND_SALE",id:"refund_sale",level:3},{value:"REFUND",id:"refund",level:3},{value:"CAPTURE",id:"capture",level:3},{value:"CANCEL",id:"cancel",level:3},{value:"QUERY",id:"query",level:3},{value:"3DS Example (PHP Code)",id:"3ds-example-php-code",level:2},{value:"Hosted Payment Fields Library",id:"hosted-payment-fields-library",level:2},{value:"Library Namespace",id:"library-namespace",level:3},{value:"Form Construction",id:"form-construction",level:3},{value:"Form Methods",id:"form-methods",level:3},{value:"Form Events",id:"form-events",level:3},{value:"Field Construction",id:"field-construction",level:3},{value:"Field Methods",id:"field-methods",level:3},{value:"Field Events",id:"field-events",level:3},{value:"Field CSS Classes",id:"field-css-classes",level:3},{value:"Field Styling",id:"field-styling",level:3},{value:"Example stylesheet :",id:"example-stylesheet-",level:4},{value:"jQuery plugin",id:"jquery-plugin",level:3},{value:"Example HTTP Request",id:"example-http-request",level:2},{value:"Transaction Request HTTP Headers",id:"transaction-request-http-headers",level:3},{value:"Transaction Response HTTP Headers",id:"transaction-response-http-headers",level:3},{value:"Submission Example",id:"submission-example",level:3},{value:"Gateway Integration Library",id:"gateway-integration-library",level:2},{value:"Library Namespace",id:"library-namespace-1",level:3},{value:"Gateway Configuration",id:"gateway-configuration",level:3},{value:"Gateway Methods",id:"gateway-methods",level:3},{value:"<code>string hostedRequest(mixed[] request, string[] options)</code>",id:"string-hostedrequestmixed-request-string-options",level:4},{value:"<code>mixed[] directRequest(mixed[] request, string[] options)</code>",id:"mixed-directrequestmixed-request-string-options",level:4},{value:"<code>void prepareRequest(mixed[] &amp;request, string[] &amp;options, string &amp;secret, string &amp;direct_url, string &amp;hosted_url)</code>",id:"void-preparerequestmixed-request-string-options-string-secret-string-direct_url-string-hosted_url",level:4},{value:"<code>void verifyResponse(mixed[] &amp;response, string secret)</code>",id:"void-verifyresponsemixed-response-string-secret",level:4},{value:"<code>string sign(mixed[] request, string secret, mixed partial = false)</code>",id:"string-signmixed-request-string-secret-mixed-partial--false",level:4},{value:"Gateway Library (PHP)",id:"gateway-library-php",level:3},{value:"Credentials on File (COF)",id:"credentials-on-file-cof",level:2},{value:"(CIT) - Cardholder opts to store their card details on Merchant&#39;s website.",id:"cit---cardholder-opts-to-store-their-card-details-on-merchants-website",level:3},{value:"(CIT) - Cardholder opts to store their card details provided to Merchant via mail or telephone.",id:"cit---cardholder-opts-to-store-their-card-details-provided-to-merchant-via-mail-or-telephone",level:3},{value:"(CIT) - Cardholder pays using a card they previously stored on the Merchant&#39;s website.",id:"cit---cardholder-pays-using-a-card-they-previously-stored-on-the-merchants-website",level:3},{value:"(CIT) - Cardholder provides their card details to sign up to a subscription on the Merchant&#39;s website.",id:"cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-on-the-merchants-website",level:3},{value:"(CIT) - Cardholder provides their card details when agreeing to purchase by instalments on the Merchant&#39;s website.",id:"cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-on-the-merchants-website",level:3},{value:"(CIT) - Cardholder provides their card details to sign up to a subscription via mail or telephone to the Merchant.",id:"cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-via-mail-or-telephone-to-the-merchant",level:3},{value:"(CIT) - Cardholder provides their card details when agreeing to purchase by instalments on the Merchant&#39;s website.",id:"cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-on-the-merchants-website-1",level:3},{value:"(MIT) - Merchant/Gateway takes an automatic subscription payment at the interval agreed to by the Cardholder.",id:"mit---merchantgateway-takes-an-automatic-subscription-payment-at-the-interval-agreed-to-by-the-cardholder",level:3},{value:"(MIT) - Merchant/Gateway makes an automatic instalment payment at the interval agreed to by the Cardholder.",id:"mit---merchantgateway-makes-an-automatic-instalment-payment-at-the-interval-agreed-to-by-the-cardholder",level:3},{value:"(MIT) - Merchant makes an unscheduled transaction, such as an account top-up, as previously agreed with the Cardholder when they stored their card details.",id:"mit---merchant-makes-an-unscheduled-transaction-such-as-an-account-top-up-as-previously-agreed-with-the-cardholder-when-they-stored-their-card-details",level:3},{value:"(MIT) - Merchant resubmits a payment where the initial payment was declined due to insufficient funds, but the goods have already been provided to the Cardholder.",id:"mit---merchant-resubmits-a-payment-where-the-initial-payment-was-declined-due-to-insufficient-funds-but-the-goods-have-already-been-provided-to-the-cardholder",level:3},{value:"(MIT) - Merchant reauthorises a payment when the completion or fulfilment of the original order or service extends beyond the authorization validity limit set by the Card Scheme.",id:"mit---merchant-reauthorises-a-payment-when-the-completion-or-fulfilment-of-the-original-order-or-service-extends-beyond-the-authorization-validity-limit-set-by-the-card-scheme",level:3},{value:"(MIT) - Merchant makes a payment to process a supplemental account charge after original services have been rendered and respective payment has been processed.",id:"mit---merchant-makes-a-payment-to-process-a-supplemental-account-charge-after-original-services-have-been-rendered-and-respective-payment-has-been-processed",level:3},{value:"(MIT) - Merchant makes a payment to charge the Cardholder a penalty according to the merchant\u2019s reservation cancellation policy.",id:"mit---merchant-makes-a-payment-to-charge-the-cardholder-a-penalty-according-to-the-merchants-reservation-cancellation-policy",level:3},{value:"Testing",id:"testing",level:2},{value:"Test Amounts",id:"test-amounts",level:3},{value:"Test Cards",id:"test-cards",level:3},{value:"Visa Credit",id:"visa-credit",level:4},{value:"Visa Debit",id:"visa-debit",level:4},{value:"Visa Electron",id:"visa-electron",level:4},{value:"Mastercard Credit",id:"mastercard-credit",level:4},{value:"Mastercard Debit",id:"mastercard-debit",level:4},{value:"UK Maestro",id:"uk-maestro",level:4},{value:"JCB",id:"jcb",level:4},{value:"American Express",id:"american-express",level:4},{value:"Diners Club",id:"diners-club",level:4},{value:"3D Secure Testing",id:"3d-secure-testing",level:3},{value:"Paypal Sandbox Accounts",id:"paypal-sandbox-accounts",level:3},{value:"Amazon Pay Sandbox Accounts",id:"amazon-pay-sandbox-accounts",level:3},{value:"Request Checking Only",id:"request-checking-only",level:3},{value:"Signature Calculation",id:"signatureCalculation",level:2},{value:"Example Signature Key",id:"example-signature-key",level:3},{value:"Example Transaction",id:"example-transaction",level:3},{value:"Step 1 - Sort transaction values by their field name",id:"step-1---sort-transaction-values-by-their-field-name",level:4},{value:"Step 2 - Create url encoded string from sorted fields",id:"step-2---create-url-encoded-string-from-sorted-fields",level:4},{value:"Step 3 - Normalise all line endings in the url encoded string",id:"step-3---normalise-all-line-endings-in-the-url-encoded-string",level:4},{value:"Step 4 - Append your signature key to the normalised string",id:"step-4---append-your-signature-key-to-the-normalised-string",level:4},{value:"Step 5 - Hash the string using the SHA-512 algorithm",id:"step-5---hash-the-string-using-the-sha-512-algorithm",level:4},{value:"Step 6 - Add the signature to the transaction form or post data",id:"step-6---add-the-signature-to-the-transaction-form-or-post-data",level:4},{value:"Sample Code PHP",id:"sample-code-php",level:3}],p={toc:d};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"sample-code--examples"},"Sample Code & Examples"),(0,r.kt)("h2",{id:"sample-code---hosted-payment-fields"},"Sample Code - Hosted Payment Fields"),(0,r.kt)("p",null,"The following example code shows how to embed the Hosted Payment Fields over your website. You can use the following test card details to fill out the payment form:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Cardholder Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"Expiry Date"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV/CVC2"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Any cardholder name (ex: John Doe)"),(0,r.kt)("td",{parentName:"tr",align:null},"5573 4712 3456 7898"),(0,r.kt)("td",{parentName:"tr",align:null},"Any date in the future (12/2031)"),(0,r.kt)("td",{parentName:"tr",align:null},"159")))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"An expiry month of ",(0,r.kt)("strong",{parentName:"p"},"12")," (December) will simulate the non frictionless flow and a challenge will appear to the cardholder. ")),(0,r.kt)("iframe",{width:"100%",height:"600",src:"//jsfiddle.net/Handpoint/3h98fekp/10/embedded/html,result/dark/",allowfullscreen:"allowfullscreen",allowpaymentrequest:!0,frameborder:"0"}),(0,r.kt)("p",null,"Once the ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," has been generated, it must be passed, for example, through POST to you ",(0,r.kt)("em",{parentName:"p"},"server")," code in order to launch the transaction."),(0,r.kt)("p",null,"The following PHP code shows an example of how to perform a transaction with a ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," generated by Hosted Payment Fields:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n // Setup PHP session as use it to store data between 3DS steps\n if (isset($_GET['sid'])) {\n session_id($_GET['sid']);\n }\n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n \n // If ACS response into the IFRAME then redirect back to parent window\n if (!empty($_GET['acs'])) {\n echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n exit();\n }\n\n if (!isset($_POST['threeDSResponse'])) {\n // Initial request\n\n // Gather browser info - can be done at any time prior to the checkout\n if (!isset($_POST['browserInfo'])) {\n echo Gateway::collectBrowserInfo();\n exit();\n }\n\n // Direct Request\n $req = array(\n    'action' => 'SALE',\n    'type' => 1,\n    'currencyCode' => 826,\n    'countryCode' => 826,\n    'amount' => 1299,\n    //paymentToken generated by Hosted Payment Fields \n    //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n    'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTA4NDc0Mn19',\n    'customerAddress' => 'Merevale Avenue Leicester',\n    'customerPostCode' => 'LE10 2BU',\n    'orderRef' => 'Test purchase',\n    \n    // The following fields are mandatory for 3DS v2\n    'remoteAddress' => $_SERVER['REMOTE_ADDR'],\n    'threeDSRedirectURL' => $pageUrl . '&acs=1',\n\n    // The following field allows options to be passed for 3DS v2\n    // and the values here are for demonstration purposes only\n    'threeDSOptions' => array(\n        'paymentAccountAge' => '20220601',\n        'paymentAccountAgeIndicator' => '05',\n    ),\n );\n\n // Add the browser info as it is mandatory for 3DS v2\n $req += $_POST['browserInfo'];\n\n } else {\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n      'threeDSRef' => $_SESSION['threeDSRef'],\n      'threeDSResponse' => $_POST['threeDSResponse'],\n    );      \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_3DS_AUTHENTICATION_REQUIRED) { \n// Send request to the ACS server displaying response in an IFRAME\n\n // Render an IFRAME to show the ACS challenge (hidden for fingerprint method)\n $style = (isset($res['threeDSRequest']['threeDSMethodData']) ? 'display: none;' : '');\n echo \"<iframe name=\\\"threeds_acs\\\" style=\\\"height:420px; width:420px; {$style}\\\"></iframe>\\n\";\n\n // Silently POST the 3DS request to the ACS in the IFRAME\n echo silentPost($res['threeDSURL'], $res['threeDSRequest'], 'threeds_acs');\n\n \n\n // Remember the threeDSRef as need it when the ACS responds\n $_SESSION['threeDSRef'] = $res['threeDSRef'];\n\n} else if ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n echo \"<p>Thank you for your payment.</p>\";\n\n   } \n   else {\n        echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n// Render HTML to silently POST data to URL in target brower window \nfunction silentPost($url = '?', array $post = null, $target = '_self') { \n $url = htmlentities($url);\n $target = htmlentities($target);\n $fields = '';\n\n\n if ($post) {\n foreach ($post as $name => $value) {\n $fields .= Gateway::fieldToHtml($name, $value);\n }\n }\n\n $ret = \"\n <form id=\\\"silentPost\\\" action=\\\"{$url}\\\" method=\\\"post\\\" target=\\\"{$target}\\\">\n {$fields}\n <noscript><input type=\\\"submit\\\" value=\\\"Continue\\\"></noscript\n </form>\n <script>\n window.setTimeout('document.forms.silentPost.submit()', 0);\n <\/script>\n \";\n\n return $ret;\n}\n\n?>\n")),(0,r.kt)("h2",{id:"transaction-types"},"Transaction Types"),(0,r.kt)("h3",{id:"sale"},"SALE"),(0,r.kt)("p",null,"The following example PHP code shows how to send a ",(0,r.kt)("strong",{parentName:"p"},"SALE")," transaction with support for 3-D Secure using the Gateway library and using a ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," represents the sensitive card data collected. Check our ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#sample-code---hosted-payment-fields"},"sample code")," to get a ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," using HTML."),(0,r.kt)("p",null,"For more detail about the 3DS process, do not forget to visit our ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#3ds-example-php-code"},"3DS Example"),". "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n// Setup PHP session as use it to store data between 3DS steps\nif (isset($_GET['sid'])) {\n    session_id($_GET['sid']);\n}\n\nsession_start();\n// Compose current page URL (removing any sid and acs parameters)\n$pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://') . $_SERVER['SERVER_NAME'] . ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : '') . preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n$pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n// If ACS response into the IFRAME then redirect back to parent window\nif (!empty($_GET['acs'])) {\n    echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n    exit();\n}\n\nif (!isset($_POST['threeDSResponse'])) {\n    // Initial request\n\n    // Gather browser info - can be done at any time prior to the checkout\n    if (!isset($_POST['browserInfo'])) {\n        echo Gateway::collectBrowserInfo();\n        exit();\n    }\n\n    // Direct Request\n    $req = array(\n        'action' => 'SALE',\n        'type' => 1,\n        'currencyCode' => 826,\n        'countryCode' => 826,\n        'amount' => 1299,\n        //paymentToken generated by Hosted Payment Fields \n        //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n        'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTA4NDc0Mn19',\n        'customerEmail' => 'example@example.com',\n        'customerAddress' => 'Merevale Avenue Leicester',\n        'customerPostCode' => 'LE10 2BU',\n        'orderRef' => 'Test purchase',\n\n        // The following fields are mandatory for 3DS v2\n        'remoteAddress' => $_SERVER['REMOTE_ADDR'],\n        'threeDSRedirectURL' => $pageUrl . '&acs=1',\n\n        // The following field allows options to be passed for 3DS v2\n        // and the values here are for demonstration purposes only\n        'threeDSOptions' => array(\n            'paymentAccountAge' => '20220601',\n            'paymentAccountAgeIndicator' => '05',\n        ),\n    );\n\n    // Add the browser info as it is mandatory for 3DS v2\n    $req += $_POST['browserInfo'];\n\n} else {\n    $req = array(\n        // The following field are only required for tbe benefit of the SDK \n        'merchantID' => '155928',\n        'action' => 'SALE',\n        'threeDSRef' => $_SESSION['threeDSRef'],\n        'threeDSResponse' => $_POST['threeDSResponse'],\n    );\n}\n\ntry {\n    //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n} catch (\\Exception $e) {\n\n    // You should exit gracefully\n    die('Sorry, the request could not be sent: ' . $e);\n}\n\nprint $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_3DS_AUTHENTICATION_REQUIRED) {\n    // Send request to the ACS server displaying response in an IFRAME\n\n    // Render an IFRAME to show the ACS challenge (hidden for fingerprint method)\n    $style = (isset($res['threeDSRequest']['threeDSMethodData']) ? 'display: none;' : '');\n    echo \"<iframe name=\\\"threeds_acs\\\" style=\\\"height:420px; width:420px; {$style}\\\"></iframe>\\n\";\n\n    // Silently POST the 3DS request to the ACS in the IFRAME\n    echo silentPost($res['threeDSURL'], $res['threeDSRequest'], 'threeds_acs');\n\n\n\n    // Remember the threeDSRef as need it when the ACS responds\n    $_SESSION['threeDSRef'] = $res['threeDSRef'];\n\n} else if ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n    echo \"<p>Thank you for your payment.</p>\";\n\n} else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n}\n\n// Render HTML to silently POST data to URL in target brower window \nfunction silentPost($url = '?', array $post = null, $target = '_self')\n{\n    $url = htmlentities($url);\n    $target = htmlentities($target);\n    $fields = '';\n\n    if ($post) {\n        foreach ($post as $name => $value) {\n            $fields .= Gateway::fieldToHtml($name, $value);\n        }\n    }\n\n    $ret = \"\n <form id=\\\"silentPost\\\" action=\\\"{$url}\\\" method=\\\"post\\\" target=\\\"{$target}\\\">\n {$fields}\n <noscript><input type=\\\"submit\\\" value=\\\"Continue\\\"></noscript\n </form>\n <script>\n window.setTimeout('document.forms.silentPost.submit()', 0);\n <\/script>\n \";\n\n    return $ret;\n}\n\n?>\n")),(0,r.kt)("h3",{id:"verify"},"VERIFY"),(0,r.kt)("p",null,"The following example PHP code shows how to send a ",(0,r.kt)("strong",{parentName:"p"},"VERIFY")," (amount \xa30,00) transaction with support for 3-D Secure using the Gateway library and using a ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," represents the sensitive card data collected. "),(0,r.kt)("p",null,"Check our ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#sample-code---hosted-payment-fields"},"sample code")," to get a ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," using HTML."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"An expiry month of ",(0,r.kt)("strong",{parentName:"p"},"12")," (December) will simulate the non frictionless flow and a challenge will appear to the cardholder. ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n// Setup PHP session as use it to store data between 3DS steps\nif (isset($_GET['sid'])) {\n    session_id($_GET['sid']);\n}\n\nsession_start();\n// Compose current page URL (removing any sid and acs parameters)\n$pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://') . $_SERVER['SERVER_NAME'] . ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : '') . preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n$pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n// If ACS response into the IFRAME then redirect back to parent window\nif (!empty($_GET['acs'])) {\n    echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n    exit();\n}\n\nif (!isset($_POST['threeDSResponse'])) {\n    // Initial request\n\n    // Gather browser info - can be done at any time prior to the checkout\n    if (!isset($_POST['browserInfo'])) {\n        echo Gateway::collectBrowserInfo();\n        exit();\n    }\n\n    // Direct Request\n    $req = array(\n        'merchantID' => 155928,\n        'action' => 'VERIFY',\n        'type' => 1,\n        'currencyCode' => 826,\n        'countryCode' => 826,\n        'amount' => 0,\n        //paymentToken generated by Hosted Payment Fields \n        //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n        'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTA4NDc0Mn19',\n        'customerEmail' => 'example@example.com',\n        'customerAddress' => 'Merevale Avenue Leicester',\n        'customerPostCode' => 'LE10 2BU',\n        'orderRef' => 'Test purchase',\n\n        // The following fields are mandatory for 3DS v2\n        'remoteAddress' => $_SERVER['REMOTE_ADDR'],\n        'threeDSRedirectURL' => $pageUrl . '&acs=1',\n\n        // The following field allows options to be passed for 3DS v2\n        // and the values here are for demonstration purposes only\n        'threeDSOptions' => array(\n            'paymentAccountAge' => '20220601',\n            'paymentAccountAgeIndicator' => '05',\n        ),\n    );\n\n    // Add the browser info as it is mandatory for 3DS v2\n    $req += $_POST['browserInfo'];\n\n} else {\n    $req = array(\n        // The following field are only required for tbe benefit of the SDK \n        'merchantID' => '155928',\n        'action' => 'VERIFY',\n        'threeDSRef' => $_SESSION['threeDSRef'],\n        'threeDSResponse' => $_POST['threeDSResponse'],\n    );\n}\n\ntry {\n    $res = Gateway::directRequest($req);\n} catch (\\Exception $e) {\n\n    // You should exit gracefully\n    die('Sorry, the request could not be sent: ' . $e);\n}\n\nprint $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_3DS_AUTHENTICATION_REQUIRED) {\n    // Send request to the ACS server displaying response in an IFRAME\n\n    // Render an IFRAME to show the ACS challenge (hidden for fingerprint method)\n    $style = (isset($res['threeDSRequest']['threeDSMethodData']) ? 'display: none;' : '');\n    echo \"<iframe name=\\\"threeds_acs\\\" style=\\\"height:420px; width:420px; {$style}\\\"></iframe>\\n\";\n\n    // Silently POST the 3DS request to the ACS in the IFRAME\n    echo silentPost($res['threeDSURL'], $res['threeDSRequest'], 'threeds_acs');\n\n    // Remember the threeDSRef as need it when the ACS responds\n    $_SESSION['threeDSRef'] = $res['threeDSRef'];\n\n} else if ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n    echo \"<p>Verify done succesfully.</p>\";\n} else {\n    echo \"<p>Failed to Verify: \" . htmlentities($res['responseMessage']) . \"</p>\";\n}\n\n// Render HTML to silently POST data to URL in target brower window \nfunction silentPost($url = '?', array $post = null, $target = '_self')\n{\n    $url = htmlentities($url);\n    $target = htmlentities($target);\n    $fields = '';\n\n    if ($post) {\n        foreach ($post as $name => $value) {\n            $fields .= Gateway::fieldToHtml($name, $value);\n        }\n    }\n\n    $ret = \"\n <form id=\\\"silentPost\\\" action=\\\"{$url}\\\" method=\\\"post\\\" target=\\\"{$target}\\\">\n {$fields}\n <noscript><input type=\\\"submit\\\" value=\\\"Continue\\\"></noscript\n </form>\n <script>\n window.setTimeout('document.forms.silentPost.submit()', 0);\n <\/script>\n \";\n\n    return $ret;\n}\n\n?>\n")),(0,r.kt)("h3",{id:"preauth"},"PREAUTH"),(0,r.kt)("p",null,"The following example PHP code shows how to do a ",(0,r.kt)("strong",{parentName:"p"},"PREAUTH")," (amount \xa31,00) transaction with support for 3-D Secure using the ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#gateway-library-php"},"Gateway library")," and using a ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," represents the sensitive card data collected. "),(0,r.kt)("p",null,"Check our ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#sample-code---hosted-payment-fields"},"sample code")," to get a ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," using HTML."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"An expiry month of ",(0,r.kt)("strong",{parentName:"p"},"12")," (December) will simulate the non frictionless flow and a challenge will appear to the cardholder. ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n// Setup PHP session as use it to store data between 3DS steps\nif (isset($_GET['sid'])) {\n    session_id($_GET['sid']);\n}\n\nsession_start();\n// Compose current page URL (removing any sid and acs parameters)\n$pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://') . $_SERVER['SERVER_NAME'] . ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : '') . preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n$pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n// If ACS response into the IFRAME then redirect back to parent window\nif (!empty($_GET['acs'])) {\n    echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n    exit();\n}\n\nif (!isset($_POST['threeDSResponse'])) {\n    // Initial request\n\n    // Gather browser info - can be done at any time prior to the checkout\n    if (!isset($_POST['browserInfo'])) {\n        echo Gateway::collectBrowserInfo();\n        exit();\n    }\n\n    // Direct Request\n    $req = array(\n        'merchantID' => 155928,\n        'action' => 'PREAUTH',\n        'type' => 1,\n        'currencyCode' => 826,\n        'countryCode' => 826,\n        'amount' => 100,\n        //paymentToken generated by Hosted Payment Fields \n        //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n        'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTA4NDc0Mn19',\n        'customerEmail' => 'example@example.com',\n        'customerAddress' => 'Merevale Avenue Leicester',\n        'customerPostCode' => 'LE10 2BU',\n        'orderRef' => 'Test purchase',\n\n        // The following fields are mandatory for 3DS v2\n        'remoteAddress' => $_SERVER['REMOTE_ADDR'],\n        'threeDSRedirectURL' => $pageUrl . '&acs=1',\n\n        // The following field allows options to be passed for 3DS v2\n        // and the values here are for demonstration purposes only\n        'threeDSOptions' => array(\n            'paymentAccountAge' => '20220601',\n            'paymentAccountAgeIndicator' => '05',\n        ),\n    );\n\n    // Add the browser info as it is mandatory for 3DS v2\n    $req += $_POST['browserInfo'];\n\n} else {\n\n    $req = array(\n        // The following field are only required for tbe benefit of the SDK \n        'merchantID' => '155928',\n        'action' => 'PREAUTH',\n\n        // The following field must be passed to continue the 3DS request\n        'threeDSRef' => $_SESSION['threeDSRef'],\n        'threeDSResponse' => $_POST['threeDSResponse'],\n    );\n\n}\n\ntry {\n    $res = Gateway::directRequest($req);\n} catch (\\Exception $e) {\n    // You should exit gracefully\n    die('Sorry, the request could not be sent: ' . $e);\n}\n\nprint $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_3DS_AUTHENTICATION_REQUIRED) {\n    // Send request to the ACS server displaying response in an IFRAME\n\n    // Render an IFRAME to show the ACS challenge (hidden for fingerprint method)\n    $style = (isset($res['threeDSRequest']['threeDSMethodData']) ? 'display: none;' : '');\n    echo \"<iframe name=\\\"threeds_acs\\\" style=\\\"height:420px; width:420px; {$style}\\\"></iframe>\\n\";\n\n    // Silently POST the 3DS request to the ACS in the IFRAME\n    echo silentPost($res['threeDSURL'], $res['threeDSRequest'], 'threeds_acs');\n\n    // Remember the threeDSRef as need it when the ACS responds\n    $_SESSION['threeDSRef'] = $res['threeDSRef'];\n\n} else if ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n    echo \"<p>Thank you for your Preauth.</p>\";\n} else {\n    echo \"<p>Failed to take Preauth: \" . htmlentities($res['responseMessage']) . \"</p>\";\n}\n\n// Render HTML to silently POST data to URL in target brower window \nfunction silentPost($url = '?', array $post = null, $target = '_self')\n{\n    $url = htmlentities($url);\n    $target = htmlentities($target);\n    $fields = '';\n\n    if ($post) {\n        foreach ($post as $name => $value) {\n            $fields .= Gateway::fieldToHtml($name, $value);\n        }\n    }\n\n    $ret = \"\n <form id=\\\"silentPost\\\" action=\\\"{$url}\\\" method=\\\"post\\\" target=\\\"{$target}\\\">\n {$fields}\n <noscript><input type=\\\"submit\\\" value=\\\"Continue\\\"></noscript\n </form>\n <script>\n window.setTimeout('document.forms.silentPost.submit()', 0);\n <\/script>\n \";\n\n    return $ret;\n}\n\n?>\n")),(0,r.kt)("h3",{id:"refund_sale"},"REFUND_SALE"),(0,r.kt)("p",null,"The following example PHP code shows how to do a ",(0,r.kt)("strong",{parentName:"p"},"REFUND_SALE")," transaction, the previous SALE transaction should be specified using the ",(0,r.kt)("inlineCode",{parentName:"p"},"xref")," field, using the ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#gateway-library-php"},"Gateway library"),"."),(0,r.kt)("p",null,"Partial refunds are allowed by specifying the amount to refund. Any amount must not be greater than the original received amount minus any already refunded amount. Multiple partial refunds may be made while there is still a portion of the originally received amount un-refunded. "),(0,r.kt)("p",null,"It can ",(0,r.kt)("strong",{parentName:"p"},"only")," be performed on transactions that have been successfully settled"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\nsession_start();\n// Compose current page URL (removing any sid and acs parameters)\n$pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://') . $_SERVER['SERVER_NAME'] . ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : '') . preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n$pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n// Direct Request\n$req = array(\n  'merchantID' => 155928,\n  'action' => 'REFUND_SALE',\n  'orderRef' => 'Test Refund',\n\n  //XREF from previously transaction\n  'xref' => '11223344556677889911223',\n);\n\ntry {\n  //echo var_dump ($req);\n  $res = Gateway::directRequest($req);\n} catch (\\Exception $e) {\n\n  // You should exit gracefully\n  die('Sorry, the request could not be sent: ' . $e);\n}\n\nprint $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n  echo \"<p>Refund done successfully.</p>\";\n\n} else {\n  echo \"<p>Failed to take refund: \" . htmlentities($res['responseMessage']) . \"</p>\";\n}\n\n?>\n")),(0,r.kt)("h3",{id:"refund"},"REFUND"),(0,r.kt)("p",null,"The following example PHP code shows how to do a ",(0,r.kt)("strong",{parentName:"p"},"REFUND")," (amount \xa322,00) transaction using the ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#gateway-library-php"},"Gateway library"),":"),(0,r.kt)("p",null,"This is an independent refund and need not be related to any previous SALE. The amount is therefore not limited by any original received amount."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\nsession_start();\n// Compose current page URL (removing any sid and acs parameters)\n$pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://') . $_SERVER['SERVER_NAME'] . ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : '') . preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n$pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n// Direct Request\n$req = array(\n  'merchantID' => 155928,\n  'action' => 'REFUND',\n  'type' => 1,\n  'currencyCode' => 826,\n  'countryCode' => 826,\n  'amount' => '2200',\n  //paymentToken generated by Hosted Payment Fields \n  //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n  'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MjA3NjU0Nn19',\n  'customerPostCode' => 'LE10 2BU',\n  'customerName' => 'Test Customer',\n  'orderRef' => 'Test Refund',\n);\n\ntry {\n  //echo var_dump ($req);\n  $res = Gateway::directRequest($req);\n} catch (\\Exception $e) {\n\n  // You should exit gracefully\n  die('Sorry, the request could not be sent: ' . $e);\n}\n\nprint $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n  echo \"<p>Refund done successfully.</p>\";\n\n} else {\n  echo \"<p>Failed to take refund: \" . htmlentities($res['responseMessage']) . \"</p>\";\n}\n\n?>\n")),(0,r.kt)("h3",{id:"capture"},"CAPTURE"),(0,r.kt)("p",null,"The following example PHP code shows how to do a ",(0,r.kt)("strong",{parentName:"p"},"CAPTURE")," using the ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#gateway-library-php"},"Gateway library"),"."),(0,r.kt)("p",null,"This will capture an existing transaction, identified using the ",(0,r.kt)("inlineCode",{parentName:"p"},"xref")," request field, making it available for settlement at the next available opportunity. It can only be performed on transactions that have been authorised but not yet captured. An amount to capture may be specified but must not exceed the original amount authorised. "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE"),": The original transaction must have been submitted with a ",(0,r.kt)("inlineCode",{parentName:"p"},"captureDelay")," value that prevented immediate capture and settlement leaving the transaction in an authorised but un-captured state."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\nsession_start();\n// Compose current page URL (removing any sid and acs parameters)\n$pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://') . $_SERVER['SERVER_NAME'] . ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : '') . preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n$pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n// Direct Request\n$req = array(\n  'merchantID' => 155928,\n  'action' => 'CAPTURE',\n\n  //XREF from previously transaction\n  'xref' => '11223344556677889911223',\n);\n\ntry {\n  //echo var_dump ($req);\n  $res = Gateway::directRequest($req);\n} catch (\\Exception $e) {\n\n  // You should exit gracefully\n  die('Sorry, the request could not be sent: ' . $e);\n}\n\nprint $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n  echo \"<p>Capture done successfully.</p>\";\n\n} else {\n  echo \"<p>Failed to Capture: \" . htmlentities($res['responseMessage']) . \"</p>\";\n}\n\n?>\n")),(0,r.kt)("h3",{id:"cancel"},"CANCEL"),(0,r.kt)("p",null,"The following example PHP code shows how to do a ",(0,r.kt)("strong",{parentName:"p"},"CANCEL")," using the ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#gateway-library-php"},"Gateway library"),"."),(0,r.kt)("p",null,"This will cancel an existing transaction, identified using the ",(0,r.kt)("inlineCode",{parentName:"p"},"xref")," request field, preventing it from being settled. It can only be performed on transactions, which have been authorised but not yet settled, and it is not reversible"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\nsession_start();\n// Compose current page URL (removing any sid and acs parameters)\n$pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://') . $_SERVER['SERVER_NAME'] . ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : '') . preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n// Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n$pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n// Direct Request\n$req = array(\n  'merchantID' => 155928,\n  'action' => 'CANCEL',\n\n  //XREF from previously transaction\n  'xref' => '11223344556677889911223',\n);\n\ntry {\n  //echo var_dump ($req);\n  $res = Gateway::directRequest($req);\n} catch (\\Exception $e) {\n\n  // You should exit gracefully\n  die('Sorry, the request could not be sent: ' . $e);\n}\n\nprint $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n  echo \"<p>Cancel done successfully.</p>\";\n\n} else {\n  echo \"<p>Failed to Cancel: \" . htmlentities($res['responseMessage']) . \"</p>\";\n}\n\n?>\n")),(0,r.kt)("h3",{id:"query"},"QUERY"),(0,r.kt)("p",null,"The following example PHP code shows how to do a ",(0,r.kt)("strong",{parentName:"p"},"QUERY")," using the ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#gateway-library-php"},"Gateway library"),"."),(0,r.kt)("p",null,"This will query an existing transaction, identified using the ",(0,r.kt)("inlineCode",{parentName:"p"},"xref")," request field, returning the original response. "),(0,r.kt)("p",null,"In this type of transaction it is NOT necessary to obtain the cardholder's card details, therefore, there is no need to obtain a ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken"),". This is a simple transaction lookup action."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'<?PHP\n\nrequire(\'gateway.php\');\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = \'3obzOxdqw6e1u\';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = \'https://commerce-api.handpoint.com/direct/\';\n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER[\'HTTPS\']) && $_SERVER[\'HTTPS\'] == \'on\') ? \'https://\' : \'http://\'). $_SERVER[\'SERVER_NAME\']. ($_SERVER[\'SERVER_PORT\'] != \'80\' ? \':\' . $_SERVER[\'SERVER_PORT\'] : \'\'). preg_replace(\'/(sid=[^&]+&?)|(acs=1&?)/\', \'\', $_SERVER[\'REQUEST_URI\']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, \'?\') === false ? \'?\' : \'&\') . \'sid=\' . urlencode(session_id());\n \n // Direct Request\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      \'merchantID\' => \'155928\',\n      \'action\' => \'QUERY\',\n\n      //XREF from previously transaction\n      \'xref\' => \'11223344556677889911223\',\n    );\n\n try {\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die(\'Sorry, the request could not be sent: \' . $e);\n }\n\n// Check the response code\nif ($res[\'responseCode\'] === Gateway::RC_SUCCESS) {\n\n //Example of some fields:\n echo "QUERY transaction:";\n echo "<br>";\n echo "ResponseStatus:"." ".$res[\'responseStatus\'];\n echo "<br>";\n echo "ResponseMessage:"." ".$res[\'responseMessage\'];\n echo "<br>";\n echo "Action:"." ".$res[\'action\'];\n echo "<br>";\n echo "Amount:"." ".$res[\'amount\'] ;\n echo "<br>";\n echo "XREF:"." ". $res[\'xref\'];\n echo "<br>";\n echo "TransactionID:"." ".$res[\'transactionID\'];\n echo "<br>";\n echo "State:"." ".$res[\'state\'];\n echo "<br>";\n echo "Timestamp:"." ".$res[\'timestamp\'];\n echo "<br>";\n echo "CardNumberMask:"." ".$res[\'cardNumberMask\'];\n echo "<br>";\n echo "CardTypeCode:"." ".$res[\'cardTypeCode\'];\n echo "<br>";\n echo "CardType:"." ".$res[\'cardType\'];\n echo "<br>";\n echo "CardSchemeCode:"." ".$res[\'cardSchemeCode\'];\n echo "<br>";\n echo "CardScheme:"." ".$res[\'cardScheme\'];\n echo "<br>";\n echo "CardIssuer:"." ".$res[\'cardIssuer\'];\n\n   } else {\n        echo "<p>Failed to take payment: " . htmlentities($res[\'responseMessage\']) . "</p>";\n  }\n\n?>\n\n')),(0,r.kt)("h2",{id:"3ds-example-php-code"},"3DS Example (PHP Code)"),(0,r.kt)("p",null,"The following example shows the complete 3D Secure process. When executing this code, the different phases of the 3DS process are displayed on the screen."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": Requires adding the value to the ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," field"),(0,r.kt)("p",null,"It allows you to choose between 3 different cards (Visa, Mastercard and AMEX) and allows you to select the expiration month of the selected card."),(0,r.kt)("p",null,"Each month represents a different authentication status returned by the Directory Server (for frictionless flow simulation). ",(0,r.kt)("a",{parentName:"p",href:"/hostedpaymentfields/samplecode#3d-secure-testing"},"Here")," you can check the meaning of each month."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nconst MERCHANT_SECRET_KEY = '3obzOxdqw6e1u';\nconst MERCHANT_ID = '155928';\nconst GATEWAY_URL = 'https://commerce-api.handpoint.com/direct/';\n\n\nif (isset($_GET['run'])) {\n    run();\n} elseif (isset($_GET['3dscallback'])) {\n    threeDSCallback();\n} else {\n    run();\n}\n\nfunction run()\n{\n\n    $threeDSRedirectURL = (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on' ? \"https://\" : \"http://\") . $_SERVER['HTTP_HOST'] . $_SERVER['PHP_SELF'];\n\n    $request = array(\n        'action' => 'SALE',\n        'amount' => '150',\n        'countryCode' => '826',\n        'currencyCode' => '826',\n        'customerAddress' => (isset($_POST['cardAddress']) ? $_POST['cardAddress'] : 'Merevale Avenue Leicester'),\n        'customerEmail' => 'email@exampledomainnamehere.com',\n        'customerPostCode' => (isset($_POST['cardPostCode']) ? $_POST['cardPostCode'] : 'LE10 2BU'),\n        'paymentToken' => 'Insert here your paymentToken',\n        'merchantID' => MERCHANT_ID,\n        'type' => '1',\n        'orderRef' => 'Test',\n        'remoteAddress'             =>  $_SERVER['REMOTE_ADDR'],\n        'threeDSRedirectURL'        => \"{$threeDSRedirectURL}?3dscallback\",\n        'deviceChannel'                => 'browser',\n        'deviceIdentity'            => (isset($_SERVER['HTTP_USER_AGENT']) ? htmlentities($_SERVER['HTTP_USER_AGENT']) : null),\n        'deviceTimeZone'            => '0',\n        'deviceScreenResolution'    => '1x1x1',\n        'deviceAcceptContent'        => (isset($_SERVER['HTTP_ACCEPT']) ? htmlentities($_SERVER['HTTP_ACCEPT']) : '*/*'),\n        'deviceAcceptEncoding'        => (isset($_SERVER['HTTP_ACCEPT_ENCODING']) ? htmlentities($_SERVER['HTTP_ACCEPT_ENCODING']) : '*'),\n        'deviceAcceptLanguage'        => (isset($_SERVER['HTTP_ACCEPT_LANGUAGE']) ? htmlentities($_SERVER['HTTP_ACCEPT_LANGUAGE']) : 'en-gb;q=0.001'),\n        'deviceAcceptCharset'        => (isset($_SERVER['HTTP_ACCEPT_CHARSET']) ? htmlentities($_SERVER['HTTP_ACCEPT_CHARSET']) : null),\n\n    );\n\n    $request['signature'] = createSignature($request, MERCHANT_SECRET_KEY);\n\n    $response = sendRequest($request, GATEWAY_URL);\n\n    $html = <<<HTML\n      <div class=\"card\">\n        <div class=\"card-header\">\n           <h5> Request to gateway</h5>\n        </div>\n        <div class=\"card-body\">\n    HTML;\n\n\n    $html .= '<pre>' .  print_r($request, true) . '</pre>';\n\n    $ret = http_build_query($request, '', '&');\n    // Normalise all line endings (CRNL|NLCR|NL|CR) to just NL (%0A)  \n    $ret = str_replace(array('%0D%0A', '%0A%0D', '%0D'), '%0A', $ret);\n\n    $html .= '<h5>URL Encoded</h5>';\n    $html .= '</p>' . $ret . '</p>';\n    $html .= '</div></div>';\n    $html .= <<<HTML\n<div class=\"card-header\" style=\"margin-top: 20px;\">\n<h5>Response from gateway</h5>\n</div>\n<div class=\"card-body\">\nHTML;\n\n\n    $html .= '<pre>' .  print_r($response, true) . '</pre>';\n\n    if ($response['responseCode'] == 65802) {\n\n        $html .= \"<p>Your transaction requires 3D Secure Authentication</p>\";\n\n        // Store the threeDSRef in a cookie for reuse.  (this is just one way of storeing it)\n        setcookie('threeDSRef', $response['threeDSRef'], time() + 1500);\n\n        $ref = $response['threeDSRef'];\n\n        $html .= \"<p>The threeDSRef now needs to stored be on the merchant side. In this example it's being stored to a cookie so it can be retreived after 3DS has called back</p>\";\n\n        $html .= \"<p>ThreeDS Ref being stored : {$ref}</p>\";\n\n        $threeDSUrl = $response['threeDSURL'];\n\n        $html .= \"<p>Next a POST request needs to be sent to the 3DS URL provided in the threeDSURL field in the response which is {$threeDSUrl} this post request\n    needs to contain the fields provided in the gateways response threeDSRequest field. These fields are \";\n\n        // For each of the fields in threeDSRequest output a hidden input field with it's key/value\n        foreach ($response['threeDSRequest'] as $key => $value) {\n            $html .= \"<p>Name : {$key}  with a value of {$value} </p>\";\n        }\n\n        $html .= \"<p>Along with these fields the threeDSRef from the response is also sent. </p></p>\";\n\n        // Start of HTML form with URL\n        $html .= \"<form action=\\\"\" . htmlentities($response['threeDSURL']) . \"\\\"method=\\\"post\\\">\";\n\n        // Add threeDSRef from the gateway response\n        $html .= '<input type=\"hidden\" name=\"threeDSRef\" value=\"' . $response['threeDSRef'] . '\">';\n\n        // For each of the fields in threeDSRequest output a hidden input field with it's key/value\n        foreach ($response['threeDSRequest'] as $key => $value) {\n            $html .= '<input type=\"hidden\" name=\"' . $key . '\" value=\"' . $value . '\">';\n        }\n\n        $html .= '<pre><code>&lt;form action=\"https://acs.3ds-pit.com/?method\" method=\"post\"&gt;\n        &lt;input type=\"hidden\" name=\"threeDSRef\" value=\"UDNLRVk6dHJhbnNhY3Rpb25JRD0xNTAyNzk0MjgmbWVyY2hhbnRJRD0xMDA4NTYmX19saWZlX189MTY0MzI5Nzk5Mg==\"&gt;\n        &lt;input type=\"hidden\" name=\"threeDSMethodData\" value=\"eyJ0aHJlZURTTWV0aG9kTm90aWZpY2F0aW9uVVJMIjoiaHR0cDovLzEyNy4wLjAuMTo4MDgwLzNkc3YyLWV4YW1wbGUucGhwPzNkc2NhbGxiYWNrPSZ0aHJlZURTQWNzUmVzcG9uc2U9bWV0aG9kIiwidGhyZWVEU1NlcnZlclRyYW5zSUQiOiIxNGE2YTYyZS0yZjRjLTQxNjYtYWYwYi1jNTJmN2M0ZGFjMjUifQ\"&gt;&lt;pre&gt;&lt;code&gt;&lt;input type=\"hidden\" name=\"threeDSRef\" value=\"UDNLRVk6dHJhbnNhY3Rpb25JRD0xNTAyNzkzNzkmbWVyY2hhbnRJRD0xMDA4NTYmX19saWZlX189MTY0MzI5Nzk2MA==\"&gt;&lt;input type=\"hidden\" name=\"threeDSMethodData\" value=\"eyJ0aHJlZURTTWV0aG9kTm90aWZpY2F0aW9uVVJMIjoiaHR0cDovLzEyNy4wLjAuMTo4MDgwLzNkc3YyLWV4YW1wbGUucGhwPzNkc2NhbGxiYWNrPSZ0aHJlZURTQWNzUmVzcG9uc2U9bWV0aG9kIiwidGhyZWVEU1NlcnZlclRyYW5zSUQiOiJhMzczOTkxMy1kMzdlLTQyZjMtYmFhNC04NjNmOTgwMzMyYzEifQ\"&gt;&lt;pre&gt;&lt;code&gt;%3Cform+action%3D%22https%3A%2F%2Facs.3ds-pit.com%2F%3Fmethod%22+method%3D%22post%22%3E%0D%0A%3Cinput+type%3D%22hidden%22+name%3D%22threeDSRef%22+value%3D%22UDNLRVk6dHJhbnNhY3Rpb25JRD0xNTAyNzkwOTEmbWVyY2hhbnRJRD0xMDA4NTYmX19saWZlX189MTY0MzI5Nzc5MQ%3D%3D%22%3E%3Cinput+type%3D%22hidden%22+name%3D%22threeDSMethodData%22+value%3D%22eyJ0aHJlZURTTWV0aG9kTm90aWZpY2F0aW9uVVJMIjoiaHR0cDovLzEyNy4wLjAuMTo4MDgwLzNkc3YyLWV4YW1wbGUucGhwPzNkc2NhbGxiYWNrPSZ0aHJlZURTQWNzUmVzcG9uc2U9bWV0aG9kIiwidGhyZWVEU1NlcnZlclRyYW5zSUQiOiI2MWUzNDJmNC1hZDg2LTQ2YzYtYmMxYy1iYzFiZjIwYWU1NzQifQ%22%3E%0D%0A%3Cinput+type%3D%22submit%22+value%3D%22Continue%22%3E%0D%0A%3C%2Fform%3E&lt;/code&gt;&lt;/pre&gt;&lt;input type=\"submit\" value=\"Continue\"&gt;\n        &lt;/form&gt;</pre></code>';\n        // End of html form with submit button.\n\n        $html .= \"<input type=\\\"submit\\\" value=\\\"Continue\\\">\n            </form>\";\n    }\n\n\n    $html .= '</div></div>';\n\n    echo renderPage('3DSv2 Test', $html, 'Initial request to gateway');\n}\n\nfunction threeDSCallback()\n{\n\n    //ACS Response\n    $html = <<< HTML\n      <div class=\"card\">\n        <div class=\"card-header\">\n           <h5>Response from ACS</h5>\n        </div>\n        <div class=\"card-body\">\n    HTML;\n\n    $html .= '<pre>' .  print_r($_POST, true) . '</pre>';\n\n    $threeDSRequest = array(\n        'threeDSRef' => $_COOKIE['threeDSRef'], // This is the threeDSref store in the cookie from the previous gateway response.\n        'threeDSResponse' => $_POST, // <-- Note here no fields are hard coded. Whatever is POSTED from 3DS is returned.\n    );\n\n    // Send the 3DS response back to the gateway and get the response.\n    $gatewayResponse = sendRequest($threeDSRequest, GATEWAY_URL);\n\n    // Store the new threeDSRef in the cookie again because it may change.\n    setcookie('threeDSRef', $gatewayResponse['threeDSRef'], time() + 1500);\n\n    $html .= '</div></div>';\n\n\n    $html .= <<< HTML\n      <div class=\"card\" style=\"margin-top: 10px\">\n        <div class=\"card-header\">\n           <h5>Request to gateway</h5>\n        </div>\n        <div class=\"card-body\">\n    HTML;\n\n\n    $html .= '<pre>' .  print_r($threeDSRequest, true) . '</pre>';\n\n    $html .= '<h5>Url encoded</h5>';\n    $ret = http_build_query($threeDSRequest, '', '&');\n    // Normalise all line endings (CRNL|NLCR|NL|CR) to just NL (%0A)  \n    $ret = str_replace(array('%0D%0A', '%0A%0D', '%0D'), '%0A', $ret);\n    $html .= $ret;\n\n    $html .= '</div></div>';\n\n\n    $html .= <<< HTML\n    <div class=\"card\" style=\"margin-top: 10px; margin-bottom: 100px\">\n      <div class=\"card-header\">\n         <h5>Response from gateway</h5>\n      </div>\n      <div class=\"card-body\">\n  HTML;\n\n    $html .= '<pre>' .  print_r($gatewayResponse, true) . '</pre>';\n\n\n    if ($gatewayResponse['responseCode'] == 65802) {\n\n        $html .= \"<p>Your transaction requires 3D Secure Authentication</p>\";\n\n        // Store the threeDSRef in a cookie for reuse.  (this is just one way of storeing it)\n        setcookie('threeDSRef', $gatewayResponse['threeDSRef'], time() + 500);\n\n        $ref = $gatewayResponse['threeDSRef'];\n\n        $html .= \"<p>The threeDSRef now needs to be stored again on the merchant side.</p>\";\n\n        $html .= \"<label>Three DS Ref being stored : {$ref}</label>\";\n\n        $threeDSUrl = $gatewayResponse['threeDSURL'];\n\n        $html .= \"<p>Next a POST request needs to be sent to the 3DS URL provided in the threeDSURL field in the response which is {$threeDSUrl} this post request\n    needs to contain the fields provided in the gateways response threeDSRequest field. These fields are \";\n\n        // For each of the fields in threeDSRequest output a hidden input field with it's key/value\n        foreach ($gatewayResponse['threeDSRequest'] as $key => $value) {\n            $html .= \"<p>Name : {$key}  with a value of {$value}</p>\";\n        }\n\n        // Start of HTML form with URL\n        $html .= \"<form action=\\\"\" . htmlentities($gatewayResponse['threeDSURL']) . \"\\\"method=\\\"post\\\">\";\n\n        // Add threeDSRef from the gateway response\n        $html .= '<input type=\"hidden\" name=\"threeDSRef\" value=\"' . $gatewayResponse['threeDSRef'] . '\">';\n\n        // For each of the fields in threeDSRequest output a hidden input field with it's key/value\n        foreach ($gatewayResponse['threeDSRequest'] as $key => $value) {\n            $html .= '<input type=\"hidden\" name=\"' . $key . '\" value=\"' . $value . '\">';\n        }\n\n        // End of html form with submit button.\n        $html .= \"<input type=\\\"submit\\\" value=\\\"Continue\\\">\n                </form>\";\n    } else {\n\n        $html .= 'Transaction Complete';\n        $html .= '<a href=\"?menu\" class=\"btn btn-primary\" role=\"button\">Return to menu</a>';\n    }\n\n    $html .= '</div></div>';\n\n    echo renderPage('3DS Callback', $html, '3DS Callback');\n}\n\n\n\nfunction renderPage($title, $body, $jumotronText = null)\n{\n    $html = <<< HTML\n    <!doctype html>\n    <html lang=\"en\">\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n        <meta name=\"description\" content=\"\">\n        <meta name=\"author\" content=\"\">\n        <link rel=\"icon\" href=\"/docs/4.0/assets/img/favicons/favicon.ico\">\n    \n        <title>{$title}</title>\n        <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css\">\n        <script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js\"><\/script>\n        <script src=\"https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js\"><\/script>\n        <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js\"><\/script>\n      </head>\n    \n      <body>\n      <div class=\"jumbotron text-center\">\n        <h1>{$jumotronText}</h1>\n    </div>\n\n      <main role=\"main\" class=\"container\">\n{$body}\n    </main>\n      </body>\n    </html>\nHTML;\n\n    return $html;\n}\n\n\n\n/**\n * Send request\n * \n * @param Array $request\n * @param String $gatewayURL\n * \n * @return Array $responseponse\n */\nfunction sendRequest($request, $gatewayURL)\n{\n    // Send request to the gateway\n\n    // Initiate and set curl options to post to the gateway  \n    $ch = curl_init($gatewayURL);\n    curl_setopt($ch, CURLOPT_POST, true);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($request));\n    curl_setopt($ch, CURLOPT_HEADER, false);\n    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n\n    // Send the request and parse the response  \n    parse_str(curl_exec($ch), $response);\n\n    // Close the connection to the gateway  \n    curl_close($ch);\n\n    return $response;\n}\n\n\n\n/**\n * Sign request\n * \n * @param Array $data\n * @param String $key\n * \n * @return String Hash\n */\nfunction createSignature(array $data, $key)\n{\n    // Sort by field name  \n    ksort($data);\n\n    // Create the URL encoded signature string  \n    $ret = http_build_query($data, '', '&');\n\n    // Normalise all line endings (CRNL|NLCR|NL|CR) to just NL (%0A)  \n    $ret = str_replace(array('%0D%0A', '%0A%0D', '%0D'), '%0A', $ret);\n\n    // Hash the signature string and the key together  \n    return hash('SHA512', $ret . $key);\n}\n")),(0,r.kt)("h2",{id:"hosted-payment-fields-library"},"Hosted Payment Fields Library"),(0,r.kt)("p",null,"A simple client-side script is available to support the displaying of Hosted Payment Fields in your payment form."),(0,r.kt)("p",null,"The library is available as a JavaScript script and is based around two classes: the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," classes. The script is compatible with most modern web browsers."),(0,r.kt)("p",null,"The script can be loaded directly from our Gateway server as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'<script src="https://commerce-api.handpoint.com/sdk/web/v1/js/hostedfields.min.js"><\/script>\n')),(0,r.kt)("p",null,"The script requires the jQuery API, which must be loaded prior to the script."),(0,r.kt)("p",null,"Hosted Payment Fields are a set of prebuilt JavaScript UI components that can be used by your website\u2019s HTML payment form to collect sensitive payment details without those details touching your server. They provide you with the PCI benefits of using a Hosted Payment Page, while allowing you the ability to design and implement your own payment forms."),(0,r.kt)("p",null,"There are 6 predefined Hosted Payment Fields available as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"cardNumber \u2013 collects the card number."),(0,r.kt)("li",{parentName:"ul"},"cardCVV \u2013 collects the card cvv."),(0,r.kt)("li",{parentName:"ul"},"cardExpiryDate \u2013 collects the card expiry month and year."),(0,r.kt)("li",{parentName:"ul"},"cardStartDate \u2013 collects the card start/issue month and year."),(0,r.kt)("li",{parentName:"ul"},"cardIssueNumber \u2013 collects the card issue number."),(0,r.kt)("li",{parentName:"ul"},"cardDetails \u2013 collects the card number, expiry date and cvv in a single field.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"cardNumber")," field is designed to collect a card number, including an icon used to display the card type. The field will only accept digits and spaces and validate that any entered value is a correctly formatted card number and insert spaces at the correct positions for the card type as the number is typed."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"cardCVV")," field is designed to collect a card CVV. The field will only accept digits and will validate that any entered value is a correctly formatted CVV, taking into account the card type as determined by an associated ",(0,r.kt)("inlineCode",{parentName:"p"},"cardNumber")," field."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiryDate")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"cardStartDate")," fields are designed to collect a card expiry date and card issue date respectively. The fields can render as a pair of select controls containing the months and a suitable range of years; or as an input control that will only allow digits to be entered and automatically formatted as a month / year entry. The field will validate that any entered value is a valid month and year combination."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"cardIssueNumber")," field is designed to collect a card issue number. The field will only accept digits and will validate that any entered value is a correctly formatted issue number."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"cardDetails")," field is designed to collect all of the essential card details. It combines the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardNumber"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiryDate")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"cardCVV")," fields into a single line compound field design to allow easy entry of the card details and to complement the look of your checkout."),(0,r.kt)("p",null,"These hosted fields can be used on your payment form alongside any standard HTML form fields, for example, any collecting the Cardholder\u2019s billing or delivery addresses and any other order information you require."),(0,r.kt)("p",null,"The field type is either: passed as the value of the ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," option the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," construction, provided by the HTML element\u2019s meta data; or provided via the HTML element\u2019s type attribute (prefixed with the \u2018hostedfield:\u2019 name space)."),(0,r.kt)("p",null,"The following example shows all three approaches to specifying the field type:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'1. `<input type="hostedfield:cardNumber" name="card-number">`\n2. `<div class="hostedfield" data-hostedfield-type="cardExpiryDate"></div> `\n3. `<input data-hostedfield=\'{"type":"cardCVV"}\'>`\n')),(0,r.kt)("h3",{id:"library-namespace"},"Library Namespace"),(0,r.kt)("p",null,"To avoid polluting the global namespace, the library extends the global ",(0,r.kt)("inlineCode",{parentName:"p"},"window")," object with a ",(0,r.kt)("inlineCode",{parentName:"p"},"hostedFields")," object containing the following properties:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"forms")," \u2013 array containing all the instantiated Form objects."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"classes")," \u2013 array containing all the instantiable classes.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"form")," \u2013 ",(0,r.kt)("inlineCode",{parentName:"li"},"Form")," class prototype.")))),(0,r.kt)("h3",{id:"form-construction"},"Form Construction"),(0,r.kt)("p",null,"The construction method can be used to prepare a HTML FORM for use with Hosted Payment Field components. The method signature is as follows:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Form(element, options)")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"element")," parameter should be the DOM node of an existing FORM tag."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," parameter should be object containing one of more of the following optional properties:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"autoSetup")," \u2013 boolean indicating whether setup should be handled automatically."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"autoSubmit")," \u2013 boolean indicating whether submission should be handled automatically."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"merchantID")," \u2013 string containing the merchantID the payment request is for."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"stylesheet")," \u2013 string containing DOM selector for any stylesheets to be used."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"tokenise")," \u2013 string/array/object specifying fields whose values should be tokenised."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"fields")," \u2013 object containing field configuration by field type."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"locale")," \u2013 string containing the desired locale."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"classes")," \u2013 object containing names of extra CSS classes to use."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"submitOnEnter")," \u2013 boolean indicating whether the enter key should cause the form to submit."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"nativeEvents")," \u2013 boolean indicating that native browser events should be fired.")),(0,r.kt)("p",null,"Any ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," parameter will be merged with those provided via meta data supplied, using data-hostedfield and/or ",(0,r.kt)("inlineCode",{parentName:"p"},"data-hostedfield-<option>")," attributes; or via existing attributes or properties of the ",(0,r.kt)("inlineCode",{parentName:"p"},"element"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSetup")," option can be used to disable the automatic creation of ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," objects for the FORM child controls by calling the",(0,r.kt)("inlineCode",{parentName:"p"}," autoSetup()")," method during the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," construction. If automatic setup is disabled, then you must manually instantiate ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," objects and attach them to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," as required, using the ",(0,r.kt)("inlineCode",{parentName:"p"},"addField()"),"method. This option or manually calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSetup()")," method minimises the amount of JavaScript you have to write. Automatic operation is good if you don\u2019t need to customise the operation or can\u2019t customise it by reacting to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," events. The option defaults to true and cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSubmit")," option can be used to disable the automatic handling of the FORM submission via the ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSubmit()")," method. If automatic submission is disabled, then you must manually retrieve the sensitive payment details by calling ",(0,r.kt)("inlineCode",{parentName:"p"},"getPaymentDetails()")," and include them in the form submission data. This option or manually calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSubmit()")," method minimises the amount of JavaScript you have to write. Automatic operation is good if you don\u2019t need to customise the operation or can\u2019t customise it by reacting to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," events. The option defaults to true and cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantID")," option can be used to specify the ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantID")," with which the final ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," will be used. The option defaults to the value of any child INPUT node whose name is \u2018merchantID\u2019 and can be changed at runtime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setMerchantID()")," method or by altering the options using the jQuery ",(0,r.kt)("inlineCode",{parentName:"p"},"hostedForm()")," plugin method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"stylesheet")," option can be used to specify a DOM selector used to locate stylesheets that should be parsed for styles related to the Hosted Payment Fields. The option defaults to the DOM selector string ",(0,r.kt)("inlineCode",{parentName:"p"},"\u2018link.hostedfield[rel=stylesheet], style.hostedfield")," and can be changed at runtime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setStylesheet()")," method; or by altering the options using the jQuery ",(0,r.kt)("inlineCode",{parentName:"p"},"hostedForm()")," plugin method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"tokenise")," option can be used to specify addition FORM controls whose values, as returned by the jQuery.val() method, should be included in the final ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken"),".\nThe option\u2019s value must be either:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A string containing a DOM selector used to select one or more controls."),(0,r.kt)("li",{parentName:"ul"},"An array containing values used to jQuery.filter() down to one or more controls."),(0,r.kt)("li",{parentName:"ul"},"An object whose properties are the name of fields to tokenise and whose values are objects containing a selector property used to select a control.")),(0,r.kt)("p",null,"For the first two, the tokenised field\u2019s name will be taken from the controls ",(0,r.kt)("inlineCode",{parentName:"p"},"data-hostedfield-tokenise")," attribute or name attribute. For the third, the name is property name in the tokenise object. If the field\u2019s name is of the format ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken[<name>]"),", then only the ",(0,r.kt)("inlineCode",{parentName:"p"},"<name>"),"part is used. The option defaults to the DOM selector string ",(0,r.kt)("inlineCode",{parentName:"p"},"INPUT.hostedfield-tokenise:not(:disabled)"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"INPUT[data-hostedfield-tokenise]:not(:disabled)"),", ",(0,r.kt)("inlineCode",{parentName:"p"},'INPUT[name^="paymentToken["]:not(:disabled)')," and cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," has been created."),(0,r.kt)("p",null,"Currently only the card details and customer address fields can be tokenised, that is the field\u2019s name must be one of cardExpiryMonth, cardExpiryYear, cardExpiryDate, cardStartMonth, cardStartYear, cardStartDate, cardIssueNumber, customerName, customerCompany, customerAddress, customerTown, customerCountry, customerPostcode or customerCountryCode."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"fields")," options can be used to specify default options for the different types of Hosted Payment Fields. The option\u2019s value should be an object whose properties are the fields type or the wildcard type \u2018any\u2019 and whose values are objects whose properties are the default options for fields of that type. The values can also contain a selector property containing a DOM ",(0,r.kt)("inlineCode",{parentName:"p"},"selector")," that is used during the automatic setup stage to select a FORM\u2019s child element to add as a ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," of the specified type automatically. The option has no default value and cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"locale")," option can be used to specify the language that should be used by the Hosted Payment Fields attached to this ",(0,r.kt)("inlineCode",{parentName:"p"},"Form"),". The option defaults to the value provided by any lang attribute on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element")," or closest ancestor and cannot be changed once the Form has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"classes")," options can be used to specify additional CSS class names to add in addition to the default classes. The value is an object whose properties are the default class name and whose values are a string containing the additional class name(s) to use. The option has no default and cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"submitOnEnter")," option can be used to specify if pressing the enter key when typing a Field value should cause the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," to submit. The option defaults to false and cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"nativeEvents")," option can be used to specify that any associated native event should be fired when a \u2018hostedField:\u2019 prefixed ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," event is fired. For example, when enabled if the \u2018hostedfield:mouseover\u2019 event is fired, then the native \u2018mouseover\u2019 event is also fired. The option defaults to false and cannot be changed once the Form has been created."),(0,r.kt)("p",null,"If not explicitly constructed, a ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," object will be automatically instantiated and attached to the FORM DOM node as soon as any ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," object is instantiated on a child DOM node."),(0,r.kt)("p",null,"Example Form construction is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"}," var form = new window.hostedFields.classes.Form(document.forms[0],{\n    // Auto setup the form creating all hosted fields (default)\n    autoSetup: true,\n\n    // Auto validate, tokenise and submit the form (default)\n    autoSubmit: true,\n\n    // Additional fields to tokenise\n    tokenise: '.add-to-token',\n\n    // Stylesheet selection\n    stylesheets: '#hostedfield-stylesheet',\n\n    // Optional field configuration (by type)\n    fields: {\n        any: {\n            nativeEvents: true\n        },\n        cardNumber: {\n            selector: $('#form2-card-number'),\n            stylesheet: $('style.hostedform, style.hostedform-card-number')\n        }\n    },\n\n    // Additional CSS classes\n    classes: {\n        invalid: 'error'\n    }\n }); \n")),(0,r.kt)("p",null,"Or using meta data on the HTML FORM element:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<form data-hostedfields=\'{"autoSetup":true,"autoSubmit":true,"tokenise":".add-totoken","stylesheets":"#hostedfieldstylesheet","fields":{"any":{"nativeEvents":true},"cardNumber":{"selector":"#form2-cardnumber","stylesheet":"style.hostedform, style.hostedform-cardnumber"}},"classes":{"invalid":"error"}}\' method="post" novalidate="novalidate" lang="en">\n<script>\nvar form = new window.hostedFields.classes.Form{document.forms[0]);\n <\/script> \n')),(0,r.kt)("h3",{id:"form-methods"},"Form Methods"),(0,r.kt)("p",null,"The follow methods are made available by the Form class:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void autoSetup()")),(0,r.kt)("p",null,"Automatically setup the form by scanning the Form element for child nodes to control as Hosted\nPayment Fields. Child nodes are selected if they:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"have a type attribute with a hostedfield:",(0,r.kt)("inlineCode",{parentName:"li"},"<type>")," value (INPUT nodes only)."),(0,r.kt)("li",{parentName:"ul"},"have a data attribute with a hostedfield.",(0,r.kt)("inlineCode",{parentName:"li"},"<type>")," property."),(0,r.kt)("li",{parentName:"ul"},"match a DOM selector provided by the fields.",(0,r.kt)("inlineCode",{parentName:"li"},"<type>"),".selector option.\nIf multiple selection criteria are present, then they must all specify the same Field type or an\nexception is thrown.")),(0,r.kt)("p",null,"This method is called during the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," construction unless the ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSetup")," option is false."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void autoSubmit()")),(0,r.kt)("p",null,"Automatically handles any attempted FORM submission by checking the FORM\u2019s controls are valid by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"validate()")," method; and then requesting the ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," using the ",(0,r.kt)("inlineCode",{parentName:"p"},"getPaymentDetails()")," method; and finally adding the token to the forms fields using the ",(0,r.kt)("inlineCode",{parentName:"p"},"addPaymentToken()")," method. Failure to validate or request the payment token will cause the form submission to be stopped."),(0,r.kt)("p",null,"You can affect the automatic submission stages by listening for events and preventing their\ndefault actions. "),(0,r.kt)("p",null,"This method is attached to the FORM submit event during the Form construction unless the ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSubmit")," option is false, or the ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSubmit")," option is null and the ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSetup")," option is false."),(0,r.kt)("p",null,"If automatic submission is disabled, then you must react to the FORM\u2019s submit event and then\nrequest the ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," using the ",(0,r.kt)("inlineCode",{parentName:"p"},"getPaymentDetails()")," method and ensure that the token is sent as part of the form\u2019s data."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"boolean addField(Field f)")),(0,r.kt)("p",null,"Add a hosted ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form"),"."),(0,r.kt)("p",null,"Returns true if successful, false otherwise."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"boolean delField(Field f)")),(0,r.kt)("p",null,"Remove a hosted ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," from the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form"),"."),(0,r.kt)("p",null,"Returns true if successful, false otherwise."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"promise validate(boolean submitting)")),(0,r.kt)("p",null,"Validate all ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," values on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form"),", either during submission or not."),(0,r.kt)("p",null,"Returns a promise that will be resolved when the validation is complete."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"object[] getInvalidElements()")),(0,r.kt)("p",null,"Get details about all invalid FORM controls (not just invalid hosted ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," elements)."),(0,r.kt)("p",null,"Returns an array of objects containing the following properties:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"element \u2013 DOM element."),(0,r.kt)("li",{parentName:"ul"},"message \u2013 DOM elements validationMessage property or \u2018Invalid value\u2019."),(0,r.kt)("li",{parentName:"ul"},"label \u2013 associated LABEL text."),(0,r.kt)("li",{parentName:"ul"},"field \u2013 Field instance (if DOM element is a hosted Field).")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"object getValidationErrors()")),(0,r.kt)("p",null,"Get the validation errors for all invalid FORM controls (not just invalid hosted ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," elements)."),(0,r.kt)("p",null,"Returns an object whose properties are the associated labels, names or id of the invalid FORM\ncontrols and whose values are the error message for that control."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"promise getPaymentDetails(object tokenData, boolean validate)")),(0,r.kt)("p",null,"Gets the payment details, generating a ",(0,r.kt)("inlineCode",{parentName:"p"},"paymentToken")," containing the hosted Field values; any\nvalues specified by the ",(0,r.kt)("inlineCode",{parentName:"p"},"tokenise")," option; and any passed ",(0,r.kt)("inlineCode",{parentName:"p"},"tokenData"),". The Form will be\nvalidated first if required."),(0,r.kt)("p",null,"Returns a promise that will be resolved when the payment details have been obtained, passing\nthe details as an object containing the following properties:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"success \u2013 boolean true if successful, false otherwise."),(0,r.kt)("li",{parentName:"ul"},"message \u2013 string containing message to display if not successful."),(0,r.kt)("li",{parentName:"ul"},"errors \u2013 object containing details about invalid payment data."),(0,r.kt)("li",{parentName:"ul"},"invalid \u2013 object as returned by getValidationErrors() method."),(0,r.kt)("li",{parentName:"ul"},"paymentToken \u2013 string containing generated paymentToken.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void addPaymentToken(string token)")),(0,r.kt)("p",null,"Add the payment token as the value of a Form child INPUT whose ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," is \u2018paymentToken\u2019,\ncreating the control if needed. Any created control will be given a type of \u2018hidden\u2019."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setMerchantID(string merchantID)")),(0,r.kt)("p",null,"Set the ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantID")," used by the payment form."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setStylesheet(string selector)")),(0,r.kt)("p",null,"Set the DOM selector used to select the stylesheet(s) used by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"object defaultFieldOptions(string type)")),(0,r.kt)("p",null,"Get any default field options specified via the ",(0,r.kt)("inlineCode",{parentName:"p"},"fields")," option, resulting from the merger of its\noptional any and ",(0,r.kt)("inlineCode",{parentName:"p"},"<type>"),"properties."),(0,r.kt)("p",null,"Returns an object whose properties are the default options."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void forceSubmit()")),(0,r.kt)("p",null,"Forcefully submit the FORM ",(0,r.kt)("inlineCode",{parentName:"p"},"element")," as if a child submit button had been clicked."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void reset()")),(0,r.kt)("p",null,"Reset all the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form"),", setting all ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," values back to their initial values."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void destroy()")),(0,r.kt)("p",null,"Destroys the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form"),", reverting its ",(0,r.kt)("inlineCode",{parentName:"p"},"element")," back to its original state."),(0,r.kt)("h3",{id:"form-events"},"Form Events"),(0,r.kt)("p",null,"The following events may be fired by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form")," object and you can use these to hook into and\nmodify the object\u2019s behaviour:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Event Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"create"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Form has been created.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"destroy"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Form has been destroyed.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"presubmit"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired by the autoSubmit() method prior to handling the submission. You can prevent the handling of the submission and handle it yourself by calling the Events preventDefault() method.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"valid"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired by the autoSubmit() method if the FORM contains valid data prior to requesting the payment details. You can prevent the continued handling of the submission and handle it yourself by calling the Events preventDefault() method or by invalidating the FORM.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"submit-invalid"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired by the autoSubmit() method if the FORM contains invalid data prior to displaying the validity using the DOM reportValidity() method. You can prevent the reportValidity() call and display the validity yourself by calling the Events preventDefault() method.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"submit"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired by the autoSubmit() method prior to submitting the FORM. You can prevent the FORM from submitting by calling the Events preventDefault() method.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"error"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired by the autoSubmit() method if an exception is caught prior to displaying the error, using the JavaScript alert() function. You can prevent the alert() call and display the error yourself by calling the Events preventDefault() method.")))),(0,r.kt)("p",null,"Event names are prefixed with the \u2018hostedform:\u2019 namespace not shown in the table."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"presubmit"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"valid"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"submit-invalid"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"submit")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"error")," events fired by the ",(0,r.kt)("inlineCode",{parentName:"p"},"autoSubmit()"),"\nmethod the payload is an object with the following properties:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"success \u2013 boolean false."),(0,r.kt)("li",{parentName:"ul"},"message \u2013 error message if error otherwise null."),(0,r.kt)("li",{parentName:"ul"},"invalid \u2013 result of getValidationErrors() method if Form invalid."),(0,r.kt)("li",{parentName:"ul"},"submitting \u2013 boolean true.")),(0,r.kt)("h3",{id:"field-construction"},"Field Construction"),(0,r.kt)("p",null,"The construction method can be used to prepare a HTML INPUT control as a Hosted Payment Field or to create a new field in HTML DIV container. The method signature is as follows:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Field(element, options)")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"element")," parameter should be the DOM node of an existing INPUT or DIV tag."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," parameter should be object containing one of more of the following optional properties:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"type")," \u2013 string containing the desired field type."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"value")," \u2013 string containing the initial value."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"placeholder")," \u2013 string containing any placeholder text."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"style")," \u2013 string containing any inline CSS styles."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"stylesheet")," \u2013 string containing DOM selector for any stylesheets to be used."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"disabled")," \u2013 boolean indicating if initially disabled."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"required")," \u2013 boolean indicating if the value is required."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"readOnly")," \u2013 boolean indicating if initially read only."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"validity")," \u2013 boolean or string indicating the initial validity."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"locale")," \u2013 string containing the desired locale."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"classes")," \u2013 object containing names of extra CSS classes to use."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"submitOnEnter")," \u2013 boolean indicating if the enter key should cause the form to submit."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"nativeEvents")," \u2013 boolean indicating that native browser events should be fired."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"validationMessages")," \u2013 object containing alternative validation messages.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"required")," \u2013 string containing validation message to use when a value is required."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"invalid")," \u2013 string containing validation message to use when a value is invalid."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"format")," \u2013 string containing select option format for date fields."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"minYear")," \u2013 integer containing minimum year (relative to current year) for date fields."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"maxYear")," \u2013 integer containing maximum year (relative to current year) for date fields.")),(0,r.kt)("p",null,"Any ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," parameter will be merged with those provided via meta data supplied using ",(0,r.kt)("inlineCode",{parentName:"p"},"datahostedfield")," and/or ",(0,r.kt)("inlineCode",{parentName:"p"},"data-hostedfield-<option>")," attributes, or via existing attributes or properties of the ",(0,r.kt)("inlineCode",{parentName:"p"},"element")," or provided via the ",(0,r.kt)("inlineCode",{parentName:"p"},"getDefaultOptions()")," method of the parent ",(0,r.kt)("inlineCode",{parentName:"p"},"Form"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," option can be used to specify the type of Hosted Payment Field required. It defaults to\nthe value provided by any type attribute on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element")," (prefixed with the \u2018hostedfield:\u2019\nnamespace). The option cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has been created. Valid types are\n",(0,r.kt)("inlineCode",{parentName:"p"},"cardDetails"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"cardNumber"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"cardCVV"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiryDate"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"cardStartDate"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"cardIssueNumber"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"value")," option can be used to specify any initial value that should be used by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),". It\ndefaults to the value provided by any value attribute or property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element"),". Obviously, due\nto the purpose of the Hosted Payment Fields, any initial value is not wise for card number and\nCVV fields. The option can be changed at runtime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setValue()")," method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"placeholder")," option can be used to specify any initial text that should be used as a placeholder by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),". It defaults to the value provided by any placeholder attribute or property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element"),". When used with the ",(0,r.kt)("inlineCode",{parentName:"p"},"CardDetails")," type ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," the placeholder contains three parts separated by a pipe character, the first part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardNumber")," placeholder, the second part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiry")," placeholder, and the third part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardCVV")," placeholder. The option can be changed at runtime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setPlaceholder()")," method or by altering the options using the jQuery hostedForm() plugin method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"style")," option can be used to specify any initial inline CSS style that should be used by the\n",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),". It defaults to the value provided by any style attribute or property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element"),". The\noption can be changed at runtime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setStyle()")," method or by altering the options\nusing the jQuery ",(0,r.kt)("inlineCode",{parentName:"p"},"hostedForm()")," plugin method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"stylesheet")," option can be used to specify a DOM selector used to locate stylesheets that should be parsed for styles related to this ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),". Refer to section on styling fields. The option can be changed at runtime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setStylesheet()")," method or by altering the options using the jQuery ",(0,r.kt)("inlineCode",{parentName:"p"},"hostedForm()")," plugin method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"disabled")," option can be used to specify if the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," should be initially disabled. It defaults to\nthe value provided by any disabled attribute or property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element"),". The option can be\nchanged at runtime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setDisabled()")," method or by altering the options using the\njQuery ",(0,r.kt)("inlineCode",{parentName:"p"},"hostedForm()")," plugin method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"required")," option can be used to specify if the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," value is required. It defaults to the value\nprovided by any required attribute or property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element"),". The option can be changed at\nruntime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setRequired()")," method or by altering the options using the jQuery\n",(0,r.kt)("inlineCode",{parentName:"p"},"hostedForm()")," plugin method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"readOnly")," option can be used to specify if the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," should be initially read-only. It defaults to\nthe value provided by any readOnly attribute or property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element"),". The option can be\nchanged at runtime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setReadOnly()")," method or by altering the options using the\njQuery ",(0,r.kt)("inlineCode",{parentName:"p"},"hostedForm()")," plugin method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"validity")," option can be used to specify if the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," should be initially marked as invalid. It\ndefaults to the value provided by any validity property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element"),". The option can be\nchanged at runtime by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"setValidity()")," method or by altering the options using the\njQuery ",(0,r.kt)("inlineCode",{parentName:"p"},"hostedForm()")," plugin method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"locale")," option can be used to specify the language that should be used by the Field. It\ndefaults to the value provided by any lang attribute or property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"element")," or closest\nancestor. The option cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"classes")," options can be used to specify additional CSS class names to add in addition to the\ndefault classes. The value is an object whose properties are the default class name and whose values are a string containing the additional class name(s) to use. This option will be merged with any classes option provided to the Form constructor. The option cannot be changed once the Form has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"submitOnEnter")," option can be used to specify if pressing the enter key when typing the\n",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," value should cause the Form to submit. The option defaults to false and cannot be changed\nonce the Field has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"nativeEvents")," option can be used to specify that any associated native event should be fired\nwhen a \u2018hostedfield:\u2019 prefixed event is fired For example, when enabled if the \u2018hostedfield:mouseover\u2019 event is fired then the native \u2018mouseover\u2019 event is also fired. The option defaults to false and cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"validationMessages")," option can be used to specify alternative validation messages that\nshould be displayed when a value is required or invalid. The option defaults to suitable messages\ndepending on the locale and cannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"dropdown")," option can be used to specify that a ",(0,r.kt)("inlineCode",{parentName:"p"},"cardStartDate")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiryDate")," ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),"\nshould be displayed as a pair of select controls to select the month and year, otherwise the month\nand year are entered via a formatted input box instead. The option defaults to false and cannot be\nchanged once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has been created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"format")," option can be used in conjunction with the ",(0,r.kt)("inlineCode",{parentName:"p"},"dropdown")," option to specify the format used\nto display the month and year in the dropdowns. The month and year parts of the format are\nseparated by a pipe character. The option defaults to \u2018N \u2013 M | Y\u2019 (eg \u201801 \u2013 January | 2020\u2019) and\ncannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has been created."),(0,r.kt)("p",null,"The following formatting characters are understood:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"n \u2013 month number (no zero prefixing)."),(0,r.kt)("li",{parentName:"ul"},"N \u2013 month number (zero prefixed to two digits when required)."),(0,r.kt)("li",{parentName:"ul"},"m \u2013 short month name (eg Jan, Feb, Mar)"),(0,r.kt)("li",{parentName:"ul"},"M \u2013 long month name (eg January, February, March)"),(0,r.kt)("li",{parentName:"ul"},"y \u2013 two digit year number."),(0,r.kt)("li",{parentName:"ul"},"Y \u2013 four digit year number.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"minYear")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"maxYear")," options can be used in conjunction with the ",(0,r.kt)("inlineCode",{parentName:"p"},"dropdown")," option to specify\nthe minimum and maximum years that are included in the year dropdown. The option defaults to\nminus 20 to zero for a ",(0,r.kt)("inlineCode",{parentName:"p"},"cardStartDate")," ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," or zero to plus 20 for a ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiryDate")," Field and\ncannot be changed once the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has been created."),(0,r.kt)("p",null,"Example Field construction is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"}," var field = new window.hostedFields.classes.Field(document.forms[0].elements[0], {\n    // Field type\n    type: 'cardNumber',\n\n    // Stylesheet selection\n    stylesheets: '#hostedfield-stylesheet',\n\n    // Additional CSS classes\n    classes: {\n        invalid: 'error'\n    }\n }); \n")),(0,r.kt)("p",null,"Or using meta data on the HTML INPUT element:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<input type="hostedfield:cardNumber" data-hostedfields=\'{"stylesheet":"style.hostedform, style.hostedform-cardnumber"}},"classes":{"invalid":"error"}}\'>\n<script>\nvar field = new window.hostedFields.classes.Field(document.forms[0].elements[0]);\n<\/script> \n')),(0,r.kt)("h3",{id:"field-methods"},"Field Methods"),(0,r.kt)("p",null,"The following methods are made available by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," class:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"promise validate()")),(0,r.kt)("p",null,"Validate the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," value. This will normally be called automatically when the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," loses focus or the form is submitted, or when an invalid value is modified."),(0,r.kt)("p",null,"Returns a ",(0,r.kt)("inlineCode",{parentName:"p"},"promise")," that will be resolved when the validation is complete."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"boolean isEmpty()")),(0,r.kt)("p",null,"Check if the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has a value."),(0,r.kt)("p",null,"Returns true if the field has a value, false otherwise."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"boolean isComplete()")),(0,r.kt)("p",null,"Check if the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has a complete, but not necessarily valid, value. This is mainly used by compound fields such as ",(0,r.kt)("inlineCode",{parentName:"p"},"cardDetails"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiryDate"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"cardStartDate"),", which contain multiple input controls and are deemed complete when all their required input controls have values."),(0,r.kt)("p",null,"Returns true if the value is complete, false otherwise."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setStyle() / string getStyle()")),(0,r.kt)("p",null,"Set or gets the field\u2019s inline CSS style data."),(0,r.kt)("p",null,"Returns void when setting, or a CSS style string when getting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setStylesheet(string selector) / string getStylesheet()")),(0,r.kt)("p",null,"Sets or gets the DOM selector used to select the stylesheet(s) used by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),". When setting, the stylesheets are parsed and applied to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),"."),(0,r.kt)("p",null,"Returns void when setting, or a DOM selector string when getting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setPlaceholder(string text) / string getPlaceholder()")),(0,r.kt)("p",null,"Sets or gets the placeholder text to be shown when the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," has no value."),(0,r.kt)("p",null,"When used with the ",(0,r.kt)("inlineCode",{parentName:"p"},"CardDetails")," type ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," the placeholder contains three parts separated by a pipe character, the first part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardNumber")," placeholder, the second part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiry")," placeholder, and the third part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardCVV")," placeholder."),(0,r.kt)("p",null,"Returns void when setting, or a text string when getting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setDisabled(boolean disabled) / string getDisabled()")),(0,r.kt)("p",null,"Sets or gets the disabled state of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),". When disabled, the field will be greyed out and not be focusable and thus will not react to any input events."),(0,r.kt)("p",null,"A disabled ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," will have the \u2018hf-disabled\u2019 class added otherwise the \u2018hf-enabled\u2019 class is added."),(0,r.kt)("p",null,"Returns void when setting, or a boolean representing the state when getting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setRequired(boolean required) / string getRequired()")),(0,r.kt)("p",null,"Sets or gets the required state of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),". When required, the field will be invalid if it contains no value or a blank value.`"),(0,r.kt)("p",null,"A required ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," will have the \u2018hf-required\u2019 class added otherwise the \u2018hf-optional\u2019 class is added."),(0,r.kt)("p",null,"Returns void when setting, or a boolean representing the state when getting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setReadOnly(boolean read_only) / string getRequired()")),(0,r.kt)("p",null,"Sets or gets the read-only state of the Field. When read-only, the field will be not be focusable and thus will not react to any input events."),(0,r.kt)("p",null,"A read-only ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," will have the \u2018hf-readonly\u2019 class added otherwise the \u2018hf-readwrite\u2019 class is added."),(0,r.kt)("p",null,"Returns void when setting, or a boolean representing the state when getting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setFocused(boolean focused)")),(0,r.kt)("p",null,"Moves the browser\u2019s focus to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),". When focused, the field will react input events."),(0,r.kt)("p",null,"A focused ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," will have the \u2018hf-focus\u2019 class added otherwise the \u2018hf-blur\u2019 class is added."),(0,r.kt)("p",null,"Returns void when setting, or a boolean representing the state when getting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setValidity(string validity) / string getValidity()")),(0,r.kt)("p",null,"Sets or gets the validity of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),". When valid, the validity will be true or a blank string. When invalid, the validity will be an error message explaining the reason the value is invalid."),(0,r.kt)("p",null,"When used with the ",(0,r.kt)("inlineCode",{parentName:"p"},"CardDetails")," type ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," the error message contains three parts separated by a pipe character, the first part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardNumber")," value, the second part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiry")," value, and the third part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardCVV")," value."),(0,r.kt)("p",null,"A valid ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," will have the \u2018hf-valid\u2019 and \u2018hf-user-valid\u2019 classes added otherwise the \u2018hf-invalid\u2019 and \u2018hf-user-invalid\u2019 classes are added."),(0,r.kt)("p",null,"Returns void when setting, or an error message string when getting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void setValue() / string getValue()")),(0,r.kt)("p",null,"Set or gets the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," value. Because Hosted Payment Fields are designed for the entry of sensitive payment details, then these methods are not normally used. There is no means to retrieve the actual sensitive data and so any returned value will be an empty string if the field has no value or a single asterisk if the field has a value."),(0,r.kt)("p",null,"When used with the ",(0,r.kt)("inlineCode",{parentName:"p"},"CardDetails")," type ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," the value contains three parts separated by a pipe character, the first part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardNumber")," value, the second part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardExpiry")," value, and the third part contains the ",(0,r.kt)("inlineCode",{parentName:"p"},"cardCVV")," value."),(0,r.kt)("p",null,"Returns void when setting, or a mask string when getting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void getState()")),(0,r.kt)("p",null,"Get the current state of the Field as an object with the following boolean properties:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"isReady \u2013 the Field has been created, initialised and is ready for use."),(0,r.kt)("li",{parentName:"ul"},"isValid \u2013 the value is valid (refer to the setValidity() method)."),(0,r.kt)("li",{parentName:"ul"},"isEmpty \u2013 the value is empty (refer to the isEmpty() method)."),(0,r.kt)("li",{parentName:"ul"},"isComplete \u2013 the value is complete (refer to the isComplete() method)."),(0,r.kt)("li",{parentName:"ul"},"isDisabled \u2013 the value is complete (refer to the setDisabled() method)."),(0,r.kt)("li",{parentName:"ul"},"isRequired \u2013 the value is complete (refer to the setRequired() method)."),(0,r.kt)("li",{parentName:"ul"},"isReadOnly \u2013 the value is complete (refer to the setReadOnly() method).")),(0,r.kt)("p",null,"Returns an object containing the states."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void reset()")),(0,r.kt)("p",null,"Reset Field value back to the initial value."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"void destroy()")),(0,r.kt)("p",null,"Destroys the ",(0,r.kt)("inlineCode",{parentName:"p"},"Form"),", reverting its element back to its original state."),(0,r.kt)("p",null,"Note: A field\u2019s options or properties cannot be changed while a field is initialising, that is between construction and firing of the \u2018ready\u2019 event. Attempts to change field options or properties before this will be ignored."),(0,r.kt)("h3",{id:"field-events"},"Field Events"),(0,r.kt)("p",null,"The following events may be fired by the Field object, and you can use these to hook into and modify the object\u2019s behaviour:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Event Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"create"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field has been created.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"destroy"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field has been destroyed.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ready"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field style is has finished initialising and is ready.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"style"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field style is changed.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"autofill"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field has a value auto filled by the browser.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"autofillcancel"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field has an auto filled value removed.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"valid"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field is checked for validity and passes the check.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"invalid"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field is checked for validity and fails the check.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"uservalid"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when the valid event is fired but only after user interaction has occurred, such as focusing a Field, leaving a Field or attempting to submit a Form.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"userinvalid"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when the invalid event is fired but only after user interaction has occurred, such as focusing a Field, leaving a Field or attempting to submit a Form.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"disabled"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field changes to disabled.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"enabled"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field changes from disabled.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"required"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field changes to required.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"optional"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field changes from required.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"readonly"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field changes to read-only.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"readwrite"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field changed from read-only.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"focus"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field receives focus.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"blur"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a Field loses focus.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mouseenter"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a pointing device is moved into the Field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mouseleave"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a pointing device is moved out of the Field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mouseover"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a pointing device is moved into the Field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mouseout"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a pointing device is moved out of the Field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mousemove"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a pointing device is moved over the Field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"keydown"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a key is pressed in the Field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"keyup"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a key is released in a Field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"keypress"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when a key except Shift, Fn, CapsLock is in a pressed position in a Field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"change"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when an alteration to the value of a Field is committed by the user.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"input"),(0,r.kt)("td",{parentName:"tr",align:null},"Fired when the value of a Field is changed.")))),(0,r.kt)("p",null,"Event names are prefixed with the \u2018hostedfield:\u2019 namespace not shown in the table."),(0,r.kt)("h3",{id:"field-css-classes"},"Field CSS Classes"),(0,r.kt)("p",null,"The following CSS class names will be added to a ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," object depending on its state and you can use these to style the object as required:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Event Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hostedfield"),(0,r.kt)("td",{parentName:"tr",align:null},"Present on all Field elements.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-autofill"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when the value was auto filled by the browser.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-invalid"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the invalid state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-valid"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the valid state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-user-invalid"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the invalid state and user interaction has occurred, such as focusing a Field, leaving a Field or attempting to submit a Form.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-user-valid"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the valid state and user interaction has occurred, such as focusing a Field, leaving a Field or attempting to submit a Form.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-disabled"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the disabled state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-enabled"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when not in the disabled state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-required"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the required state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-optional"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when not in the required state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-readonly"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the read-only state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-readwrite"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when not in the read-only state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-focus"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the focused state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-blur"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when not in the focused state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-empty"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the empty state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-complete"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when in the complete state.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-hover"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when a pointing device is over the Field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf-placeholder-shown"),(0,r.kt)("td",{parentName:"tr",align:null},"Present when the placeholder text is displayed.")))),(0,r.kt)("p",null,"In addition to these class names, the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," will add any corresponding class names provided by the ",(0,r.kt)("inlineCode",{parentName:"p"},"classes")," option provided when the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," is constructed."),(0,r.kt)("p",null,"For example, if the ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," is constructed with a classes option as follows ",(0,r.kt)("inlineCode",{parentName:"p"},"\u2018{disabled: \u2018text-blur text-grey\u2019, enabled: \u2018text-normal\u2019}\u2019"),", then the \u2018text-blur\u2019 and \u2018text-grey\u2019 class names will be present whenever the \u2018hf-disabled\u2019 class is present and the \u2018text-normal\u2019 class name will be present whenever the \u2018hf-enabled\u2019 class name is present."),(0,r.kt)("h3",{id:"field-styling"},"Field Styling"),(0,r.kt)("p",null,"The Hosted Payment Fields are styled using CSS as normal."),(0,r.kt)("p",null,"However, styles have to be transferred from your website to the controls served from our website, therefore styles must be isolated and easily identifiable. To aid with identification, all styles intended for a ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," must contain the \u2018hostedfield\u2019 class name in their selector or \u2018-hostedfield\u2019 extension on any id in the selector."),(0,r.kt)("p",null,"As a website may contain lots of stylesheets, a ",(0,r.kt)("inlineCode",{parentName:"p"},"Field")," cannot be expected to parse every stylesheet present on the page and therefore it only parses those selected using the stylesheets construction option or using the ",(0,r.kt)("inlineCode",{parentName:"p"},"setStylesheet()")," method. By default, this is any stylesheet referenced via a ",(0,r.kt)("inlineCode",{parentName:"p"},"<link>")," tag or ",(0,r.kt)("inlineCode",{parentName:"p"},"<style>")," tag with the \u2018hostedfield\u2019 class name: ie any HTML node that matches the following DOM selector ",(0,r.kt)("inlineCode",{parentName:"p"},"\u2018link.hostedfield[rel=stylesheet], style.hostedfield'"),"."),(0,r.kt)("p",null,"CSS styles using the Field state classes, pseudo classes and pseudo elements are supported as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},":focus"),(0,r.kt)("li",{parentName:"ul"},".hf-focus"),(0,r.kt)("li",{parentName:"ul"},":hover"),(0,r.kt)("li",{parentName:"ul"},".hf-hover"),(0,r.kt)("li",{parentName:"ul"},":enabled"),(0,r.kt)("li",{parentName:"ul"},".hf-enabled"),(0,r.kt)("li",{parentName:"ul"},":disabled"),(0,r.kt)("li",{parentName:"ul"},".hf-disabled"),(0,r.kt)("li",{parentName:"ul"},":valid"),(0,r.kt)("li",{parentName:"ul"},".hf-valid"),(0,r.kt)("li",{parentName:"ul"},":invalid"),(0,r.kt)("li",{parentName:"ul"},".hf-invalid"),(0,r.kt)("li",{parentName:"ul"},":user-valid"),(0,r.kt)("li",{parentName:"ul"},".hf-user-valid"),(0,r.kt)("li",{parentName:"ul"},":user-invalid"),(0,r.kt)("li",{parentName:"ul"},".hf-user-invalid"),(0,r.kt)("li",{parentName:"ul"},":required"),(0,r.kt)("li",{parentName:"ul"},".hf-required"),(0,r.kt)("li",{parentName:"ul"},":optional"),(0,r.kt)("li",{parentName:"ul"},".hf-optional"),(0,r.kt)("li",{parentName:"ul"},":empty"),(0,r.kt)("li",{parentName:"ul"},".hf-empty"),(0,r.kt)("li",{parentName:"ul"},":complete"),(0,r.kt)("li",{parentName:"ul"},".hf-complete"),(0,r.kt)("li",{parentName:"ul"},":autofill"),(0,r.kt)("li",{parentName:"ul"},".hf-autofill"),(0,r.kt)("li",{parentName:"ul"},":placeholder-shown"),(0,r.kt)("li",{parentName:"ul"},".hf-placeholder-shown"),(0,r.kt)("li",{parentName:"ul"},":readonly"),(0,r.kt)("li",{parentName:"ul"},".hf-readonly"),(0,r.kt)("li",{parentName:"ul"},":readwrite"),(0,r.kt)("li",{parentName:"ul"},".hf-readwrite"),(0,r.kt)("li",{parentName:"ul"},":-webkit-auto-fill"),(0,r.kt)("li",{parentName:"ul"},".hf-icon"),(0,r.kt)("li",{parentName:"ul"},"::placeholder"),(0,r.kt)("li",{parentName:"ul"},"::-moz-placeholder"),(0,r.kt)("li",{parentName:"ul"},"::-webkit-input-placeholder"),(0,r.kt)("li",{parentName:"ul"},"::-ms-input-placeholder")),(0,r.kt)("p",null,"The styles can contain any valid CSS rules and will be used to style both the public elements and internal private elements. For security only, styles that relate to the textual representation of the Field are passed to the internal private elements. This includes styles such as colours, font weights and text decorations. At present, it is not possible to specify custom fonts as they would require the font files to be available on our servers."),(0,r.kt)("p",null,"The following styles can be used to style the Field internal private elements:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"caret-color"),(0,r.kt)("li",{parentName:"ul"},"color"),(0,r.kt)("li",{parentName:"ul"},"cursor"),(0,r.kt)("li",{parentName:"ul"},"direction"),(0,r.kt)("li",{parentName:"ul"},"fill"),(0,r.kt)("li",{parentName:"ul"},"filter"),(0,r.kt)("li",{parentName:"ul"},"font"),(0,r.kt)("li",{parentName:"ul"},"font-family"),(0,r.kt)("li",{parentName:"ul"},"font-feature-settings"),(0,r.kt)("li",{parentName:"ul"},"font-kerning"),(0,r.kt)("li",{parentName:"ul"},"font-language-override"),(0,r.kt)("li",{parentName:"ul"},"font-size"),(0,r.kt)("li",{parentName:"ul"},"font-size-adjust"),(0,r.kt)("li",{parentName:"ul"},"font-smooth"),(0,r.kt)("li",{parentName:"ul"},"font-stretch"),(0,r.kt)("li",{parentName:"ul"},"font-style"),(0,r.kt)("li",{parentName:"ul"},"font-synthesis"),(0,r.kt)("li",{parentName:"ul"},"font-variant"),(0,r.kt)("li",{parentName:"ul"},"font-variant-alternates"),(0,r.kt)("li",{parentName:"ul"},"font-variant-caps"),(0,r.kt)("li",{parentName:"ul"},"font-variant-east-asian"),(0,r.kt)("li",{parentName:"ul"},"font-variant-ligatures"),(0,r.kt)("li",{parentName:"ul"},"font-variant-numeric"),(0,r.kt)("li",{parentName:"ul"},"font-variant-position"),(0,r.kt)("li",{parentName:"ul"},"font-weight"),(0,r.kt)("li",{parentName:"ul"},"letter-spacing"),(0,r.kt)("li",{parentName:"ul"},"line-height"),(0,r.kt)("li",{parentName:"ul"},"stroke"),(0,r.kt)("li",{parentName:"ul"},"text-align"),(0,r.kt)("li",{parentName:"ul"},"text-decoration"),(0,r.kt)("li",{parentName:"ul"},"text-decoration-color"),(0,r.kt)("li",{parentName:"ul"},"text-decoration-line"),(0,r.kt)("li",{parentName:"ul"},"text-decoration-style"),(0,r.kt)("li",{parentName:"ul"},"text-emphasis"),(0,r.kt)("li",{parentName:"ul"},"text-emphasis-color"),(0,r.kt)("li",{parentName:"ul"},"text-emphasis-position"),(0,r.kt)("li",{parentName:"ul"},"text-emphasis-style"),(0,r.kt)("li",{parentName:"ul"},"text-indent"),(0,r.kt)("li",{parentName:"ul"},"text-rendering"),(0,r.kt)("li",{parentName:"ul"},"text-shadow"),(0,r.kt)("li",{parentName:"ul"},"text-transform"),(0,r.kt)("li",{parentName:"ul"},"text-underline-position"),(0,r.kt)("li",{parentName:"ul"},"-moz-osx-font-smoothing"),(0,r.kt)("li",{parentName:"ul"},"-webkit-font-smoothing"),(0,r.kt)("li",{parentName:"ul"},"-webkit-text-fill-color")),(0,r.kt)("p",null,"The \u2018.hf-icon\u2019 class name can be used to target the icon sub element in a ",(0,r.kt)("inlineCode",{parentName:"p"},"cardDetails")," ",(0,r.kt)("inlineCode",{parentName:"p"},"Field"),"."),(0,r.kt)("p",null,"Individual controls can be targeted by using DOM ids, which will have a \u2018-hostedfield\u2019 extension added to the DOM id of the original ",(0,r.kt)("inlineCode",{parentName:"p"},"element"),"."),(0,r.kt)("p",null,"It is advisable to keep CSS selectors and rules as simple as possible to avoid styling errors caused by a failure to parse and filter the rules."),(0,r.kt)("p",null,"The following list are the best web safe fonts for use with any \u2018font\u2019 or \u2018font-family\u2019 style as these fonts should be available on most web browsers:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Arial (sans-serif)"),(0,r.kt)("li",{parentName:"ul"},"Verdana (sans-serif)"),(0,r.kt)("li",{parentName:"ul"},"Helvetica (sans-serif)"),(0,r.kt)("li",{parentName:"ul"},"Tahoma (sans-serif)"),(0,r.kt)("li",{parentName:"ul"},"Trebuchet MS (sans-serif)"),(0,r.kt)("li",{parentName:"ul"},"Times New Roman (serif)"),(0,r.kt)("li",{parentName:"ul"},"Georgia (serif)"),(0,r.kt)("li",{parentName:"ul"},"Garamond (serif)"),(0,r.kt)("li",{parentName:"ul"},"Courier New (monospace)"),(0,r.kt)("li",{parentName:"ul"},"Brush Script MT (cursive)")),(0,r.kt)("h4",{id:"example-stylesheet-"},"Example stylesheet :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"}," <style class=\"hostedfield\">\n    /*\n        * Style hosted field internals\n        * - only accept font, foreground and background styling\n    */\n\n    /* Copy of Bootstrap styles */\n    .hostedfield:disabled {\n         cursor: not-allowed;\n         background-color: #eee;\n         opacity: 1;\n    }\n\n    /* Change text to red when invalid */\n    .form-control:invalid,\n    .hostedfield:invalid {\n         border-color: #a94442 !important;\n         color: #a94442 !important;\n    }\n\n     /* Change text to light grey when readonly */\n     .form-control:readonly,\n     .hostedfield:readonly {\n        color: lightgrey !important;\n    }\n\n    /* Emulate webkit auto fill style */\n     .form-control.hf-autofill,\n     .hostedfield.hf-autofill {\n         background-color: rgb(250, 255, 189) !important;\n         background-image: none !important;\n         color: rgb(0, 0, 0) !important;\n    }\n\n    /* Add pink placeholder */\n    .form-control::placeholder,\n    .hostedfield::placeholder {\n        color: pink;\n    }\n\n    /* Show hovering over the control */\n    .form-control.hf-hover,\n    .hostedfield.hf-hover {\n        font-style: italic;\n    }\n\n    /* Style by id (hosted field will have '-hostedfield' appended to the id) */\n    #form1-card-details.hostedfield, #form1-card-details-hostedfield {\n        color: blue;\n     }\n\n </style>\n")),(0,r.kt)("h3",{id:"jquery-plugin"},"jQuery plugin"),(0,r.kt)("p",null,"The script will extend the jQuery object with its own plugin methods to allow easy access to Form\nand Field objects attached to an element as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$(element).hostedForm(options);\n$(element).hostedForm(\u2018instance\u2019);\n$(element).hostedForm(\u2018options\u2019, options);\n$(element).hostedForm(method, parameters);\n$(element).hostedForm(\u2018destroy\u2019);\n$(element).hostedField(options);\n$(element).hostedField(\u2018instance\u2019);\n$(element).hostedField(\u2018options\u2019, options);\n$(element).hostedField(method, parameters);\n$(element).hostedField(\u2018destroy\u2019);\n")),(0,r.kt)("p",null,"The script will also add a \u2018:hostedfield\u2019 pseudo selector allowing Field elements to be selected\nusing the following example notation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$(\u2018INPUT:hostedfield\u2019)\n")),(0,r.kt)("h2",{id:"example-http-request"},"Example HTTP Request"),(0,r.kt)("h3",{id:"transaction-request-http-headers"},"Transaction Request HTTP Headers"),(0,r.kt)("p",null,"The following HTTP headers are sent for transaction request:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"HTTP Header"),(0,r.kt)("th",{parentName:"tr",align:null},"Mandatory"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"content-type"),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"Content type of the request. This must be \u2018application/x-www-formurlencoded\u2019, A charset parameter is optional and any non UTF-8 request will be converted to UTF-8.")))),(0,r.kt)("h3",{id:"transaction-response-http-headers"},"Transaction Response HTTP Headers"),(0,r.kt)("p",null,"The following HTTP headers are received for a transaction response:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"HTTP Header"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Status"),(0,r.kt)("td",{parentName:"tr",align:null},"HTTP status header. Possible value are:",(0,r.kt)("br",null),"200 \u2013 Transaction request processed",(0,r.kt)("br",null),"500 \u2013 Internal Server Error",(0,r.kt)("br",null),"503 \u2013 Service Temporarily Unavailable")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"content-type"),(0,r.kt)("td",{parentName:"tr",align:null},"Content type of the response. This will be \u2018text/html\u2019")))),(0,r.kt)("h3",{id:"submission-example"},"Submission Example"),(0,r.kt)("p",null,"The following shows an example of a transaction request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"POST /direct/ HTTP/1.1\nHost: gateway.example.com\nAccept: */*\nContent-Length: 397\nContent-Type: application/x-www-form-urlencoded\n\nmerchantID=100001&action=SALE&type=1&currencyCode=826&countryCode=826&amount=680&transactionUnique=5de65b552499\ne&orderRef=Test+Transaction&cardNumber=4929+4212+3460+0821&cardCVV=356&cardExpiryDate=1219&threeDSRequired=N&av\nscv2CheckRequired=N&duplicateDelay=0&signature=06b01e06c8fc761943d676d5f3aa2e9264758fed72e7bcb058a2a35cf23e8e45\n403099537bb0363054d6bc8ea951ce1ad86e582dbf0b435855b9c97507fcf844 \n")),(0,r.kt)("p",null,"The following shows an example of a transaction response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"HTTP/1.1 200 OK\nDate: Tue, 01 Jan 2019 09:30:45 GMT\nServer: Apache/2.4.23 (Win64) OpenSSL/1.0.2k-fips PHP/5.4.12\nVary: Host\nX-Powered-By: PHP/5.4.12\nContent-Length: 2449\nContent-Type: text/html\n\nmerchantID=100001&threeDSEnabled=Y&avscv2CheckEnabled=Y&riskCheckEnabled=N&caEnabled=Y&rtsEnabled=Y&cftEnabled=Y&threeDSCheckPref=not+known%2Cnot+checked%2Cauthenticated%2Cattempted+authentication&cv2CheckPref=matched&addressCheckPref=not+known%2Cnot+checked%2Cmatched%2Cpartially+matched&postcodeCheckPref=not+known%2Cnot+checked%2Cmatched%2Cpartially+matched&cardCVVMandatory=Y&riskCheckPref=not+known%3Dfinished%2Cnot+checked%3Ddecline2%2Capprove%3Dcontinue%2Cdecline%3Ddecline1%2Creview%3Ddecline2%2Cescalate%3Dfinished&notifyEmail=an.operator%40merchant.com&customerReceiptsRequired=Y&merchantCategoryCode=6013&surchargeEnabled=Y&surchargeRequired=N&surchargeRules%5B0%5D%5BcardType%5D=CC&surchargeRules%5B0%5D%5Bsurcharge%5D=10.1235&surchargeRules%5B1%5D%5BcardType%5D=CC&surchargeRules%5B1%5D%5Bcurrency%5D=GBP&surchargeRules%5B1%5D%5Bsurcharge%5D=2.5000&surchargeRules%5B2%5D%5BcardType%5D=VC&surchargeRules%5B2%5D%5Bsurcharge%5D=3.5000&surchargeRules%5B3%5D%5BcardType%5D=VC&surchargeRules%5B3%5D%5Bcurrency%5D=GBP&surchargeRules%5B3%5D%5Bsurcharge%5D=4.5000&surchargeRules%5B4%5D%5BcardType%5D=DD&surchargeRules%5B4%5D%5Bsurcharge%5D=5.5000&action=SALE&type=1\xa4cyCode=826&countryCode=826&amount=680&transactionUnique=5de65b552499e&orderRef=Test+Transaction&cardExpiryDate=1219&threeDSRequired=N&avscv2CheckRequired=N&duplicateDelay=0&requestID=5de65b562496f&responseCode=0&responseMessage=AUTHCODE%3A347414&state=captured&requestMerchantID=100001&processMerchantID=100001&paymentMethod=card&cardType=Visa+Credit&cardTypeCode=VC&cardScheme=Visa+&cardSchemeCode=VC&cardIssuer=BARCLAYS+BANK+PLC&cardIssuerCountry=United+Kingdom&cardIssuerCountryCode=GBR&cardFlags=8323072&cardNumberMask=492942%2A%2A%2A%2A%2A%2A0821&cardNumberValid=Y&xref=19120312NG55CM51QH35JRL&cardExpiryMonth=12&cardExpiryYear=19&authorisationCode=347414&transactionID=10018201&responseStatus=0\xd7tamp=2019-12-03+12%3A55%3A52&amountApproved=680&amountReceived=680&amountRetained=680&avscv2ResponseCode=244100&avscv2ResponseMessage=SECURITY+CODE+MATCH+ONLY&avscv2AuthEntity=merchant+host&cv2Check=matched&addressCheck=not+matched&postcodeCheck=not+matched&notifyEmailResponseCode=0&notifyEmailResponseMessage=Email+successfully+queued&vcsResponseCode=0&vcsResponseMessage=Success+-+no+velocity+check+rules+applied&currencyExponent=2&signature=e5c65e5d0340e0ec0de8782affcb6caba2e4d202a6873a1677ddbf6415cb1dd52cc597e43c758b233afd121367d300a57d0faade7abf6b4b88a1a1b974e55d33 \n")),(0,r.kt)("h2",{id:"gateway-integration-library"},"Gateway Integration Library"),(0,r.kt)("p",null,"A simple server-side integration library is available to simplify the preparation and transmission of Hosted and Direct Integration requests."),(0,r.kt)("p",null,"The library is available in many popular programming languages and is based around a single class: the Gateway class. Below is the PHP version of the library but checkout the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/handpoint"},"Handpoint Github")," website to download libraries in C#, Java, Perl, Python, NodeJs, Ruby and Swift. "),(0,r.kt)("h3",{id:"library-namespace-1"},"Library Namespace"),(0,r.kt)("p",null,"To avoid polluting the global namespace, the library uses the \u2018P3/SDK\u2019 namespace where supported by the language."),(0,r.kt)("h3",{id:"gateway-configuration"},"Gateway Configuration"),(0,r.kt)("p",null,"Before you can use the Gateway class, you will need to configure the following properties to match your integration parameters: "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hostedURL"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Absolute URL provided for the Hosted Integration.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"directURL"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Absolute URL provided for the Direct Integration.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"merchantID"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Your unique Merchant ID to be passed in the ",(0,r.kt)("inlineCode",{parentName:"td"},"merchantID")," integration field.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"merchantPwd"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Any password configured on your Merchant Account")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"merchantSecret"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Any secret configured on your Merchant Account")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"proxyUrl"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Absolute URL to any proxy required for connections")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"debug"),(0,r.kt)("td",{parentName:"tr",align:null},"boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"True to enable debugging output")))),(0,r.kt)("h3",{id:"gateway-methods"},"Gateway Methods"),(0,r.kt)("p",null,"The following methods are made available by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Gateway")," class:"),(0,r.kt)("h4",{id:"string-hostedrequestmixed-request-string-options"},(0,r.kt)("inlineCode",{parentName:"h4"},"string hostedRequest(mixed[] request, string[] options)")),(0,r.kt)("p",null,"Return an HTML fragment that can be included in your webpage to render a ",(0,r.kt)("inlineCode",{parentName:"p"},"<form>")," which will send the provided request data to the Gateway\u2019s Hosted Integration when submitted."),(0,r.kt)("p",null,"The request parameter should be an associative array containing the request fields required to be sent. The request fields are not validated."),(0,r.kt)("p",null,"The following class properties are used unless alternative values are provided in the ",(0,r.kt)("inlineCode",{parentName:"p"},"request")," array: ",(0,r.kt)("inlineCode",{parentName:"p"},"directUrl"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantID"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantPwd"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantSecret"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," parameter is an optional associative array containing options that can be used to modify the returned HTML fragment as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"formAttrs \u2013 string containing additional attributes to include in the form tag."),(0,r.kt)("li",{parentName:"ul"},"submitAttrs \u2013 string containing additional attributes to include in the submit button tag."),(0,r.kt)("li",{parentName:"ul"},"submitImage \u2013 string containing the URL to use as the submit button."),(0,r.kt)("li",{parentName:"ul"},"submitHtml \u2013 string containing HTML to use as the label on the submit ",(0,r.kt)("inlineCode",{parentName:"li"},"<button>"),"."),(0,r.kt)("li",{parentName:"ul"},"submitText \u2013 string containing text to use as the label on the submit ",(0,r.kt)("inlineCode",{parentName:"li"},"<input>"),".")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"submitImage"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"submitHtml")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"submitText")," options are mutually exclusive and will be checked for in that order. If none is provided, then a ",(0,r.kt)("inlineCode",{parentName:"p"},"submitText")," value of \u2018Pay Now' is assumed."),(0,r.kt)("p",null,"If a ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantSecret")," is provided, then the method will add the correct signature field to the request."),(0,r.kt)("p",null,"An exception is thrown if the HTML fragment cannot be composed."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"verifyResponse()")," method can be used to validate and decode any response POSTed back to your website."),(0,r.kt)("p",null,"Returns a string containing the HTML fragment if successful; throws an exception otherwise."),(0,r.kt)("h4",{id:"mixed-directrequestmixed-request-string-options"},(0,r.kt)("inlineCode",{parentName:"h4"},"mixed[] directRequest(mixed[] request, string[] options)")),(0,r.kt)("p",null,"Return the response received when sending the provided request to the Gateway\u2019s Direct Integration."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"request")," parameter should be an associative array containing the request fields required to be sent. The request fields are not validated."),(0,r.kt)("p",null,"The following class properties are used unless alternative values are provided in the request array: ",(0,r.kt)("inlineCode",{parentName:"p"},"directUrl"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantID"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantPwd"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantSecret"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," parameter is not used and reserved for future use."),(0,r.kt)("p",null,"If a ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantSecret")," is provided, then the method will add the correct signature field to the request and check the ",(0,r.kt)("inlineCode",{parentName:"p"},"signature")," field on the response."),(0,r.kt)("p",null,"An exception is thrown if the request cannot be sent; or the response cannot be received; or if the response\u2019s signature is incorrect."),(0,r.kt)("p",null,"Returns an associative array containing the received response fields; otherwise, throws an exception."),(0,r.kt)("h4",{id:"void-preparerequestmixed-request-string-options-string-secret-string-direct_url-string-hosted_url"},(0,r.kt)("inlineCode",{parentName:"h4"},"void prepareRequest(mixed[] &request, string[] &options, string &secret, string &direct_url, string &hosted_url)")),(0,r.kt)("p",null,"Prepare a request for sending to the Gateway\u2019s Direct Integration."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"request")," parameter should be a reference to an associative array containing the request fields required to be sent. The request fields are not validated."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantSecret"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"directUrl")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"hostedUrl")," configuration properties will be returned in the ",(0,r.kt)("inlineCode",{parentName:"p"},"secret"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"direct_url")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"hosted_url")," method parameters. These properties can be overridden by providing them in the request, in which case they will be extracted and removed from the request."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantID")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantPwd")," configuration properties will be added to the request."),(0,r.kt)("p",null,"A few known Gateway response fields will be removed from the request, if present, to avoid confusion, notably the ",(0,r.kt)("inlineCode",{parentName:"p"},"responseCode"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"responseMessage"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"responseStatus"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"state")," fields."),(0,r.kt)("p",null,"An exception will be thrown if the request does not contain an action element or a merchantID element (and none could be inserted)."),(0,r.kt)("h4",{id:"void-verifyresponsemixed-response-string-secret"},(0,r.kt)("inlineCode",{parentName:"h4"},"void verifyResponse(mixed[] &response, string secret)")),(0,r.kt)("p",null,"Verify a response received from the Gateway\u2019s Hosted or Direct Integration."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"response")," parameter should be a reference to an associative array containing the response received from the Gateway, either from the Direct Integration or as POSTed from the Hosted Integration."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"secret")," parameter should be any Merchant secret to use when checking the response\u2019s ",(0,r.kt)("inlineCode",{parentName:"p"},"signature")," element. If not provided, then the value of the ",(0,r.kt)("inlineCode",{parentName:"p"},"merchantSecret")," property is used."),(0,r.kt)("p",null,"Any ",(0,r.kt)("inlineCode",{parentName:"p"},"signature")," element is removed from the response."),(0,r.kt)("p",null,"An exception is thrown if the response is not valid, does not contain a ",(0,r.kt)("inlineCode",{parentName:"p"},"responseCode")," element or its ",(0,r.kt)("inlineCode",{parentName:"p"},"signature")," is incorrect."),(0,r.kt)("h4",{id:"string-signmixed-request-string-secret-mixed-partial--false"},(0,r.kt)("inlineCode",{parentName:"h4"},"string sign(mixed[] request, string secret, mixed partial = false)")),(0,r.kt)("p",null,"Return the signature for the provided request data."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"request")," parameter should be a reference to an associative array containing the request fields required to be sent. The request fields are not validated."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"secret")," parameter should be the Merchant secret to use when signing the request."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"partial")," parameter should be either the boolean ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," or comma separated string; or an array of strings containing the names of the request elements to sign."),(0,r.kt)("p",null,"Returns a string containing the correct signature for the request."),(0,r.kt)("h3",{id:"gateway-library-php"},"Gateway Library (PHP)"),(0,r.kt)("p",null,"The gateway.php file contains the main body of the SDK."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"\n<?php\n\n/**\n * Class to communicate with Payment Gateway\n */\n\nnamespace P3\\SDK;\n\nuse \\RuntimeException;\nuse \\InvalidArgumentException;\n\nclass Gateway {\n\n    /**\n     * @var string  Gateway Hosted API Endpoint\n     */\n    static public $hostedUrl = 'https://commerce-api.handpoint.com/hosted/';\n\n    /**\n     * @var string  Gateway Direct API Endpoint\n     */\n    static public $directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n    /**\n     * @var string  Merchant Account Id or Alias\n     */\n    static public $merchantID = '100001';\n\n    /**\n     * @var string  Password for above Merchant Account\n     */\n    static public $merchantPwd = null;\n\n    /**\n     * @var string  Secret for above Merchant Account\n     */\n    static public $merchantSecret = 'Circle4Take40Idea';\n\n    /**\n     * @var string  Proxy URL if required (eg. 'https://www.proxy.com:3128')\n     */\n    static public $proxyUrl = null;\n\n    /**\n     * @var boolean Enable debugging\n     */\n    static public $debug = true;\n\n    /**\n     * Useful response codes\n     */\n    const RC_SUCCESS                        = 0;    // Transaction successful\n    const RC_DO_NOT_HONOR                   = 5;    // Transaction declined\n    const RC_NO_REASON_TO_DECLINE           = 85;   // Verification successful\n\n    const RC_3DS_AUTHENTICATION_REQUIRED    = 0x1010A;\n\n    /**\n     * Send request to Gateway using HTTP Direct API.\n     *\n     * The method will send a request to the Gateway using the HTTP Direct API.\n     *\n     * The request will use the following Gateway properties unless alternative\n     * values are provided in the request;\n     *   + 'directUrl'      - Gateway Direct API Endpoint\n     *   + 'merchantID'     - Merchant Account Id or Alias\n     *   + 'merchantPwd'    - Merchant Account Password (or null)\n     *   + 'merchantSecret' - Merchant Account Secret (or null)\n     *\n     * The method will {@link sign() sign} the request and also {@link\n     * verifySignature() check the signature} on any response.\n     *\n     * The method will throw an exception if it is unable to send the request\n     * or receive the response.\n     *\n     * The method does not attempt to validate any request fields.\n     *\n     * The method will attempt to send the request using the PHP cURL extension\n     * or failing that the  PHP http stream wrappers. If neither are available\n     * then an exception will be thrown.\n     *\n     * @param   array   $request    request data\n     * @param   array   $options    options (or null)\n     * @return  array               request response\n     *\n     * @throws  InvalidArgumentException    invalid request data\n     * @throws  RuntimeException            communications failure\n     */\n    static public function directRequest(array $request, array $options = null) {\n\n        static::debug(__METHOD__ . '() - args=', func_get_args());\n\n        static::prepareRequest($request, $options, $secret, $direct_url, $hosted_url);\n\n        // Sign the request\n        if ($secret) {\n            $request['signature'] = static::sign($request, $secret);\n        }\n\n        if (function_exists('curl_init')) {\n            $opts = array(\n                CURLOPT_POST            => true,\n                CURLOPT_POSTFIELDS      => http_build_query($request, '', '&'),\n                CURLOPT_HEADER          => false,\n                CURLOPT_FAILONERROR     => true,\n                CURLOPT_FOLLOWLOCATION  => true,\n                CURLOPT_RETURNTRANSFER  => true,\n                CURLOPT_USERAGENT       => $_SERVER['HTTP_USER_AGENT'],\n                CURLOPT_PROXY           => static::$proxyUrl,\n            );\n\n            $ch = curl_init($direct_url);\n\n            if (($ch = curl_init($direct_url)) === false) {\n                throw new RuntimeException('Failed to initialise communications with Payment Gateway');\n            }\n\n            if (curl_setopt_array($ch, $opts) === false || ($data = curl_exec($ch)) === false) {\n                $err = curl_error($ch);\n                curl_close($ch);\n                throw new RuntimeException('Failed to communicate with Payment Gateway: ' . $err);\n            }\n\n        } else if (ini_get('allow_url_fopen')) {\n\n            $opts = array(\n                'http' => array(\n                    'method'        => 'POST',\n                    'user_agent'    => $_SERVER['HTTP_USER_AGENT'],\n                    'proxy'         => static::$proxyUrl,\n                    'header'        => 'Content-Type: application/x-www-form-urlencoded',\n                    'content'       => http_build_query($request, '', '&'),\n                    'timeout'       => 5,\n                )\n            );\n\n            $context = stream_context_create($opts);\n\n            if (($data = file_get_contents($direct_url, false, $context)) === false) {\n                throw new RuntimeException('Failed to send request to Payment Gateway');\n            }\n\n        } else {\n            throw new RuntimeException('No means of communicate with Payment Gateway, please enable CURL or HTTP Stream Wrappers');\n        }\n\n        if (!$data) {\n            throw new RuntimeException('No response from Payment Gateway');\n        }\n\n        $response = null;\n        parse_str($data, $response);\n\n        static::verifyResponse($response, $secret);\n\n        static::debug(__METHOD__ . '() - ret=', $response);\n\n        return $response;\n    }\n\n    /**\n     * Send request to Gateway using HTTP Hosted API.\n     *\n     * The method will send a request to the Gateway using the HTTP Hosted API.\n     *\n     * The request will use the following Gateway properties unless alternative\n     * values are provided in the request;\n     *   + 'hostedUrl'      - Gateway Hosted API Endpoint\n     *   + 'merchantID'     - Merchant Account Id or Alias\n     *   + 'merchantPwd'    - Merchant Account Password (or null)\n     *   + 'merchantSecret' - Merchant Account Secret (or null)\n     *\n     * The method accepts the following options;\n     *   + 'formAttrs'      - HTML form attributes string\n     *   + 'formHtml'       - HTML to show inside the form\n     *   + 'submitAttrs'    - HTML submit button attributes string\n     *   + 'submitImage'    - URL of image to use as the Submit button\n     *   + 'submitHtml'     - HTML to show on the Submit button\n     *   + 'submitText'     - Text to show on the Submit button\n     *\n     * 'submitImage', 'submitHtml' and 'submitText' are mutually exclusive\n     * options and will be checked for in that order. If none are provided\n     * the submitText='Pay Now' is assumed.\n     *\n     * The method will {@link sign() sign} the request, to allow for submit\n     * button images etc. partial signing will be used.\n     *\n     * The method returns the HTML fragment that needs including in order to\n     * send the request.\n     *\n     * The method will throw an exception if it is unable to send the request.\n     *\n     * The method does not attempt to validate any request fields.\n     *\n     * If the request doesn't contain a 'redirectURL' element then one will be\n     * added which redirects the response to the current script.\n     *\n     * Any response can be {@link verifyResponse() verified} using the following\n     * PHP code;\n     * <code>\n     * try {\n     *     \\P3\\SDK\\Gateway::verifyResponse($_POST);\n     * } catch(\\Exception $e) {\n     *     die($e->getMessage());\n     * }\n     * </code>\n     *\n     * @param   array   $request    request data\n     * @param   array   $options    options (or null)\n     * @return  string              request HTML form.\n     *\n     * @throws  InvalidArgumentException    invalid request data\n     */\n    static public function hostedRequest(array $request, array $options = null) {\n\n        static::debug(__METHOD__ . '() - args=', func_get_args());\n\n        static::prepareRequest($request, $options, $secret, $direct_url, $hosted_url);\n\n        if (!isset($request['redirectURL'])) {\n            $request['redirectURL'] = ($_SERVER['HTTPS'] === 'on' ? 'https://' : 'http://') . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];\n        }\n\n        if ($secret) {\n            $request['signature'] = static::sign($request, $secret, true);\n        }\n\n        $ret = '<form method=\"post\" ' .\n            (isset($options['formAttrs']) ? $options['formAttrs'] : '') .\n            ' action=\"' . htmlentities($hosted_url, ENT_COMPAT, 'UTF-8') . \"\\\">\\n\";\n\n        foreach ($request as $name => $value) {\n            $ret .= static::fieldToHtml($name, $value);\n        }\n\n        if (isset($options['formHtml'])) {\n            $ret .= $options['formHtml'];\n        }\n\n        if (isset($options['submitImage'])) {\n            $ret .= '<input ' .\n                    (isset($options['submitAttrs']) ? $options['submitAttrs'] : '') .\n                    ' type=\"image\" src=\"' . htmlentities($options['submitImage'], ENT_COMPAT, 'UTF-8') . \"\\\">\\n\";\n        } else if (isset($options['submitHtml'])) {\n            $ret .= '<button type=\"submit\" ' .\n                    (isset($options['submitAttrs']) ? $options['submitAttrs'] : '') .\n                    \">{$options['submitHtml']}</button>\\n\";\n        } else {\n            $ret .= '<input ' .\n                    (isset($options['submitAttrs']) ? $options['submitAttrs'] : '') .\n                    ' type=\"submit\" value=\"' . (isset($options['submitText']) ? htmlentities($options['submitText'], ENT_COMPAT, 'UTF-8') : 'Pay Now') . \"\\\">\\n\";\n        }\n\n        $ret .= \"</form>\\n\";\n\n        static::debug(__METHOD__ . '() - ret=', $ret);\n\n        return $ret;\n    }\n\n    /**\n     * Prepare a request for sending to the Gateway.\n     *\n     * The method will extract the following configuration properties from the\n     * request if they are present;\n     *   + 'merchantSecret' - Merchant Account Secret (or null)\n     *   + 'directUrl'      - Gateway Direct API Endpoint\n     *   + 'hostedUrl'      - Gateway Hosted API Endpoint\n     *\n     * The method will insert the following configuration properties into the\n     * request if they are not already present;\n     *   + 'merchantID'     - Merchant Account Id or Alias\n     *   + 'merchantPwd'    - Merchant Account Password (or null)\n     *\n     * The method will throw an exception if the request doesn't contain an\n     * 'action' element or a 'merchantID' element (and none could be inserted).\n     *\n     * The method does not attempt to validate any request fields.\n     *\n     * @param   array   $request    request data (input & return)\n     * @param   array   $options    options (or null)\n     * @param   string  $secret     any extracted 'merchantSecret' (return)\n     * @param   string  $direct_url any extracted 'directUrl' (return)\n     * @param   string  $hosted_url any extracted 'hostedUrl' (return)\n     * @return  void\n     *\n     * @throws  InvalidArgumentException    invalid request data\n     */\n    static public function prepareRequest(array &$request, array $options = null, &$secret, &$direct_url, &$hosted_url) {\n\n        if (!$request) {\n            throw new InvalidArgumentException('Request must be provided.');\n        }\n\n        if (!isset($request['action'])) {\n            throw new InvalidArgumentException('Request must contain an \\'action\\'.');\n        }\n\n        // Insert 'merchantID' if doesn't exist and default is available\n        if (!isset($request['merchantID']) && static::$merchantID) {\n            $request['merchantID'] = static::$merchantID;\n        }\n\n        // Insert 'merchantPwd' if doesn't exist and default is available\n        if (!isset($request['merchantPwd']) && static::$merchantPwd) {\n            $request['merchantPwd'] = static::$merchantPwd;\n        }\n\n        // A 'merchantID' must be set\n        if (empty($request['merchantID'])) {\n            throw new InvalidArgumentException('Merchant ID or Alias must be provided.');\n        }\n\n        if (array_key_exists('merchantSecret', $request)) {\n            $secret = $request['merchantSecret'];\n            unset($request['merchantSecret']);\n        } else {\n            $secret = static::$merchantSecret;\n        }\n\n        if (array_key_exists('hostedUrl', $request)) {\n            $hosted_url = $request['hostedUrl'];\n            unset($request['hostedUrl']);\n        } else {\n            $hosted_url = static::$hostedUrl;\n        }\n\n        if (array_key_exists('directUrl', $request)) {\n            $direct_url = $request['directUrl'];\n            unset($request['directUrl']);\n        } else {\n            $direct_url = static::$directUrl;\n        }\n\n        // Remove items we don't want to send in the request\n        // (they may be there if a previous response is sent)\n        $request = array_diff_key($request, array(\n            'responseCode'=> null,\n            'responseMessage' => null,\n            'responseStatus' => null,\n            'state' => null,\n            'signature' => null,\n            'merchantAlias' => null,\n            'merchantID2' => null,\n        ));\n    }\n\n    /**\n     * Verify the any response.\n     * \n     * This method will verify that the response is present, contains a response\n     * code and is correctly signed.\n     *\n     * If the response is invalid then an exception will be thrown.\n     *\n     * Any signature is removed from the passed response.\n     *\n     * @param   array   $data       reference to the response to verify\n     * @param   string  $secret     secret to use in signing\n     * @return  boolean             true if signature verifies\n     */\n    static public function verifyResponse(array &$response, $secret = null) {\n\n        if (!$response || !isset($response['responseCode'])) {\n            throw new RuntimeException('Invalid response from Payment Gateway');\n        }\n\n        if (!$secret) {\n            $secret = static::$merchantSecret;\n        }\n\n        $fields = null;\n        $signature = null;\n        if (isset($response['signature'])) {\n            $signature = $response['signature'];\n            unset($response['signature']);\n            if ($secret && $signature && strpos($signature, '|') !== false) {\n                list($signature, $fields) = explode('|', $signature);\n            }\n        }\n\n        // We display three suitable different exception messages to help show\n        // secret mismatches between ourselves and the Gateway without giving\n        // too much away if the messages are displayed to the Cardholder.\n        if (!$secret && $signature) {\n            // Signature present when not expected (Gateway has a secret but we don't)\n            throw new RuntimeException('Incorrectly signed response from Payment Gateway (1)');\n        } else if ($secret && !$signature) {\n            // Signature missing when one expected (We have a secret but the Gateway doesn't)\n            throw new RuntimeException('Incorrectly signed response from Payment Gateway (2)');\n        } else if ($secret && static::sign($response, $secret, $fields) !== $signature) {\n            // Signature mismatch\n            throw new RuntimeException('Incorrectly signed response from Payment Gateway');\n        }\n\n        settype($response['responseCode'], 'integer');\n\n        return true;\n    }\n\n    /**\n     * Sign the given array of data.\n     * \n     * This method will return the correct signature for the data array.\n     *\n     * If the secret is not provided then any {@link static::$merchantSecret\n     * default secret} is used.\n     *\n     * The partial parameter is used to indicate that the signature should\n     * be marked as 'partial' and can take three possible value types as\n     * follows;\n     *   + boolean  - sign with all $data fields\n     *   + string   - comma separated list of $data field names to sign\n     *   + array    - array of $data field names to sign\n     *\n     * @param   array   $data       data to sign\n     * @param   string  $secret     secret to use in signing\n     * @param   mixed   $partial    partial signing\n     * @return  string              signature\n     */\n    static public function sign(array $data, $secret, $partial = false) {\n\n        // Support signing only a subset of the data fields\n        if ($partial) {\n            if (is_string($partial)) {\n                $partial = explode(',', $partial);\n            }\n            if (is_array($partial)) {\n                $data = array_intersect_key($data, array_flip($partial));\n            }\n            $partial = join(',', array_keys($data));\n        }\n\n        // Sort the data in ascending ascii key order\n        ksort($data);\n\n        // Convert to a URL encoded string\n        $ret = http_build_query($data, '', '&');\n\n        // Normalise all line endings (CRNL|NLCR|NL|CR) to just NL (%0A)\n        $ret = preg_replace('/%0D%0A|%0A%0D|%0D/i', '%0A', $ret);\n\n        // Hash the string and secret together\n        $ret = hash('SHA512', $ret . $secret);\n\n        // Mark as partially signed if required\n        if ($partial) {\n            $ret . '|' . $partial;\n        }\n\n        return $ret;\n    }\n\n    /**\n     * Collect browser device information.\n     *\n     * The method will return a self submitting HTML form designed to provided\n     * the browser device details in the following integration fields;\n     *   + 'deviceChannel'          - Fixed value 'browser',\n     *   + 'deviceIdentity'         - Browser's UserAgent string\n     *   + 'deviceTimeZone'         - Browser's timezone\n     *   + 'deviceCapabilities'     - Browser's capabilities\n     *   + 'deviceScreenResolution' - Browser's screen resolution (widthxheightxcolour-depth)\n     *   + 'deviceAcceptContent'    - Browser's accepted content types\n     *   + 'deviceAcceptEncoding'   - Browser's accepted encoding methods\n     *   + 'deviceAcceptLanguage'   - Browser's accepted languages\n     *   + 'deviceAcceptCharset'    - Browser's accepted character sets\n     *\n     * The above fields will be submitted as child elements of a 'browserInfo'\n     * parent field.\n     *\n     * The method accepts the following options;\n     *   + 'formAttrs'      - HTML form attributes string\n     *   + 'formData'       - associative array of additional post data\n     *\n     *\n     * The method returns the HTML fragment that needs including in order to\n     * render the HTML form.\n     *\n     * The browser must suport JavaScript in order to obtain the details and\n     * submit the form.\n     *\n     * @param   array   $options    options (or null)\n     * @return  string              request HTML form.\n     *\n     * @throws  InvalidArgumentException    invalid request data\n     */\n    static public function collectBrowserInfo(array $options = null) {\n\n        static::debug(__METHOD__ . '() - args=', func_get_args());\n\n        $form_attrs = 'id=\"collectBrowserInfo\" method=\"post\" action=\"?\"';\n\n        if (isset($options['formAttrs'])) {\n            $form_attrs .= $options['formAttrs'];\n        }\n\n        $device_data = array(\n            'deviceChannel'             => 'browser',\n            'deviceIdentity'            => (isset($_SERVER['HTTP_USER_AGENT']) ? htmlentities($_SERVER['HTTP_USER_AGENT']) : null),\n            'deviceTimeZone'            => '0',\n            'deviceCapabilities'        => '',\n            'deviceScreenResolution'    => '1x1x1',\n            'deviceAcceptContent'       => (isset($_SERVER['HTTP_ACCEPT']) ? htmlentities($_SERVER['HTTP_ACCEPT']) : null),\n            'deviceAcceptEncoding'      => (isset($_SERVER['HTTP_ACCEPT_ENCODING']) ? htmlentities($_SERVER['HTTP_ACCEPT_ENCODING']) : null),\n            'deviceAcceptLanguage'      => (isset($_SERVER['HTTP_ACCEPT_LANGUAGE']) ? htmlentities($_SERVER['HTTP_ACCEPT_LANGUAGE']) : null),\n            'deviceAcceptCharset'       => (isset($_SERVER['HTTP_ACCEPT_CHARSET']) ? htmlentities($_SERVER['HTTP_ACCEPT_CHARSET']) : null),\n        );\n\n        $form_fields = static::fieldToHtml('browserInfo', $device_data);\n\n        if (isset($options['formData'])) {\n            foreach ((array)$options['formData'] as $name => $value) {\n                $form_fields .= static::fieldToHtml($name, $value);\n            }\n        }\n\n        $ret = <<<EOS\n            <form {$form_attrs}>\n                {$form_fields}\n            </form>\n            <script>\n                var screen_depths = [1, 4, 8, 15, 16, 24, 32, 48];\n                var screen_width = (window && window.screen ? window.screen.width : '0');\n                var screen_height = (window && window.screen ? window.screen.height : '0');\n                var screen_depth = (window && window.screen && window.screen.colorDepth && screen_depths.indexOf(window.screen.colorDepth) >= 0 ? window.screen.colorDepth : '0');\n                var identity = (window && window.navigator ? window.navigator.userAgent : '');\n                var language = (window && window.navigator ? (window.navigator.language ? window.navigator.language : window.navigator.browserLanguage) : '');\n                var timezone = (new Date()).getTimezoneOffset();\n                var java = (window && window.navigator ? navigator.javaEnabled() : false);\n                var fields = document.forms.collectBrowserInfo.elements;\n                fields['browserInfo[deviceIdentity]'].value = identity;\n                fields['browserInfo[deviceTimeZone]'].value = timezone;\n                fields['browserInfo[deviceCapabilities]'].value = 'javascript' + (java ? ',java' : '');\n                fields['browserInfo[deviceAcceptLanguage]'].value = language;\n                fields['browserInfo[deviceScreenResolution]'].value = screen_width + 'x' + screen_height + 'x' + screen_depth;\n                window.setTimeout('document.forms.collectBrowserInfo.submit()', 0);\n            <\/script>\nEOS;\n\n        static::debug(__METHOD__ . '() - ret=', $ret);\n\n        return $ret;\n    }\n\n    /**\n     * Return the field name and value as HTML input tags.\n     *\n     * The method will return a string containing one or more HTML <input\n     * type=\"hidden\"> tags which can be used to store the name and value.\n     *\n     * @param   string      $name       field name\n     * @param   mixed       $value      field value\n     * @return  string                  HTML containing <INPUT> tags\n     */\n    static public function fieldToHtml($name, $value) {\n        $ret = '';\n        if (is_array($value)) {\n            foreach ($value as $n => $v) {\n                $ret .= static::fieldToHtml($name . '[' . $n . ']', $v);\n            }\n        } else {\n            // Convert all applicable characters or none printable characters to HTML entities\n            $value = preg_replace_callback('/[\\x00-\\x1f]/', function($matches) { return '&#' . ord($matches[0]) . ';'; }, htmlentities($value, ENT_COMPAT, 'UTF-8', true));\n            $ret = \"<input type=\\\"hidden\\\" name=\\\"{$name}\\\" value=\\\"{$value}\\\" />\\n\";\n        }\n\n        return $ret;\n    }\n\n    /**\n     * Display debug message into PHP error log.\n     *\n     * The method will write the arguments into the PHP error log if\n     * the {@link $debug} property is true. Any none string arguments\n     * will be {@link \\var_export() formatted}.\n     *\n     * @param   mixed       ...         value to debug\n     * @return  void\n     */\n    static public function debug() {\n        if (static::$debug) {\n            $msg = '';\n            foreach (func_get_args() as $arg) {\n                $msg .= (is_string($arg) ? $arg : var_export($arg, true)) . ' ';\n            }\n            error_log($msg);\n        }\n    }\n\n}\n\n?>\n")),(0,r.kt)("h2",{id:"credentials-on-file-cof"},"Credentials on File (COF)"),(0,r.kt)("h3",{id:"cit---cardholder-opts-to-store-their-card-details-on-merchants-website"},"(CIT) - Cardholder opts to store their card details on Merchant's website."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n//echo var_dump($_GET['paymentToken']);\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n // Setup PHP session as use it to store data between 3DS steps\n if (isset($_GET['sid'])) {\n session_id($_GET['sid']);\n }\n\n \n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n \n // If ACS response into the IFRAME then redirect back to parent window\n if (!empty($_GET['acs'])) {\n echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n exit();\n }\n\n if (!isset($_POST['threeDSResponse'])) {\n // Initial request\n\n // Gather browser info - can be done at any time prior to the checkout\n if (!isset($_POST['browserInfo'])) {\n echo Gateway::collectBrowserInfo();\n exit();\n }\n\n\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 1,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields \n //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n 'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTQ4NjA5Mn19',\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'cardonfile', \n\n\n // The following fields are mandatory for 3DS v2\n 'remoteAddress' =>  $_SERVER['REMOTE_ADDR'],\n 'threeDSRedirectURL' => $pageUrl . '&acs=1',\n\n\n\n // The following field allows options to be passed for 3DS v2\n // and the values here are for demonstration purposes only\n 'threeDSOptions' => array(\n      'paymentAccountAge' => '20220601',\n      'paymentAccountAgeIndicator' => '05',\n   ),\n );\n\n // Add the browser info as it is mandatory for 3DS v2\n $req += $_POST['browserInfo'];\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n      'threeDSRef' => $_SESSION['threeDSRef'],\n      'threeDSResponse' => $_POST['threeDSResponse'],\n    );\n        \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_3DS_AUTHENTICATION_REQUIRED) { \n// Send request to the ACS server displaying response in an IFRAME\n\n // Render an IFRAME to show the ACS challenge (hidden for fingerprint method)\n $style = (isset($res['threeDSRequest']['threeDSMethodData']) ? 'display: none;' : '');\n echo \"<iframe name=\\\"threeds_acs\\\" style=\\\"height:420px; width:420px; {$style}\\\"></iframe>\\n\";\n\n // Silently POST the 3DS request to the ACS in the IFRAME\n echo silentPost($res['threeDSURL'], $res['threeDSRequest'], 'threeds_acs');\n\n \n\n // Remember the threeDSRef as need it when the ACS responds\n $_SESSION['threeDSRef'] = $res['threeDSRef'];\n\n} else if ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n echo \"<p>Thank you for your payment.</p>\";\n\n   } \n   else {\n        echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n// Render HTML to silently POST data to URL in target brower window \nfunction silentPost($url = '?', array $post = null, $target = '_self') { \n $url = htmlentities($url);\n $target = htmlentities($target);\n $fields = '';\n\n\n if ($post) {\n foreach ($post as $name => $value) {\n $fields .= Gateway::fieldToHtml($name, $value);\n }\n }\n\n $ret = \"\n <form id=\\\"silentPost\\\" action=\\\"{$url}\\\" method=\\\"post\\\" target=\\\"{$target}\\\">\n {$fields}\n <noscript><input type=\\\"submit\\\" value=\\\"Continue\\\"></noscript\n </form>\n <script>\n window.setTimeout('document.forms.silentPost.submit()', 0);\n <\/script>\n \";\n\n return $ret;\n}\n\n?>\n\n")),(0,r.kt)("h3",{id:"cit---cardholder-opts-to-store-their-card-details-provided-to-merchant-via-mail-or-telephone"},"(CIT) - Cardholder opts to store their card details provided to Merchant via mail or telephone."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n//echo var_dump($_GET['paymentToken']);\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n\n if (!isset($_POST['threeDSResponse'])) {\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 2,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields\n //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n 'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTQ4NjE4MX19',\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'cardonfile', \n );\n\n } else {\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    );\n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n} else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n?>\n")),(0,r.kt)("h3",{id:"cit---cardholder-pays-using-a-card-they-previously-stored-on-the-merchants-website"},"(CIT) - Cardholder pays using a card they previously stored on the Merchant's website."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n//echo var_dump($_GET['paymentToken']);\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n // Setup PHP session as use it to store data between 3DS steps\n if (isset($_GET['sid'])) {\n session_id($_GET['sid']);\n }\n\n \n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n \n // If ACS response into the IFRAME then redirect back to parent window\n if (!empty($_GET['acs'])) {\n echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n exit();\n }\n\n if (!isset($_POST['threeDSResponse'])) {\n // Initial request\n\n // Gather browser info - can be done at any time prior to the checkout\n if (!isset($_POST['browserInfo'])) {\n echo Gateway::collectBrowserInfo();\n exit();\n }\n\n\n //echo $pageUrl . '&acs=1',\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 1,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //CVV is needed\n 'cardCVV' => '159',\n\n //paymentToken generated by Hosted Payment Fields is NOT needed because we have the card details using XREF field.\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'cardonfile',\n\n //XREF from previously transaction\n 'xref' => '22121210GV41HX09GZ49XXM', \n\n // The following fields are mandatory for 3DS v2\n 'remoteAddress' => $_SERVER['REMOTE_ADDR'],\n 'threeDSRedirectURL' => $pageUrl . '&acs=1',\n\n\n\n // The following field allows options to be passed for 3DS v2\n // and the values here are for demonstration purposes only\n 'threeDSOptions' => array(\n      'paymentAccountAge' => '20220601',\n      'paymentAccountAgeIndicator' => '05',\n   ),\n );\n\n // Add the browser info as it is mandatory for 3DS v2\n $req += $_POST['browserInfo'];\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n      'threeDSRef' => $_SESSION['threeDSRef'],\n      'threeDSResponse' => $_POST['threeDSResponse'],\n    );\n        \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_3DS_AUTHENTICATION_REQUIRED) { \n// Send request to the ACS server displaying response in an IFRAME\n\n // Render an IFRAME to show the ACS challenge (hidden for fingerprint method)\n $style = (isset($res['threeDSRequest']['threeDSMethodData']) ? 'display: none;' : '');\n echo \"<iframe name=\\\"threeds_acs\\\" style=\\\"height:420px; width:420px; {$style}\\\"></iframe>\\n\";\n\n // Silently POST the 3DS request to the ACS in the IFRAME\n echo silentPost($res['threeDSURL'], $res['threeDSRequest'], 'threeds_acs');\n\n \n\n // Remember the threeDSRef as need it when the ACS responds\n $_SESSION['threeDSRef'] = $res['threeDSRef'];\n\n} else if ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n echo \"<p>Thank you for your payment.</p>\";\n\n   } \n   else {\n        echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n// Render HTML to silently POST data to URL in target brower window \nfunction silentPost($url = '?', array $post = null, $target = '_self') { \n $url = htmlentities($url);\n $target = htmlentities($target);\n $fields = '';\n\n\n if ($post) {\n foreach ($post as $name => $value) {\n $fields .= Gateway::fieldToHtml($name, $value);\n }\n }\n\n $ret = \"\n <form id=\\\"silentPost\\\" action=\\\"{$url}\\\" method=\\\"post\\\" target=\\\"{$target}\\\">\n {$fields}\n <noscript><input type=\\\"submit\\\" value=\\\"Continue\\\"></noscript\n </form>\n <script>\n window.setTimeout('document.forms.silentPost.submit()', 0);\n <\/script>\n \";\n\n return $ret;\n}\n\n?>\n")),(0,r.kt)("h3",{id:"cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-on-the-merchants-website"},"(CIT) - Cardholder provides their card details to sign up to a subscription on the Merchant's website."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n//echo var_dump($_GET['paymentToken']);\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n // Setup PHP session as use it to store data between 3DS steps\n if (isset($_GET['sid'])) {\n session_id($_GET['sid']);\n }\n\n \n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n \n // If ACS response into the IFRAME then redirect back to parent window\n if (!empty($_GET['acs'])) {\n echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n exit();\n }\n\n if (!isset($_POST['threeDSResponse'])) {\n // Initial request\n\n // Gather browser info - can be done at any time prior to the checkout\n if (!isset($_POST['browserInfo'])) {\n echo Gateway::collectBrowserInfo();\n exit();\n }\n\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 1,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields\n //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n 'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTQ4NzIwNH19',\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'recurring',\n\n //Recurring Transaction Agreement (recurring) configuration\n 'rtCycleDuration' => '3',\n 'rtCycleDurationUnit' => 'week',\n 'rtCycleCount' => '1', \n\n\n // The following fields are mandatory for 3DS v2\n 'remoteAddress' =>  $_SERVER['REMOTE_ADDR'],\n 'threeDSRedirectURL' => $pageUrl . '&acs=1',\n\n\n // The following field allows options to be passed for 3DS v2\n // and the values here are for demonstration purposes only\n 'threeDSOptions' => array(\n      'paymentAccountAge' => '20220601',\n      'paymentAccountAgeIndicator' => '05',\n   ),\n );\n\n // Add the browser info as it is mandatory for 3DS v2\n $req += $_POST['browserInfo'];\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n      'threeDSRef' => $_SESSION['threeDSRef'],\n      'threeDSResponse' => $_POST['threeDSResponse'],\n    );\n        \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_3DS_AUTHENTICATION_REQUIRED) { \n// Send request to the ACS server displaying response in an IFRAME\n\n // Render an IFRAME to show the ACS challenge (hidden for fingerprint method)\n $style = (isset($res['threeDSRequest']['threeDSMethodData']) ? 'display: none;' : '');\n echo \"<iframe name=\\\"threeds_acs\\\" style=\\\"height:420px; width:420px; {$style}\\\"></iframe>\\n\";\n\n // Silently POST the 3DS request to the ACS in the IFRAME\n echo silentPost($res['threeDSURL'], $res['threeDSRequest'], 'threeds_acs');\n\n \n\n // Remember the threeDSRef as need it when the ACS responds\n $_SESSION['threeDSRef'] = $res['threeDSRef'];\n\n} else if ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n echo \"<p>Thank you for your payment.</p>\";\n\n   } \n   else {\n        echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n// Render HTML to silently POST data to URL in target brower window \nfunction silentPost($url = '?', array $post = null, $target = '_self') { \n $url = htmlentities($url);\n $target = htmlentities($target);\n $fields = '';\n\n\n if ($post) {\n foreach ($post as $name => $value) {\n $fields .= Gateway::fieldToHtml($name, $value);\n }\n }\n\n $ret = \"\n <form id=\\\"silentPost\\\" action=\\\"{$url}\\\" method=\\\"post\\\" target=\\\"{$target}\\\">\n {$fields}\n <noscript><input type=\\\"submit\\\" value=\\\"Continue\\\"></noscript\n </form>\n <script>\n window.setTimeout('document.forms.silentPost.submit()', 0);\n <\/script>\n \";\n\n return $ret;\n}\n\n?>\n")),(0,r.kt)("h3",{id:"cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-on-the-merchants-website"},"(CIT) - Cardholder provides their card details when agreeing to purchase by instalments on the Merchant's website."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n // Setup PHP session as use it to store data between 3DS steps\n if (isset($_GET['sid'])) {\n session_id($_GET['sid']);\n }\n\n \n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n \n // If ACS response into the IFRAME then redirect back to parent window\n if (!empty($_GET['acs'])) {\n echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n exit();\n }\n\n if (!isset($_POST['threeDSResponse'])) {\n // Initial request\n\n // Gather browser info - can be done at any time prior to the checkout\n if (!isset($_POST['browserInfo'])) {\n echo Gateway::collectBrowserInfo();\n exit();\n }\n\n // Direct Request\n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 1,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields\n //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n 'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTQ4Nzg3M319',\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n\n //Recurring Transaction Agreement (instalment) configuration\n 'rtAgreementType' => 'instalment',\n 'rtCycleDuration' => '1',\n 'rtCycleDurationUnit' => 'day',\n 'rtCycleCount' => '3',\n\n // The following fields are mandatory for 3DS v2\n 'remoteAddress' =>  $_SERVER['REMOTE_ADDR'],\n 'threeDSRedirectURL' => $pageUrl . '&acs=1',\n\n // The following field allows options to be passed for 3DS v2\n // and the values here are for demonstration purposes only\n 'threeDSOptions' => array(\n      'paymentAccountAge' => '20220601',\n      'paymentAccountAgeIndicator' => '05',\n   ),\n );\n\n // Add the browser info as it is mandatory for 3DS v2\n $req += $_POST['browserInfo'];\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n      'threeDSRef' => $_SESSION['threeDSRef'],\n      'threeDSResponse' => $_POST['threeDSResponse'],\n    );\n        \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_3DS_AUTHENTICATION_REQUIRED) { \n// Send request to the ACS server displaying response in an IFRAME\n\n // Render an IFRAME to show the ACS challenge (hidden for fingerprint method)\n $style = (isset($res['threeDSRequest']['threeDSMethodData']) ? 'display: none;' : '');\n echo \"<iframe name=\\\"threeds_acs\\\" style=\\\"height:420px; width:420px; {$style}\\\"></iframe>\\n\";\n\n // Silently POST the 3DS request to the ACS in the IFRAME\n echo silentPost($res['threeDSURL'], $res['threeDSRequest'], 'threeds_acs');\n\n \n\n // Remember the threeDSRef as need it when the ACS responds\n $_SESSION['threeDSRef'] = $res['threeDSRef'];\n\n} else if ($res['responseCode'] === Gateway::RC_SUCCESS) {\n\n echo \"<p>Thank you for your payment.</p>\";\n\n   } \n   else {\n        echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n// Render HTML to silently POST data to URL in target brower window \nfunction silentPost($url = '?', array $post = null, $target = '_self') { \n $url = htmlentities($url);\n $target = htmlentities($target);\n $fields = '';\n\n\n if ($post) {\n foreach ($post as $name => $value) {\n $fields .= Gateway::fieldToHtml($name, $value);\n }\n }\n\n $ret = \"\n <form id=\\\"silentPost\\\" action=\\\"{$url}\\\" method=\\\"post\\\" target=\\\"{$target}\\\">\n {$fields}\n <noscript><input type=\\\"submit\\\" value=\\\"Continue\\\"></noscript\n </form>\n <script>\n window.setTimeout('document.forms.silentPost.submit()', 0);\n <\/script>\n \";\n\n return $ret;\n}\n\n?>\n")),(0,r.kt)("h3",{id:"cit---cardholder-provides-their-card-details-to-sign-up-to-a-subscription-via-mail-or-telephone-to-the-merchant"},"(CIT) - Cardholder provides their card details to sign up to a subscription via mail or telephone to the Merchant."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n // Setup PHP session as use it to store data between 3DS steps\n if (isset($_GET['sid'])) {\n session_id($_GET['sid']);\n }\n\n \n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n \n // If ACS response into the IFRAME then redirect back to parent window\n if (!empty($_GET['acs'])) {\n echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n exit();\n }\n\n if (!isset($_POST['threeDSResponse'])) {\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 2,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields\n //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n 'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTQ4NzkxM319',\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n\n//Recurring Transaction Agreement (recurring) configuration\n 'rtAgreementType' => 'recurring',\n 'rtCycleDuration' => '1',\n 'rtCycleDurationUnit' => 'day',\n 'rtCycleCount' => '3',\n );\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    );\n        \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n} else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n?>\n")),(0,r.kt)("h3",{id:"cit---cardholder-provides-their-card-details-when-agreeing-to-purchase-by-instalments-on-the-merchants-website-1"},"(CIT) - Cardholder provides their card details when agreeing to purchase by instalments on the Merchant's website."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n if (!isset($_POST['threeDSResponse'])) {\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 2,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields\n //In this case the paymentToken contains: Cardholder name, Card number, Card expiry date and CVV\n 'paymentToken' => 'eyJwYXltZW50VG9rZW4iOnsibWV0aG9kIjoiY2FyZCIsInJlc291cmNlIjoic3RvcmUiLCJpZCI6MTQ4ODA2MH19',\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n\n //Recurring Transaction Agreement (instalment) configuration\n 'rtAgreementType' => 'instalment',\n 'rtCycleDuration' => '1',\n 'rtCycleDurationUnit' => 'day',\n 'rtCycleCount' => '3', \n );\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    );\n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n} else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n?>\n")),(0,r.kt)("h3",{id:"mit---merchantgateway-takes-an-automatic-subscription-payment-at-the-interval-agreed-to-by-the-cardholder"},"(MIT) - Merchant/Gateway takes an automatic subscription payment at the interval agreed to by the Cardholder."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n \n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n \n\n if (!isset($_POST['threeDSResponse'])) {\n// Direct Request\n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 9,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields is NOT needed because we have the card details using XREF field.\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'recurring',\n\n //XREF from previously transaction (recurring)\n 'xref' => '22121215TX13NR38NR50KKB', \n );\n\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    );\n        \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n} else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n?>\n")),(0,r.kt)("h3",{id:"mit---merchantgateway-makes-an-automatic-instalment-payment-at-the-interval-agreed-to-by-the-cardholder"},"(MIT) - Merchant/Gateway makes an automatic instalment payment at the interval agreed to by the Cardholder."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"\n<?PHP\n\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n if (!isset($_POST['threeDSResponse'])) {\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 9,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields is NOT needed because we have the card details using XREF field.\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'instalment',\n\n//XREF from previously transaction (instalment)\n 'xref' => '22121215TX13NR38NR50KKB', \n );\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    );\n        \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n\n} else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n?>\n")),(0,r.kt)("h3",{id:"mit---merchant-makes-an-unscheduled-transaction-such-as-an-account-top-up-as-previously-agreed-with-the-cardholder-when-they-stored-their-card-details"},"(MIT) - Merchant makes an unscheduled transaction, such as an account top-up, as previously agreed with the Cardholder when they stored their card details."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n // Merchant signature key\n Gateway::$merchantSecret = '3obzOxdqw6e1u';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n \n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n \n // If ACS response into the IFRAME then redirect back to parent window\n if (!empty($_GET['acs'])) {\n echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n exit();\n }\n\n if (!isset($_POST['threeDSResponse'])) {\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 2,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields is NOT needed because we have the card details using XREF field.\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'unscheduled',\n\n //XREF from previously transaction\n 'xref' => '22121210GV41HX09GZ49XXM', \n );\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    );\n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n} else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n?>\n")),(0,r.kt)("h3",{id:"mit---merchant-resubmits-a-payment-where-the-initial-payment-was-declined-due-to-insufficient-funds-but-the-goods-have-already-been-provided-to-the-cardholder"},"(MIT) - Merchant resubmits a payment where the initial payment was declined due to insufficient funds, but the goods have already been provided to the Cardholder."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n if (!isset($_POST['threeDSResponse'])) {\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 2,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => 1999,\n\n //paymentToken generated by Hosted Payment Fields is NOT needed because we have the card details using XREF field.\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'resubmission',\n\n //XREF from previously transaction (Declined Transaction)\n 'xref' => '22121210JX08YR10CG88GPN', \n );\n\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    ); \n } \n\n try {\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n\n// Check the response code \nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n} else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n?>\n")),(0,r.kt)("h3",{id:"mit---merchant-reauthorises-a-payment-when-the-completion-or-fulfilment-of-the-original-order-or-service-extends-beyond-the-authorization-validity-limit-set-by-the-card-scheme"},"(MIT) - Merchant reauthorises a payment when the completion or fulfilment of the original order or service extends beyond the authorization validity limit set by the Card Scheme."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n if (!isset($_POST['threeDSResponse'])) {\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 2,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => '1500',\n 'customerName' => 'Handpoint Test Customer',\n \n //paymentToken generated by Hosted Payment Fields is NOT needed because we have the card details using XREF field.\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'reauthorisation',\n\n //XREF from previously transaction \n 'xref' => '22121312ZL07QC35TR82MWD', \n );\n\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    );\n        \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n\n}else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n?>\n\n")),(0,r.kt)("h3",{id:"mit---merchant-makes-a-payment-to-process-a-supplemental-account-charge-after-original-services-have-been-rendered-and-respective-payment-has-been-processed"},"(MIT) - Merchant makes a payment to process a supplemental account charge after original services have been rendered and respective payment has been processed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n // Handpoint Gateway URL\n Gateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n \n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n\n\n if (!isset($_POST['threeDSResponse'])) {\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 2,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => '1500',\n 'customerName' => 'Handpoint Test Customer',\n\n\n //paymentToken generated by Hosted Payment Fields is NOT needed because we have the card details using XREF field.\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'delayedcharges',\n\n //XREF from previously transaction\n 'xref' => '22121312ZL07QC35TR82MWD', \n );\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    );\n        \n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n\n}else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n  }\n\n?>\n")),(0,r.kt)("h3",{id:"mit---merchant-makes-a-payment-to-charge-the-cardholder-a-penalty-according-to-the-merchants-reservation-cancellation-policy"},"(MIT) - Merchant makes a payment to charge the Cardholder a penalty according to the merchant\u2019s reservation cancellation policy."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n\nrequire('gateway.php');\n\nuse \\P3\\SDK\\Gateway;\n\n\n// Merchant signature key\nGateway::$merchantSecret = '3obzOxdqw6e1u';\n\n// Handpoint Gateway URL\nGateway::$directUrl = 'https://commerce-api.handpoint.com/direct/';\n\n session_start(); \n // Compose current page URL (removing any sid and acs parameters)\n $pageUrl = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') ? 'https://' : 'http://'). $_SERVER['SERVER_NAME']. ($_SERVER['SERVER_PORT'] != '80' ? ':' . $_SERVER['SERVER_PORT'] : ''). preg_replace('/(sid=[^&]+&?)|(acs=1&?)/', '', $_SERVER['REQUEST_URI']);\n\n // Add back the correct sid parameter (used as session cookie may not be passed when the page is redirected from an IFRAME)\n $pageUrl .= (strpos($pageUrl, '?') === false ? '?' : '&') . 'sid=' . urlencode(session_id());\n \n // If ACS response into the IFRAME then redirect back to parent window\n if (!empty($_GET['acs'])) {\n echo silentPost($pageUrl, array('threeDSResponse' => $_POST), '_parent');\n exit();\n }\n\n if (!isset($_POST['threeDSResponse'])) {\n // Direct Request\n \n $req = array(\n 'merchantID' => 155928,\n 'action' => 'SALE',\n 'type' => 2,\n 'currencyCode' => 826,\n 'countryCode' => 826,\n 'amount' => '1500',\n 'customerName' => 'Handpoint Test Customer',\n\n //paymentToken generated by Hosted Payment Fields is NOT needed because we have the card details using XREF field.\n 'customerAddress' => 'Merevale Avenue Leicester',\n 'customerPostCode' => 'LE10 2BU',\n 'orderRef' => 'Test purchase',\n 'rtAgreementType' => 'noshow',\n\n //XREF from previously transaction (initial CIT payment)\n 'xref' => '22121312ZL07QC35TR82MWD', \n );\n\n } else {\n\n   $req = array (\n      // The following field are only required for tbe benefit of the SDK \n      'merchantID' => '155928',\n      'action' => 'SALE',\n    );\n } \n\n try {\n  //echo var_dump ($req);\n    $res = Gateway::directRequest($req);\n } catch (\\Exception $e) {\n \n// You should exit gracefully\n die('Sorry, the request could not be sent: ' . $e);\n }\n\n print $res['responseCode'];\n// Check the response code\nif ($res['responseCode'] === Gateway::RC_SUCCESS) {\n    echo \"<p>Thank you for your payment.</p>\";\n\n} else {\n    echo \"<p>Failed to take payment: \" . htmlentities($res['responseMessage']) . \"</p>\";\n}\n\n?>\n")),(0,r.kt)("h2",{id:"testing"},"Testing"),(0,r.kt)("p",null,"You will be provided with unique test Merchant Account IDs during the onboarding process. Refer to the ",(0,r.kt)("a",{parentName:"p",href:"overview#authentication"},"authentication")," section for the list of required parameters. Test Merchant Accounts are connected to a Simulator and not to an actual Acquirer. The Simulator will emulate the function of an Acquirer and provide simulated responses and authorisation codes."),(0,r.kt)("h3",{id:"test-amounts"},"Test Amounts"),(0,r.kt)("p",null,"When testing the transaction amount can be used to trigger different authorisation and settlement outcomes as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Min. Amount"),(0,r.kt)("th",{parentName:"tr",align:null},"Max. Amount"),(0,r.kt)("th",{parentName:"tr",align:null},"Authorisation response"),(0,r.kt)("th",{parentName:"tr",align:null},"Settlement outcome"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"100 (1.00)"),(0,r.kt)("td",{parentName:"tr",align:null},"2499 (24.99)"),(0,r.kt)("td",{parentName:"tr",align:null},"(0) AUTH CODE: XXXXXX"),(0,r.kt)("td",{parentName:"tr",align:null},"ACCEPTED")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"2500 (25.00)"),(0,r.kt)("td",{parentName:"tr",align:null},"4999 (49.99)"),(0,r.kt)("td",{parentName:"tr",align:null},"(0) AUTH CODE: XXXXXX"),(0,r.kt)("td",{parentName:"tr",align:null},"REJECTED")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5000 (50.00)"),(0,r.kt)("td",{parentName:"tr",align:null},"7499 (74.99)"),(0,r.kt)("td",{parentName:"tr",align:null},"(1) CARD REFERRED ",(0,r.kt)("br",null)," (0) AUTH CODE: XXXXXX"),(0,r.kt)("td",{parentName:"tr",align:null},"ACCEPTED")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"7500 (75.00)"),(0,r.kt)("td",{parentName:"tr",align:null},"9999 (99.99)"),(0,r.kt)("td",{parentName:"tr",align:null},"(1) CARD REFERRED ",(0,r.kt)("br",null)," (0) AUTH CODE: XXXXXX"),(0,r.kt)("td",{parentName:"tr",align:null},"REJECTED")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10000 (100.00)"),(0,r.kt)("td",{parentName:"tr",align:null},"14999 (49.99)"),(0,r.kt)("td",{parentName:"tr",align:null},"(5) CARD DECLINED"),(0,r.kt)("td",{parentName:"tr",align:null},"N/A")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"15000 (150.00)"),(0,r.kt)("td",{parentName:"tr",align:null},"19999 (199.99)"),(0,r.kt)("td",{parentName:"tr",align:null},"(4) CARD DECLINED \u2013 KEEP CARD"),(0,r.kt)("td",{parentName:"tr",align:null},"N/A")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"20000 (200.00)"),(0,r.kt)("td",{parentName:"tr",align:null},"24999 (249.99)"),(0,r.kt)("td",{parentName:"tr",align:null},"(65) CARD DECLINED - SCA REQUIRED ",(0,r.kt)("br",null)," (0) AUTH CODE: XXXXXX"),(0,r.kt)("td",{parentName:"tr",align:null},"ACCEPTED")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"25000 (250.00)"),(0,r.kt)("td",{parentName:"tr",align:null},"29999 (299.99)"),(0,r.kt)("td",{parentName:"tr",align:null},"(65) CARD DECLINED \u2013 SCA REQUIRED ",(0,r.kt)("br",null),"  (5) CARD DECLINED"),(0,r.kt)("td",{parentName:"tr",align:null},"N/A")))),(0,r.kt)("p",null,"Any other amount will return a ",(0,r.kt)("inlineCode",{parentName:"p"},"responseCode")," of 66311 (Invalid Test Amount)."),(0,r.kt)("p",null,"The settlement outcome only applies to transactions which reach settlement due to being successfully authorised and captured and not cancelled. The amount captured is used when determining the settlement outcome rather than the amount authorised."),(0,r.kt)("p",null,"The range 5000 to 9999 can be used to test manual authorisations. If the transaction does not contain an ",(0,r.kt)("inlineCode",{parentName:"p"},"authorisationCode")," request field, then the Simulator will return a ",(0,r.kt)("inlineCode",{parentName:"p"},"responseCode")," of 1 (CARD REFERRED). If it does, then it will return a ",(0,r.kt)("inlineCode",{parentName:"p"},"responseCode")," of 0 (SUCCESS), with an amount between 50000 and 7499 being accepted at settlement and an amount of 7500 to 9999 being rejected."),(0,r.kt)("p",null,"The range 20000 to 29999 can be used to test secure customer authentication (SCA) soft declines. If the transaction is eligible to request SCA then the Simulator will return a ",(0,r.kt)("inlineCode",{parentName:"p"},"responseCode")," of 65 (SCA REQUIRED). If not, then it will return a ",(0,r.kt)("inlineCode",{parentName:"p"},"responseCode")," of 0 (SUCCESS) for the range 20000 to 24999 or 5 (DO NOT HONOR) for the range 25000 to 29999. Successful transactions will be approved at settlement."),(0,r.kt)("p",null,"Note: SCA exemptions are not supported by the simulator and so cannot be used to request that SCA is not required."),(0,r.kt)("h3",{id:"test-cards"},"Test Cards"),(0,r.kt)("p",null,"The test accounts will only accept card numbers that are designated for test purposes. These test cards cannot be used on production accounts."),(0,r.kt)("p",null,"To test AVS and CV2 verification then the associated CVV and billing addresses are provided for each card. If a different value is used, then the Simulator will mark the responses as \u2018not matched\u2019."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Unless stated otherwise an expiry date sometime in the near future should be used.")),(0,r.kt)("h4",{id:"visa-credit"},"Visa Credit"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV"),(0,r.kt)("th",{parentName:"tr",align:null},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4929421234600821"),(0,r.kt)("td",{parentName:"tr",align:null},"356"),(0,r.kt)("td",{parentName:"tr",align:null},"Flat 6 Primrose Rise",(0,r.kt)("br",null)," 347 Lavender Road ",(0,r.kt)("br",null),"Northampton ",(0,r.kt)("br",null)," NN17 8YG")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4543059999999982"),(0,r.kt)("td",{parentName:"tr",align:null},"110"),(0,r.kt)("td",{parentName:"tr",align:null},"76 Roseby Avenue",(0,r.kt)("br",null)," Manchester ",(0,r.kt)("br",null),"M63X 7TH")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4543059999999990"),(0,r.kt)("td",{parentName:"tr",align:null},"689"),(0,r.kt)("td",{parentName:"tr",align:null},"23 Rogerham Mansions",(0,r.kt)("br",null),"4578 Ermine Street",(0,r.kt)("br",null)," Borehamwood ",(0,r.kt)("br",null)," WD54 8TH")))),(0,r.kt)("h4",{id:"visa-debit"},"Visa Debit"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV"),(0,r.kt)("th",{parentName:"tr",align:null},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4539791001730106"),(0,r.kt)("td",{parentName:"tr",align:null},"289"),(0,r.kt)("td",{parentName:"tr",align:null},"Unit 5 Pickwick Walk",(0,r.kt)("br",null),"120 Uxbridge Road Hatch End",(0,r.kt)("br",null),"Middlesex",(0,r.kt)("br",null),"HA6 7HJ")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4462000000000003"),(0,r.kt)("td",{parentName:"tr",align:null},"672"),(0,r.kt)("td",{parentName:"tr",align:null},"Mews 57",(0,r.kt)("br",null),"Ladybird Drive",(0,r.kt)("br",null),"Denmark",(0,r.kt)("br",null)," 65890")))),(0,r.kt)("h4",{id:"visa-electron"},"Visa Electron"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV"),(0,r.kt)("th",{parentName:"tr",align:null},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4917480000000008"),(0,r.kt)("td",{parentName:"tr",align:null},"009"),(0,r.kt)("td",{parentName:"tr",align:null},"5-6 Ross Avenue",(0,r.kt)("br",null),"Birmingham",(0,r.kt)("br",null),"B67 8UJ")))),(0,r.kt)("h4",{id:"mastercard-credit"},"Mastercard Credit"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV"),(0,r.kt)("th",{parentName:"tr",align:null},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5301250070000191"),(0,r.kt)("td",{parentName:"tr",align:null},"419"),(0,r.kt)("td",{parentName:"tr",align:null},"25 The Larches Narborough",(0,r.kt)("br",null),"Leicester",(0,r.kt)("br",null),"LE10 2RT")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5413339000001000"),(0,r.kt)("td",{parentName:"tr",align:null},"304"),(0,r.kt)("td",{parentName:"tr",align:null},"Pear Tree Cottage",(0,r.kt)("br",null),"The Green",(0,r.kt)("br",null),"Milton Keynes",(0,r.kt)("br",null),"MK11 7UY")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5434849999999951"),(0,r.kt)("td",{parentName:"tr",align:null},"470"),(0,r.kt)("td",{parentName:"tr",align:null},"34a Rubbery Close",(0,r.kt)("br",null),"Cloisters Run",(0,r.kt)("br",null),"Rugby",(0,r.kt)("br",null),"CV21 8JT")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5434849999999993"),(0,r.kt)("td",{parentName:"tr",align:null},"557"),(0,r.kt)("td",{parentName:"tr",align:null},"4-7 The Hay Market",(0,r.kt)("br",null),"Grantham",(0,r.kt)("br",null),"NG32 4HG")))),(0,r.kt)("h4",{id:"mastercard-debit"},"Mastercard Debit"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV"),(0,r.kt)("th",{parentName:"tr",align:null},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5573 4712 3456 7898"),(0,r.kt)("td",{parentName:"tr",align:null},"159"),(0,r.kt)("td",{parentName:"tr",align:null},"Merevale Avenue",(0,r.kt)("br",null),"Leicester",(0,r.kt)("br",null),"LE10 2BU")))),(0,r.kt)("h4",{id:"uk-maestro"},"UK Maestro"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV"),(0,r.kt)("th",{parentName:"tr",align:null},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"6759 0150 5012 3445 002"),(0,r.kt)("td",{parentName:"tr",align:null},"309"),(0,r.kt)("td",{parentName:"tr",align:null},"The Parkway",(0,r.kt)("br",null),"5258 Larches Approach Hull",(0,r.kt)("br",null),"North Humberside",(0,r.kt)("br",null),"HU10 5OP")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"6759 0168 0000 0120 097"),(0,r.kt)("td",{parentName:"tr",align:null},"701"),(0,r.kt)("td",{parentName:"tr",align:null},"The Manor",(0,r.kt)("br",null),"Wolvey Road",(0,r.kt)("br",null),"Middlesex",(0,r.kt)("br",null),"TW7 9FF")))),(0,r.kt)("h4",{id:"jcb"},"JCB"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV"),(0,r.kt)("th",{parentName:"tr",align:null},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3540599999991047"),(0,r.kt)("td",{parentName:"tr",align:null},"209"),(0,r.kt)("td",{parentName:"tr",align:null},"2 Middle Wallop Merideth-in-the-Wolds",(0,r.kt)("br",null),"Lincolnshire",(0,r.kt)("br",null),"LN2 8HG")))),(0,r.kt)("h4",{id:"american-express"},"American Express"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV"),(0,r.kt)("th",{parentName:"tr",align:null},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"374245455400001"),(0,r.kt)("td",{parentName:"tr",align:null},"4887"),(0,r.kt)("td",{parentName:"tr",align:null},"The Hunts Way",(0,r.kt)("br",null),"Southampton",(0,r.kt)("br",null),"SO18 1GW")))),(0,r.kt)("h4",{id:"diners-club"},"Diners Club"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Number"),(0,r.kt)("th",{parentName:"tr",align:null},"CVV"),(0,r.kt)("th",{parentName:"tr",align:null},"Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"36432685260294"),(0,r.kt)("td",{parentName:"tr",align:null},"111"),(0,r.kt)("td",{parentName:"tr",align:null},"N/A")))),(0,r.kt)("p",null,"Diners Club do not support the Address Verification Service (AVS). For testing purposes, we advise that a separate Merchant Account is used with AVS is turned off."),(0,r.kt)("h3",{id:"3d-secure-testing"},"3D Secure Testing"),(0,r.kt)("p",null,"Your test accounts are connected to our 3-D Secure Product Integration Testing (PIT) system rather than to the production 3-D Secure servers. You can use any of the test cards provided above with this PIT system, and the authentication status returned by the Directory Server (for frictionless flow simulation) can be selected using the value of the card expiry month as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Card Expiry Month"),(0,r.kt)("th",{parentName:"tr",align:null},"Auth Status"),(0,r.kt)("th",{parentName:"tr",align:null},"Simulation (Frictionless)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"01 - January"),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"Fully authenticated")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"02 - February"),(0,r.kt)("td",{parentName:"tr",align:null},"N"),(0,r.kt)("td",{parentName:"tr",align:null},"Not authenticated")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"03 - March"),(0,r.kt)("td",{parentName:"tr",align:null},"U"),(0,r.kt)("td",{parentName:"tr",align:null},"Unknown authentication status")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"04 - April"),(0,r.kt)("td",{parentName:"tr",align:null},"A"),(0,r.kt)("td",{parentName:"tr",align:null},"Attempted authentication")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"05 - May"),(0,r.kt)("td",{parentName:"tr",align:null},"D"),(0,r.kt)("td",{parentName:"tr",align:null},"Decoupled authentication")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"06 - June"),(0,r.kt)("td",{parentName:"tr",align:null},"R"),(0,r.kt)("td",{parentName:"tr",align:null},"Transaction rejected (do not attempt to send for authorisation)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"07 \u2013 July"),(0,r.kt)("td",{parentName:"tr",align:null},"E"),(0,r.kt)("td",{parentName:"tr",align:null},"Unknown error performing 3-D Secure checks")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"08 - August"),(0,r.kt)("td",{parentName:"tr",align:null},"E"),(0,r.kt)("td",{parentName:"tr",align:null},"Error due to timeout communicating with the Directory Server")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"09 \u2013 September"),(0,r.kt)("td",{parentName:"tr",align:null},"E"),(0,r.kt)("td",{parentName:"tr",align:null},"Error due to corrupt response from the Directory Server.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10 \u2013 October"),(0,r.kt)("td",{parentName:"tr",align:null},"I"),(0,r.kt)("td",{parentName:"tr",align:null},"Information only")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"11 \u2013 November"),(0,r.kt)("td",{parentName:"tr",align:null},"U"),(0,r.kt)("td",{parentName:"tr",align:null},"Unknown authentication due to Cardholder not enrolled (error 13)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"12 - December"),(0,r.kt)("td",{parentName:"tr",align:null},"C"),(0,r.kt)("td",{parentName:"tr",align:null},"Frictionless not possible, challenge Cardholder")))),(0,r.kt)("p",null,"An expiry month of 12 will simulate the non frictionless flow and desired authentication status (threeDSAuthenticated) can be selected on the challenge dialog shown by the PIT Access Control Server."),(0,r.kt)("p",null,"When using an expiry month from the above table please use a suitable expiry year to ensure the date is sometime in the near future."),(0,r.kt)("h3",{id:"paypal-sandbox-accounts"},"Paypal Sandbox Accounts"),(0,r.kt)("p",null,"Please contact customer support to have your own PayPal test Merchant account created that connects to your own PayPal sandbox account, thus enabling you to view the transactions as they are sent to PayPal."),(0,r.kt)("h3",{id:"amazon-pay-sandbox-accounts"},"Amazon Pay Sandbox Accounts"),(0,r.kt)("p",null,"Please contact customer support to have your own Amazon Pay test Merchant account created that connects to your own Amazon Pay sandbox account, thus enabling you to view the transactions as they are sent to Amazon Pay."),(0,r.kt)("h3",{id:"request-checking-only"},"Request Checking Only"),(0,r.kt)("p",null,"Sometimes, you may wish to submit a request to the Gateway in order for it to be \u2018validated only\u2019 and not processed by the simulator or sent to the Acquirer. In these cases, the following flag can be used that will stop the processing after the integrity verification has been performed:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Mandatory"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"checkOnly"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Check the request for syntax and field value errors only. Do not attempt to submit the transaction for honouring by the Merchant\u2019s financial institution.")))),(0,r.kt)("p",null,"If the request is OK, then a responseCode is returned as 0 (Success); otherwise, the code that would have prevented the request from completing is returned."),(0,r.kt)("p",null,"Note: in these cases, the request is not stored by the Gateway and is not available within the Merchant Management System (MMS)."),(0,r.kt)("h2",{id:"signatureCalculation"},"Signature Calculation"),(0,r.kt)("p",null,"It is highly recommended that transactions are protected using message signing. The signing process offers a quick and simple way to ensure that the message came from an authorised source and has not been tampered with during transmission."),(0,r.kt)("p",null,"Signing, however, must be completed on your servers and never left for the Customer\u2019s browser to complete in JavaScript, as this would mean revealing your secret signature code to anyone who viewed the JavaScript code in the browser."),(0,r.kt)("p",null,"Signatures are especially important when a transaction is sent from a browser\u2019s payment form via the use of hidden form fields because the Customer can easily use tools built into their browser to modify these hidden fields and change items such as the amount they should be charged."),(0,r.kt)("p",null,"Care must be taken to ensure that fields are sorted before signing into ascending field name order according to their numeric ASCII value. Some languages natural sort routines do NOT use ASCII order by default and so need to be adjusted or alternative methods used."),(0,r.kt)("p",null,"Also, when signing requests with fields formatted as per the ",(0,r.kt)("a",{parentName:"p",href:"overview#fieldFormats"},"format guide"),", only the root integration field is included in any sorting as the sub-fields are part of the value and should not have their order changed. The sub-fields must then be sent in the same order as they were hashed if added as hidden fields in HTML forms etc.\nThe section below gives a step-by-step example of how to sign a transaction, complete with coding examples using the PHP language."),(0,r.kt)("h3",{id:"example-signature-key"},"Example Signature Key"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$key = 'DontTellAnyone'\n")),(0,r.kt)("h3",{id:"example-transaction"},"Example Transaction"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$tran = array ( \n    'merchantID' => '100001',  //merchantID will be provided by the Handpoint support team\n    'action' => 'SALE', //action could be SALE, VERIFY or PREAUTH \n    'type' => '1', //1 \u2013> E-commerce (ECOM), 2 \u2013> Mail Order/Telephone Order (MOTO), 9 \u2013> Continuous Authority (CA)\n    'currencyCode' => '826', //ISO 3-letter currency code. 826 -> GBP\n    'countryCode' => '826', //ISO 3-letter country code. 826 -> United Kingdom\n    'amount' => '2691', //Either major currency units includes a single decimal point such as \u201910.99'. \n                      //Minor currency units contains no decimal points such as \u20181099\n    'transactionUnique' => '55f025addd3c2', //Unique identifier for this transaction. This is an added security feature to combat transaction spoofing\n    'orderRef' => 'Signature Test',  //Free format text field to store order details, reference numbers, etc. for the Merchant\u2019s records.\n    'cardNumber' => '4929 4212 3460 0821', //Card Number\n    'cardExpiryDate' => '1213', ) //Card expiry date\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The transaction used for signature calculation must not include any 'signature' field as this will be added after signing when its value is known.")),(0,r.kt)("h4",{id:"step-1---sort-transaction-values-by-their-field-name"},"Step 1 - Sort transaction values by their field name"),(0,r.kt)("p",null,"Transaction fields must be in ascending field name order according to their numeric ASCII value."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"ksort($tran);\narray ( 'action' => 'SALE', 'amount' => '2691', 'cardExpiryDate' => '1213', 'cardNumber' => '4929 4212 3460 0821', 'countryCode' => '826', 'currencyCode' => '826', 'merchantID' => '100001', 'orderRef' => 'Signature Test', 'transactionUnique' => '55f025addd3c2', 'type' => '1' )\n")),(0,r.kt)("h4",{id:"step-2---create-url-encoded-string-from-sorted-fields"},"Step 2 - Create url encoded string from sorted fields"),(0,r.kt)("p",null,"Use RFC 1738 and the application/x-www-form-urlencoded media type, which implies that spaces are encoded as plus (+) signs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$str = http_build_query($tran, '', '&');\n\naction=SALE&amount=2691&cardExpiryDate=1213&cardNumber=4929+4212+3460+0821&countryCode=826&currencyCode=826&merchantID=100001&orderRef=Signature+Test&transactionUnique=55f025addd3c2&type=1\n")),(0,r.kt)("h4",{id:"step-3---normalise-all-line-endings-in-the-url-encoded-string"},"Step 3 - Normalise all line endings in the url encoded string"),(0,r.kt)("p",null,"Convert all CR NL, NL CR, CR character sequences to a single NL character."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$str = str_replace(array('%0D%0A', '%0A%0D', '%0D'), '%0A', $str);\n\naction=SALE&amount=2691&cardExpiryDate=1213&cardNumber=4929+4212+3460+0821&countryCode=826&currencyCode=826&merchantID=100001&orderRef=Signature+Test&transactionUnique=55f025addd3c2&type=1\n")),(0,r.kt)("h4",{id:"step-4---append-your-signature-key-to-the-normalised-string"},"Step 4 - Append your signature key to the normalised string"),(0,r.kt)("p",null,"The signature key is appended to the normalised string with no separator characters."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$str .= 'DontTellAnyone'\n\naction=SALE&amount=2691&cardExpiryDate=1213&cardNumber=4929+4212+3460+0821&countryCode=826&currencyCode=826&merchantID=100001&orderRef=Signature+Test&transactionUnique=55f025addd3c2&type=1DontTellAnyone\n")),(0,r.kt)("h4",{id:"step-5---hash-the-string-using-the-sha-512-algorithm"},"Step 5 - Hash the string using the SHA-512 algorithm"),(0,r.kt)("p",null,"The normalised string is hashed to a more compact value using the secure SHA-512 hashing algorithm."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$signature = hash('SHA512', $str);\n\nda0acd2c404945365d0e7ae74ad32d57c561e9b942f6bdb7e3dda49a08fcddf74fe6af6b23b8481b8dc8895c12fc21c72c69d60f137fdf574720363e33d94097\n")),(0,r.kt)("h4",{id:"step-6---add-the-signature-to-the-transaction-form-or-post-data"},"Step 6 - Add the signature to the transaction form or post data"),(0,r.kt)("p",null,"The signature should be sent as part of the transaction in a field called 'signature'."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'<input type="hidden" name="signature" value="<?=$signature?>">\nor\n$tran[\'signature\'] = $signature;\n')),(0,r.kt)("h3",{id:"sample-code-php"},"Sample Code PHP"),(0,r.kt)("p",null,"Example of calculating the signature in PHP:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"\n<?PHP \n\n//Merchant signature key\n$key = 'm3rch4nts1gn4tur3k3y';\n\n\n//Request Information\n$tran = array (\n'merchantID' => '100001',  //merchantID will be provided by the Handpoint support team\n    'action' => 'SALE', //action could be SALE, VERIFY or PREAUTH \n    'type' => '1', //1 \u2013> E-commerce (ECOM), 2 \u2013> Mail Order/Telephone Order (MOTO), 9 \u2013> Continuous Authority (CA)\n    'currencyCode' => '826', //ISO 3-letter currency code. 826 -> GBP\n    'countryCode' => '826', //ISO 3-letter country code. 826 -> United Kingdom\n    'amount' => '2691', //Either major currency units includes a single decimal point such as \u201910.99'. \n                      //Minor currency units contains no decimal points such as \u20181099\n    'transactionUnique' => '55f025addd3c2', //Unique identifier for this transaction. This is an added security feature to combat transaction spoofing\n    'orderRef' => 'Signature Test',  //Free format text field to store order details, reference numbers, etc. for the Merchant\u2019s records.\n    'cardNumber' => '4929 4212 3460 0821', //Card Number\n    'cardExpiryDate' => '1213',\n);\n \n\n ksort($tran);\n\n $str = http_build_query($tran, '', '&');\n\n $str = str_replace(array('%0D%0A', '%0A%0D', '%0D'), '%0A', $str);\n\n $str .= '3obzOxdqw6e1u';\n\n $signature = hash('SHA512', $str);\n\n //Prints the signature\n printf(\"Signature %s\", $signature);\n ?>\n\n")))}c.isMDXComponent=!0}}]);